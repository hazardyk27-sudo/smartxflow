<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartXFlow Admin Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0d1117;
            color: #c9d1d9;
            min-height: 100vh;
            display: flex;
        }
        .sidebar {
            width: 260px;
            background: #161b22;
            border-right: 1px solid #30363d;
            min-height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            display: flex;
            flex-direction: column;
        }
        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #30363d;
        }
        .sidebar-header h1 {
            color: #58a6ff;
            font-size: 18px;
            font-weight: 600;
        }
        .sidebar-header span {
            color: #8b949e;
            font-size: 11px;
        }
        .sidebar-nav {
            flex: 1;
            padding: 12px 0;
        }
        .nav-category {
            padding: 8px 20px;
            color: #8b949e;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .nav-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            color: #c9d1d9;
            text-decoration: none;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }
        .nav-item:hover {
            background: #21262d;
        }
        .nav-item.active {
            background: #1c2128;
            border-left-color: #58a6ff;
            color: #58a6ff;
        }
        .nav-item-icon {
            font-size: 16px;
            width: 20px;
            text-align: center;
        }
        .sidebar-footer {
            padding: 16px 20px;
            border-top: 1px solid #30363d;
        }
        .back-home {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #8b949e;
            text-decoration: none;
            font-size: 13px;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.2s;
        }
        .back-home:hover {
            background: #21262d;
            color: #58a6ff;
        }
        .main-content {
            margin-left: 260px;
            flex: 1;
            padding: 24px;
            min-height: 100vh;
        }
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid #30363d;
        }
        .page-title {
            color: #f0883e;
            font-size: 22px;
            font-weight: 600;
        }
        .page-subtitle {
            color: #8b949e;
            font-size: 13px;
            margin-top: 4px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        .stat-card {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }
        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #58a6ff;
            margin-bottom: 4px;
        }
        .stat-label {
            color: #8b949e;
            font-size: 13px;
        }
        .stat-value.green { color: #3fb950; }
        .stat-value.orange { color: #f0883e; }
        .stat-value.red { color: #f85149; }
        .info-card {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 16px;
        }
        .info-card h3 {
            color: #58a6ff;
            font-size: 16px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #21262d;
        }
        .info-row:last-child {
            border-bottom: none;
        }
        .info-label {
            color: #8b949e;
        }
        .info-value {
            color: #c9d1d9;
            font-weight: 500;
        }
        .info-value.success { color: #3fb950; }
        .info-value.warning { color: #f0883e; }
        .info-value.error { color: #f85149; }
        .page-content {
            display: none;
        }
        .page-content.active {
            display: block;
        }
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-size: 14px;
            z-index: 1000;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s;
        }
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        .toast.success { background: #238636; }
        .toast.error { background: #da3633; }
        .toast.info { background: #1f6feb; }
        .market-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }
        .market-table th,
        .market-table td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid #21262d;
        }
        .market-table th {
            color: #8b949e;
            font-weight: 500;
            font-size: 12px;
            text-transform: uppercase;
        }
        .market-table td {
            color: #c9d1d9;
        }
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }
        .badge.active { background: rgba(63, 185, 80, 0.2); color: #3fb950; }
        .badge.inactive { background: rgba(139, 148, 158, 0.2); color: #8b949e; }
    </style>
</head>
<body>
    <aside class="sidebar">
        <div class="sidebar-header">
            <h1>SmartXFlow</h1>
            <span>Admin Panel</span>
        </div>
        <nav class="sidebar-nav">
            <div class="nav-category">Sistem</div>
            <div class="nav-item active" onclick="showPage('dashboard')" data-page="dashboard">
                <span class="nav-item-icon">üìä</span>
                <span>Dashboard</span>
            </div>
            <div class="nav-item" onclick="showPage('markets')" data-page="markets">
                <span class="nav-item-icon">üìà</span>
                <span>Market Durumu</span>
            </div>
            <div class="nav-item" onclick="showPage('system')" data-page="system">
                <span class="nav-item-icon">‚öôÔ∏è</span>
                <span>Sistem Bilgisi</span>
            </div>
        </nav>
        <div class="sidebar-footer">
            <a href="/" class="back-home">
                <span>‚Üê</span>
                <span>Ana Sayfaya Don</span>
            </a>
        </div>
    </aside>

    <main class="main-content">
        <div id="page-dashboard" class="page-content active">
            <div class="page-header">
                <div>
                    <h2 class="page-title">Dashboard</h2>
                    <p class="page-subtitle">Sistem durumu ve ozet bilgiler</p>
                </div>
            </div>

            <div class="stats-grid" id="dashboardStats">
                <div class="stat-card">
                    <div class="stat-value" id="totalMatches">-</div>
                    <div class="stat-label">Toplam Mac</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value green" id="activeMarkets">6</div>
                    <div class="stat-label">Aktif Market</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value orange" id="lastUpdate">-</div>
                    <div class="stat-label">Son Guncelleme</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="dbStatus">-</div>
                    <div class="stat-label">Supabase Durumu</div>
                </div>
            </div>

            <div class="info-card">
                <h3>üì° Baglanti Durumu</h3>
                <div class="info-row">
                    <span class="info-label">Supabase</span>
                    <span class="info-value success" id="supabaseStatus">Bagli</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Scraper Modu</span>
                    <span class="info-value" id="scraperMode">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Calisma Modu</span>
                    <span class="info-value" id="workMode">-</span>
                </div>
            </div>
        </div>

        <div id="page-markets" class="page-content">
            <div class="page-header">
                <div>
                    <h2 class="page-title">Market Durumu</h2>
                    <p class="page-subtitle">6 market icin veri durumu</p>
                </div>
            </div>

            <div class="info-card">
                <h3>üìä Market Verileri</h3>
                <table class="market-table">
                    <thead>
                        <tr>
                            <th>Market</th>
                            <th>Mac Sayisi</th>
                            <th>Durum</th>
                        </tr>
                    </thead>
                    <tbody id="marketTableBody">
                        <tr>
                            <td>Moneyway 1X2</td>
                            <td id="mw1x2Count">-</td>
                            <td><span class="badge active">Aktif</span></td>
                        </tr>
                        <tr>
                            <td>Moneyway O/U 2.5</td>
                            <td id="mwou25Count">-</td>
                            <td><span class="badge active">Aktif</span></td>
                        </tr>
                        <tr>
                            <td>Moneyway BTTS</td>
                            <td id="mwbttsCount">-</td>
                            <td><span class="badge active">Aktif</span></td>
                        </tr>
                        <tr>
                            <td>Dropping 1X2</td>
                            <td id="dp1x2Count">-</td>
                            <td><span class="badge active">Aktif</span></td>
                        </tr>
                        <tr>
                            <td>Dropping O/U 2.5</td>
                            <td id="dpou25Count">-</td>
                            <td><span class="badge active">Aktif</span></td>
                        </tr>
                        <tr>
                            <td>Dropping BTTS</td>
                            <td id="dpbttsCount">-</td>
                            <td><span class="badge active">Aktif</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="page-system" class="page-content">
            <div class="page-header">
                <div>
                    <h2 class="page-title">Sistem Bilgisi</h2>
                    <p class="page-subtitle">Teknik detaylar ve konfigurasyonlar</p>
                </div>
            </div>

            <div class="info-card">
                <h3>üñ•Ô∏è Uygulama Bilgileri</h3>
                <div class="info-row">
                    <span class="info-label">Uygulama</span>
                    <span class="info-value">SmartXFlow Monitor</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Versiyon</span>
                    <span class="info-value">1.0</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Timezone</span>
                    <span class="info-value">Europe/Istanbul (TR)</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Scrape Araligi</span>
                    <span class="info-value">10 dakika</span>
                </div>
            </div>

            <div class="info-card">
                <h3>üóÑÔ∏è Veritabani</h3>
                <div class="info-row">
                    <span class="info-label">Provider</span>
                    <span class="info-value">Supabase (PostgreSQL)</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Baglanti</span>
                    <span class="info-value success" id="dbConnection">Aktif</span>
                </div>
            </div>

            <div class="info-card">
                <h3>üìã Veri Kaynaklari</h3>
                <div class="info-row">
                    <span class="info-label">Moneyway</span>
                    <span class="info-value">arbworld.net</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Dropping Odds</span>
                    <span class="info-value">arbworld.net</span>
                </div>
            </div>
        </div>
    </main>

    <div class="toast" id="toast"></div>

    <script>
        function showPage(pageId) {
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
            });
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            document.getElementById('page-' + pageId).classList.add('active');
            document.querySelector(`[data-page="${pageId}"]`).classList.add('active');

            if (pageId === 'dashboard') loadDashboard();
            if (pageId === 'markets') loadMarkets();
        }

        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast ' + type + ' show';
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        async function loadDashboard() {
            console.log('[Admin] loadDashboard started');
            try {
                const response = await fetch('/api/status?t=' + Date.now());
                console.log('[Admin] Status response:', response.ok);
                if (response.ok) {
                    const data = await response.json();
                    console.log('[Admin] Status data:', data);
                    
                    const lastUpdateEl = document.getElementById('lastUpdate');
                    const supabaseStatusEl = document.getElementById('supabaseStatus');
                    const scraperModeEl = document.getElementById('scraperMode');
                    const workModeEl = document.getElementById('workMode');
                    const dbStatusEl = document.getElementById('dbStatus');
                    
                    if (lastUpdateEl) lastUpdateEl.textContent = data.last_data_update_tr || '-';
                    if (supabaseStatusEl) {
                        supabaseStatusEl.textContent = data.supabase_connected ? 'Bagli' : 'Bagli Degil';
                        supabaseStatusEl.className = 'info-value ' + (data.supabase_connected ? 'success' : 'error');
                    }
                    if (scraperModeEl) scraperModeEl.textContent = data.scraping_enabled ? 'Aktif' : 'Devre Disi';
                    if (workModeEl) workModeEl.textContent = data.mode || 'server';
                    if (dbStatusEl) {
                        dbStatusEl.textContent = data.supabase_connected ? 'OK' : 'Hata';
                        dbStatusEl.className = 'stat-value ' + (data.supabase_connected ? 'green' : 'red');
                    }
                }
            } catch (error) {
                console.error('[Admin] Dashboard yukleme hatasi:', error);
            }

            try {
                const response = await fetch('/api/matches?market=moneyway_1x2&t=' + Date.now());
                console.log('[Admin] Matches response:', response.ok);
                if (response.ok) {
                    const data = await response.json();
                    console.log('[Admin] Matches count:', Array.isArray(data) ? data.length : 0);
                    const totalMatchesEl = document.getElementById('totalMatches');
                    if (totalMatchesEl) totalMatchesEl.textContent = Array.isArray(data) ? data.length : 0;
                }
            } catch (error) {
                console.error('[Admin] Mac sayisi yukleme hatasi:', error);
            }
        }

        async function loadMarkets() {
            const markets = [
                { id: 'mw1x2Count', market: 'moneyway_1x2' },
                { id: 'mwou25Count', market: 'moneyway_ou25' },
                { id: 'mwbttsCount', market: 'moneyway_btts' },
                { id: 'dp1x2Count', market: 'dropping_1x2' },
                { id: 'dpou25Count', market: 'dropping_ou25' },
                { id: 'dpbttsCount', market: 'dropping_btts' }
            ];

            for (const m of markets) {
                try {
                    const response = await fetch(`/api/matches?market=${m.market}`);
                    if (response.ok) {
                        const data = await response.json();
                        document.getElementById(m.id).textContent = Array.isArray(data) ? data.length : 0;
                    }
                } catch (error) {
                    document.getElementById(m.id).textContent = 'Hata';
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadDashboard();
        });
    </script>
</body>
</html>
