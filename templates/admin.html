<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartXFlow Admin Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0d1117;
            color: #c9d1d9;
            min-height: 100vh;
            display: flex;
        }
        .sidebar {
            width: 260px;
            background: #161b22;
            border-right: 1px solid #30363d;
            min-height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            display: flex;
            flex-direction: column;
        }
        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #30363d;
        }
        .sidebar-header h1 {
            color: #58a6ff;
            font-size: 18px;
            font-weight: 600;
        }
        .sidebar-header span {
            color: #8b949e;
            font-size: 11px;
        }
        .sidebar-nav {
            flex: 1;
            padding: 12px 0;
        }
        .nav-category {
            padding: 8px 20px;
            color: #8b949e;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .nav-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            color: #c9d1d9;
            text-decoration: none;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }
        .nav-item:hover {
            background: #21262d;
        }
        .nav-item.active {
            background: #1c2128;
            border-left-color: #58a6ff;
            color: #58a6ff;
        }
        .nav-item-icon {
            font-size: 16px;
            width: 20px;
            text-align: center;
        }
        .sidebar-footer {
            padding: 16px 20px;
            border-top: 1px solid #30363d;
        }
        .back-home {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #8b949e;
            text-decoration: none;
            font-size: 13px;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.2s;
        }
        .back-home:hover {
            background: #21262d;
            color: #58a6ff;
        }
        .main-content {
            margin-left: 260px;
            flex: 1;
            padding: 24px;
            min-height: 100vh;
        }
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid #30363d;
        }
        .page-title {
            color: #f0883e;
            font-size: 22px;
            font-weight: 600;
        }
        .page-subtitle {
            color: #8b949e;
            font-size: 13px;
            margin-top: 4px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        .stat-card {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }
        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #58a6ff;
            margin-bottom: 4px;
        }
        .stat-label {
            color: #8b949e;
            font-size: 13px;
        }
        .stat-value.green { color: #3fb950; }
        .stat-value.orange { color: #f0883e; }
        .stat-value.red { color: #f85149; }
        .info-card {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 16px;
        }
        .info-card h3 {
            color: #58a6ff;
            font-size: 16px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #21262d;
        }
        .info-row:last-child {
            border-bottom: none;
        }
        .info-label {
            color: #8b949e;
        }
        .info-value {
            color: #c9d1d9;
            font-weight: 500;
        }
        .info-value.success { color: #3fb950; }
        .info-value.warning { color: #f0883e; }
        .info-value.error { color: #f85149; }
        .page-content {
            display: none;
        }
        .page-content.active {
            display: block;
        }
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-size: 14px;
            z-index: 1000;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s;
        }
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        .toast.success { background: #238636; }
        .toast.error { background: #da3633; }
        .toast.info { background: #1f6feb; }
        .market-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }
        .market-table th,
        .market-table td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid #21262d;
        }
        .market-table th {
            color: #8b949e;
            font-weight: 500;
            font-size: 12px;
            text-transform: uppercase;
        }
        .market-table td {
            color: #c9d1d9;
        }
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }
        .badge.active { background: rgba(63, 185, 80, 0.2); color: #3fb950; }
        .badge.inactive { background: rgba(139, 148, 158, 0.2); color: #8b949e; }
        
        .header-actions {
            display: flex;
            gap: 10px;
        }
        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-primary { background: #238636; color: white; }
        .btn-primary:hover { background: #2ea043; }
        .btn-warning { background: #9e6a03; color: white; }
        .btn-warning:hover { background: #bb8009; }
        .btn-danger { background: #da3633; color: white; }
        .btn-danger:hover { background: #f85149; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 16px;
        }
        .form-group {
            margin-bottom: 16px;
        }
        .form-group label {
            display: block;
            color: #8b949e;
            font-size: 12px;
            margin-bottom: 6px;
        }
        .form-input {
            width: 100%;
            padding: 10px 12px;
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            color: #c9d1d9;
            font-size: 14px;
        }
        .form-input:focus {
            outline: none;
            border-color: #58a6ff;
        }
        .form-hint {
            color: #8b949e;
            font-size: 12px;
            margin-top: 8px;
        }
        
        .alarm-list {
            max-height: 400px;
            overflow-y: auto;
        }
        .alarm-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid #21262d;
            cursor: pointer;
            transition: background 0.2s;
        }
        .alarm-item:hover {
            background: #21262d;
        }
        .alarm-item:last-child {
            border-bottom: none;
        }
        .alarm-info {
            flex: 1;
        }
        .alarm-match {
            color: #c9d1d9;
            font-weight: 500;
        }
        .alarm-meta {
            color: #8b949e;
            font-size: 12px;
            margin-top: 4px;
        }
        .alarm-score {
            font-size: 18px;
            font-weight: 700;
            color: #f0883e;
            padding: 4px 12px;
            background: rgba(240, 136, 62, 0.15);
            border-radius: 6px;
        }
        
        /* Insider Accordion Styles */
        .insider-accordion-wrapper {
            border-bottom: 1px solid #21262d;
        }
        .insider-accordion-wrapper:last-child {
            border-bottom: none;
        }
        .insider-accordion-wrapper .alarm-item {
            border-bottom: none;
            padding: 10px 16px;
        }
        .insider-accordion-wrapper .alarm-item.expanded {
            background: #1c2128;
            border-bottom: 1px solid #30363d;
        }
        .insider-detail-panel {
            background: #0d1117;
            border-left: 3px solid #a371f7;
            padding: 16px 20px;
            margin-left: 3px;
        }
        .insider-detail-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }
        @media (max-width: 900px) {
            .insider-detail-grid {
                grid-template-columns: 1fr;
            }
        }
        .insider-detail-section {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 14px;
        }
        .insider-detail-title {
            font-size: 12px;
            font-weight: 600;
            color: #a371f7;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .insider-detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #21262d;
        }
        .insider-detail-row:last-child {
            border-bottom: none;
        }
        .insider-detail-label {
            color: #8b949e;
            font-size: 13px;
        }
        .insider-detail-value {
            color: #e6edf3;
            font-size: 14px;
        }
        
        /* Date Filter Button Styles */
        .date-filter-group {
            display: flex;
            gap: 6px;
            align-items: center;
        }
        .date-filter-btn {
            padding: 4px 10px;
            border: 1px solid #30363d;
            border-radius: 6px;
            background: #21262d;
            color: #8b949e;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .date-filter-btn:hover {
            background: #30363d;
            color: #c9d1d9;
        }
        .date-filter-btn.active {
            background: #238636;
            border-color: #238636;
            color: #fff;
        }
        .alarm-total-count {
            color: #8b949e;
            font-size: 11px;
            margin-left: 8px;
        }

        /* Volume Shock Expandable Detail Styles */
        .vs-alarm-wrapper {
            border-bottom: 1px solid #21262d;
        }
        .vs-alarm-wrapper:last-child {
            border-bottom: none;
        }
        .vs-alarm-wrapper .alarm-item {
            border-bottom: none;
        }
        .vs-alarm-detail {
            animation: slideDown 0.2s ease-out;
        }
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .vs-detail-section {
            background: #0d1117;
            border-radius: 6px;
            padding: 10px;
        }
        .vs-detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            font-size: 12px;
        }
        .vs-detail-row:not(:last-child) {
            border-bottom: 1px solid #21262d;
        }
        
        /* Common inline detail styles for all alarm types */
        .detail-row-inline {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            font-size: 12px;
        }
        .detail-row-inline:not(:last-child) {
            border-bottom: 1px solid #21262d;
        }
        
        /* Dropping alarm inline detail wrapper */
        .dropping-alarm-wrapper {
            border-bottom: 1px solid #21262d;
        }
        .dropping-alarm-wrapper:last-child {
            border-bottom: none;
        }
        .dropping-alarm-wrapper .alarm-item {
            border-bottom: none;
        }
        .dropping-alarm-detail {
            animation: slideDown 0.2s ease-out;
        }
        .dropping-detail-section {
            background: #0d1117;
            border-radius: 6px;
            padding: 10px;
        }
        
        /* Volume Leader alarm inline detail wrapper */
        .vl-alarm-wrapper {
            border-bottom: 1px solid #21262d;
        }
        .vl-alarm-wrapper:last-child {
            border-bottom: none;
        }
        .vl-alarm-wrapper .alarm-item {
            border-bottom: none;
        }
        .vl-alarm-detail {
            animation: slideDown 0.2s ease-out;
        }
        .vl-detail-section {
            background: #0d1117;
            border-radius: 6px;
            padding: 10px;
        }
        
        /* Big Money alarm inline detail wrapper */
        .bigmoney-alarm-wrapper {
            border-bottom: 1px solid #21262d;
        }
        .bigmoney-alarm-wrapper:last-child {
            border-bottom: none;
        }
        .bigmoney-alarm-wrapper .alarm-item {
            border-bottom: none;
        }
        .bigmoney-alarm-detail {
            animation: slideDown 0.2s ease-out;
        }
        .bigmoney-detail-section {
            background: #0d1117;
            border-radius: 6px;
            padding: 10px;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 12px;
            width: 90%;
            max-width: 700px;
            max-height: 80vh;
            overflow: hidden;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid #30363d;
        }
        .modal-header h3 {
            color: #58a6ff;
            margin: 0;
        }
        .close-btn {
            background: none;
            border: none;
            color: #8b949e;
            font-size: 24px;
            cursor: pointer;
        }
        .close-btn:hover {
            color: #c9d1d9;
        }
        .modal-body {
            padding: 20px;
            overflow-y: auto;
            max-height: calc(80vh - 60px);
        }
        .detail-section {
            margin-bottom: 20px;
        }
        .detail-section h4 {
            color: #f0883e;
            font-size: 14px;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #21262d;
        }
        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
        }
        .detail-label {
            color: #8b949e;
            font-size: 13px;
        }
        .detail-value {
            color: #c9d1d9;
            font-size: 13px;
            font-weight: 500;
        }
        .detail-value.highlight {
            color: #3fb950;
        }
    </style>
</head>
<body>
    <aside class="sidebar">
        <div class="sidebar-header">
            <h1>SmartXFlow</h1>
            <span>Admin Panel</span>
        </div>
        <nav class="sidebar-nav">
            <div class="nav-category">Sistem</div>
            <div class="nav-item active" onclick="showPage('dashboard')" data-page="dashboard">
                <span class="nav-item-icon">üìä</span>
                <span>Dashboard</span>
            </div>
            <div class="nav-item" onclick="showPage('markets')" data-page="markets">
                <span class="nav-item-icon">üìà</span>
                <span>Market Durumu</span>
            </div>
            <div class="nav-item" onclick="showPage('system')" data-page="system">
                <span class="nav-item-icon">‚öôÔ∏è</span>
                <span>Sistem Bilgisi</span>
            </div>
            <div class="nav-item" onclick="showPage('scraper')" data-page="scraper">
                <span class="nav-item-icon">üîÑ</span>
                <span>Scraper Konsol</span>
            </div>
            <div class="nav-item" onclick="showPage('alarmengine')" data-page="alarmengine">
                <span class="nav-item-icon">üîî</span>
                <span>Alarm Engine</span>
            </div>
            
            <div class="nav-category">Alarmlar</div>
            <div class="nav-item" onclick="showPage('sharp')" data-page="sharp">
                <span class="nav-item-icon">üéØ</span>
                <span>Sharp</span>
            </div>
            <div class="nav-item" onclick="showPage('publicmove')" data-page="publicmove">
                <span class="nav-item-icon">ü™§</span>
                <span>Public Move</span>
            </div>
            <div class="nav-item" onclick="showPage('insider')" data-page="insider">
                <span class="nav-item-icon">üïµÔ∏è</span>
                <span>Insider Info</span>
            </div>
            <div class="nav-item" onclick="showPage('bigmoney')" data-page="bigmoney">
                <span class="nav-item-icon">üí∞</span>
                <span>Big Money</span>
            </div>
            <div class="nav-item" onclick="showPage('dropping')" data-page="dropping">
                <span class="nav-item-icon">üìâ</span>
                <span>Dropping Alert</span>
            </div>
            <div class="nav-item" onclick="showPage('volumeshock')" data-page="volumeshock">
                <span class="nav-item-icon">‚ö°</span>
                <span>Hacim Soku</span>
            </div>
            <div class="nav-item" onclick="showPage('volumeleader')" data-page="volumeleader">
                <span class="nav-item-icon">üëë</span>
                <span>Hacim Lideri</span>
            </div>
            <div class="nav-item" onclick="showPage('mim')" data-page="mim">
                <span class="nav-item-icon">üíé</span>
                <span>MIM</span>
            </div>
            <div class="nav-item" onclick="showPage('telegram')" data-page="telegram">
                <span class="nav-item-icon">üì≤</span>
                <span>Telegram</span>
            </div>
        </nav>
        <div class="sidebar-footer">
            <a href="/" class="back-home">
                <span>‚Üê</span>
                <span>Ana Sayfaya Don</span>
            </a>
        </div>
    </aside>

    <main class="main-content">
        <div id="page-dashboard" class="page-content active">
            <div class="page-header">
                <div>
                    <h2 class="page-title">Dashboard</h2>
                    <p class="page-subtitle">Sistem durumu ve ozet bilgiler</p>
                </div>
            </div>

            <div class="stats-grid" id="dashboardStats">
                <div class="stat-card">
                    <div class="stat-value" id="totalMatches">-</div>
                    <div class="stat-label">Toplam Mac</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value green" id="activeMarkets">6</div>
                    <div class="stat-label">Aktif Market</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value orange" id="lastUpdate">-</div>
                    <div class="stat-label">Son Guncelleme</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="dbStatus">-</div>
                    <div class="stat-label">Supabase Durumu</div>
                </div>
            </div>

            <div class="info-card">
                <h3>üì° Baglanti Durumu</h3>
                <div class="info-row">
                    <span class="info-label">Supabase</span>
                    <span class="info-value success" id="supabaseStatus">Bagli</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Scraper Modu</span>
                    <span class="info-value" id="scraperMode">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Calisma Modu</span>
                    <span class="info-value" id="workMode">-</span>
                </div>
            </div>
        </div>

        <div id="page-markets" class="page-content">
            <div class="page-header">
                <div>
                    <h2 class="page-title">Market Durumu</h2>
                    <p class="page-subtitle">6 market icin veri durumu</p>
                </div>
            </div>

            <div class="info-card">
                <h3>üìä Market Verileri</h3>
                <table class="market-table">
                    <thead>
                        <tr>
                            <th>Market</th>
                            <th>Mac Sayisi</th>
                            <th>Durum</th>
                        </tr>
                    </thead>
                    <tbody id="marketTableBody">
                        <tr>
                            <td>Moneyway 1X2</td>
                            <td id="mw1x2Count">-</td>
                            <td><span class="badge active">Aktif</span></td>
                        </tr>
                        <tr>
                            <td>Moneyway O/U 2.5</td>
                            <td id="mwou25Count">-</td>
                            <td><span class="badge active">Aktif</span></td>
                        </tr>
                        <tr>
                            <td>Moneyway BTTS</td>
                            <td id="mwbttsCount">-</td>
                            <td><span class="badge active">Aktif</span></td>
                        </tr>
                        <tr>
                            <td>Dropping 1X2</td>
                            <td id="dp1x2Count">-</td>
                            <td><span class="badge active">Aktif</span></td>
                        </tr>
                        <tr>
                            <td>Dropping O/U 2.5</td>
                            <td id="dpou25Count">-</td>
                            <td><span class="badge active">Aktif</span></td>
                        </tr>
                        <tr>
                            <td>Dropping BTTS</td>
                            <td id="dpbttsCount">-</td>
                            <td><span class="badge active">Aktif</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="page-sharp" class="page-content">
            <div class="page-header">
                <div>
                    <h2 class="page-title">Sharp</h2>
                    <p class="page-subtitle">Sharp Money alarm ayarlari ve yonetimi</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-danger" onclick="deleteAllAlarms()">Tum Alarmlari Sil</button>
                    <button class="btn btn-warning" onclick="recalculateAlarms()">Alarmlari Yeniden Hesapla</button>
                    <button class="btn" onclick="resetSharpCalculation()" style="background: #f0b429; color: white;">Sifirla</button>
                    <button class="btn btn-primary" onclick="saveSharpConfig()">Kaydet</button>
                    <button class="btn" onclick="deleteAlarmConfig('sharp')" style="background: #6e4000; color: white;">Ayarlari Sil</button>
                </div>
            </div>

            <!-- SHARP ALARM HESAPLAMA ACIKLAMASI -->
            <div class="info-card" style="margin-bottom: 20px; border-left: 4px solid #58a6ff; background: linear-gradient(135deg, #161b22 0%, #1c2128 100%);">
                <div style="display: flex; justify-content: space-between; align-items: center; cursor: pointer;" onclick="toggleSharpExplanation()">
                    <h3 style="margin: 0; color: #58a6ff;">üìñ Sharp Alarm Nasil Hesaplanir?</h3>
                    <span id="sharpExplanationToggle" style="color: #58a6ff; font-size: 20px;">‚ñº</span>
                </div>
                <div id="sharpExplanationContent" style="display: none; margin-top: 15px;">
                    
                    <div style="background: #21262d; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h4 style="color: #f0883e; margin: 0 0 10px 0;">üéØ Sharp Alarm Nedir?</h4>
                        <p style="color: #e6edf3; margin: 0; line-height: 1.6;">
                            Sharp alarm, <strong>"akilli para"</strong> hareketlerini tespit eder. Profesyonel bahis√ßiler (sharps) 
                            bir se√ßime para yatirdiginda genellikle 3 sey ayni anda olur:
                        </p>
                        <ul style="color: #e6edf3; margin: 10px 0 0 0; padding-left: 20px; line-height: 1.8;">
                            <li><strong style="color: #58a6ff;">Hacim Soku:</strong> Ani ve buyuk miktarda para girisi</li>
                            <li><strong style="color: #22c55e;">Oran Dususu:</strong> Bahis sirketi orani dusurur (risk yonetimi)</li>
                            <li><strong style="color: #a78bfa;">Pay Artisi:</strong> O se√ßimin toplam hacimdeki payi artar</li>
                        </ul>
                    </div>

                    <div style="background: #21262d; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h4 style="color: #22c55e; margin: 0 0 10px 0;">üìä Hesaplama Formulu</h4>
                        <div style="background: #0d1117; padding: 12px; border-radius: 6px; font-family: monospace; color: #e6edf3;">
                            <strong style="color: #f0883e;">SHARP SCORE = Volume_Contrib + Odds_Contrib + Share_Contrib</strong>
                        </div>
                        <p style="color: #8b949e; margin: 10px 0 0 0; font-size: 12px;">Maksimum skor: 40 + 35 + 25 = 100 puan</p>
                    </div>

                    <div style="background: #21262d; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 3px solid #f0883e;">
                        <h4 style="color: #f0883e; margin: 0 0 10px 0;">üîÑ Hesaplama Akisi (Her Snapshot Cifti Icin)</h4>
                        <div style="background: #0d1117; padding: 12px; border-radius: 6px; font-family: monospace; font-size: 11px; color: #e6edf3; line-height: 1.8;">
                            <span style="color: #58a6ff;">1.</span> prev_snap ‚Üí curr_snap karsilastir<br>
                            <span style="color: #58a6ff;">2.</span> <strong style="color: #f97316;">curr_snap'taki toplam volume hesapla</strong> (amt1 + amtx + amt2)<br>
                            <span style="color: #58a6ff;">3.</span> <strong style="color: #f97316;">volume >= min_volume mi?</strong><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;‚îú‚îÄ‚îÄ <span style="color: #f87171;">HAYIR</span> ‚Üí Bu snapshot atlanir, sonrakine gec<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;‚îî‚îÄ‚îÄ <span style="color: #22c55e;">EVET</span> ‚Üí Sharp hesaplamasina devam et<br>
                            <span style="color: #58a6ff;">4.</span> amount_change >= min_amount_change mi?<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;‚îú‚îÄ‚îÄ <span style="color: #f87171;">HAYIR</span> ‚Üí Bu snapshot atlanir<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;‚îî‚îÄ‚îÄ <span style="color: #22c55e;">EVET</span> ‚Üí Devam et<br>
                            <span style="color: #58a6ff;">5.</span> Sharp Score hesapla ve tetikleme kosullarini kontrol et
                        </div>
                        <p style="color: #8b949e; margin: 10px 0 0 0; font-size: 11px;">
                            <strong style="color: #f97316;">Onemli:</strong> Volume kontrolu <strong>olay anindaki</strong> (curr_snap) toplam hacme bakar, 
                            macin son durumuna degil. Erken donemdeki dusuk hacimli hareketler gormezden gelinir.
                        </p>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; margin-bottom: 15px;">
                        
                        <div style="background: #21262d; padding: 15px; border-radius: 8px; border-left: 3px solid #58a6ff;">
                            <h5 style="color: #58a6ff; margin: 0 0 10px 0;">1Ô∏è‚É£ Hacim Soku (Volume Shock)</h5>
                            <div style="background: #0d1117; padding: 8px; border-radius: 4px; font-family: monospace; font-size: 11px; color: #e6edf3; margin-bottom: 8px;">
                                amount_change = curr_amt - prev_amt<br>
                                shock_raw = amount_change / avg_prev_5<br>
                                shock_value = shock_raw √ó volume_multiplier<br>
                                <strong style="color: #58a6ff;">volume_contrib = min(shock_value, 40)</strong>
                            </div>
                            <p style="color: #8b949e; margin: 0; font-size: 11px;">
                                <strong>Ornek:</strong> Son 20 snapshot ortalamasi ¬£1000, bu snapshot'ta ¬£3000 geldi<br>
                                ‚Üí shock_raw = 3000/1000 = 3.0 ‚Üí volume_contrib = min(3.0, 40) = 3.0 puan
                            </p>
                        </div>

                        <div style="background: #21262d; padding: 15px; border-radius: 8px; border-left: 3px solid #22c55e;">
                            <h5 style="color: #22c55e; margin: 0 0 10px 0;">2Ô∏è‚É£ Oran Dususu (Odds Drop)</h5>
                            <div style="background: #0d1117; padding: 8px; border-radius: 4px; font-family: monospace; font-size: 11px; color: #e6edf3; margin-bottom: 8px;">
                                drop_pct = ((prev_odds - curr_odds) / prev_odds) √ó 100<br>
                                odds_value = drop_pct √ó odds_multiplier<br>
                                <strong style="color: #22c55e;">odds_contrib = min(odds_value, 35)</strong>
                            </div>
                            <p style="color: #8b949e; margin: 0; font-size: 11px;">
                                <strong>Oran Araligi Carpanlari:</strong><br>
                                1.01-1.50: √ó10 | 1.50-2.10: √ó8 | 2.10-3.50: √ó5 | 3.50+: √ó3<br>
                                <em>Kisa oranlar daha degerli (bookmaker'in emin oldugu oranlar)</em>
                            </p>
                        </div>

                        <div style="background: #21262d; padding: 15px; border-radius: 8px; border-left: 3px solid #a78bfa;">
                            <h5 style="color: #a78bfa; margin: 0 0 10px 0;">3Ô∏è‚É£ Pay Artisi (Share Increase)</h5>
                            <div style="background: #0d1117; padding: 8px; border-radius: 4px; font-family: monospace; font-size: 11px; color: #e6edf3; margin-bottom: 8px;">
                                share_diff = curr_share - prev_share<br>
                                share_value = share_diff √ó share_multiplier<br>
                                <strong style="color: #a78bfa;">share_contrib = min(share_value, 25)</strong>
                            </div>
                            <p style="color: #8b949e; margin: 0; font-size: 11px;">
                                <strong>Pay Araligi Carpanlari:</strong><br>
                                0-50%: √ó1 | 50-75%: √ó1.5 | 75-90%: √ó2 | 90-100%: √ó3<br>
                                <em>Yuksek pay = daha fazla etki (dominant se√ßim)</em>
                            </p>
                        </div>
                    </div>

                    <div style="background: #21262d; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h4 style="color: #f97316; margin: 0 0 10px 0;">‚ö° Alarm Tetikleme Kosullari</h4>
                        <p style="color: #e6edf3; margin: 0 0 10px 0;">Alarm tetiklenmesi icin <strong>TUM</strong> kosullar saglanmali:</p>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                            <div style="background: #0d1117; padding: 10px; border-radius: 6px;">
                                <span style="color: #22c55e;">‚úì</span> <span style="color: #e6edf3;">curr_share >= min_share (%5)</span>
                            </div>
                            <div style="background: #0d1117; padding: 10px; border-radius: 6px;">
                                <span style="color: #22c55e;">‚úì</span> <span style="color: #e6edf3;">shock_value > 0 (para girisi var)</span>
                            </div>
                            <div style="background: #0d1117; padding: 10px; border-radius: 6px;">
                                <span style="color: #22c55e;">‚úì</span> <span style="color: #e6edf3;">odds_value > 0 (oran dustu)</span>
                            </div>
                            <div style="background: #0d1117; padding: 10px; border-radius: 6px;">
                                <span style="color: #f97316;">‚úì</span> <span style="color: #e6edf3;">drop_pct >= min_drop_threshold</span>
                            </div>
                            <div style="background: #0d1117; padding: 10px; border-radius: 6px;">
                                <span style="color: #22c55e;">‚úì</span> <span style="color: #e6edf3;">share_value > 0 (pay artti)</span>
                            </div>
                            <div style="background: #0d1117; padding: 10px; border-radius: 6px;">
                                <span style="color: #f0883e;">‚òÖ</span> <span style="color: #e6edf3;">sharp_score >= min_sharp_score</span>
                            </div>
                        </div>
                        <p style="color: #8b949e; margin: 10px 0 0 0; font-size: 11px;">
                            <strong style="color: #f97316;">Min Drop %:</strong> Her oran araliginda farkli minimum oran dususu esigi vardir. 
                            Ornek: 1.01-1.50 araligi icin %1, 3.50+ icin %5 olabilir.
                        </p>
                    </div>

                    <div style="background: #21262d; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h4 style="color: #58a6ff; margin: 0 0 10px 0;">üïê Zaman Kurallari</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 10px;">
                            <div style="background: #0d1117; padding: 10px; border-radius: 6px;">
                                <span style="color: #f97316;">‚è∞</span> <span style="color: #e6edf3;"><strong>Prematch Only:</strong> D-2+ (eski) maclar hari√ß</span>
                            </div>
                            <div style="background: #0d1117; padding: 10px; border-radius: 6px;">
                                <span style="color: #f97316;">‚è∞</span> <span style="color: #e6edf3;"><strong>2 Saat Kurali:</strong> Maca <2 saat kala Sharp hesaplanmaz</span>
                            </div>
                        </div>
                        <p style="color: #8b949e; margin: 10px 0 0 0; font-size: 11px;">
                            <em>Not: Maca son 2 saat kala hesaplama icin "Public Move" (Halk Tuzagi) alarm sistemini kullanin.</em>
                        </p>
                    </div>

                    <div style="background: linear-gradient(135deg, #1a2332 0%, #21262d 100%); padding: 15px; border-radius: 8px; border: 1px solid #30363d;">
                        <h4 style="color: #f0883e; margin: 0 0 10px 0;">üí° Ornek Hesaplama</h4>
                        <div style="color: #e6edf3; line-height: 1.8; font-size: 13px;">
                            <strong>Mac:</strong> Arsenal vs Chelsea | <strong>Secim:</strong> 1 (Arsenal)<br>
                            <strong>Onceki snapshot:</strong> Odds=1.85, Share=42%, Amount=¬£5000<br>
                            <strong>Simdi:</strong> Odds=1.72, Share=48%, Amount=¬£8500<br><br>
                            
                            <div style="background: #0d1117; padding: 10px; border-radius: 6px; font-family: monospace; font-size: 11px;">
                                1. <span style="color: #58a6ff;">Hacim Soku:</span> (8500-5000)/5000 = 0.7 √ó 1.0 = 0.7 ‚Üí <strong>min(0.7, 40) = 0.7</strong><br>
                                2. <span style="color: #22c55e;">Oran Dususu:</span> ((1.85-1.72)/1.85)√ó100 = 7.03% √ó 8 = 56.2 ‚Üí <strong>min(56.2, 35) = 35</strong><br>
                                3. <span style="color: #a78bfa;">Pay Artisi:</span> (48-42) = 6% √ó 1.0 = 6 ‚Üí <strong>min(6, 25) = 6</strong><br><br>
                                <span style="color: #f0883e; font-size: 13px;"><strong>SHARP SCORE = 0.7 + 35 + 6 = 41.7 puan</strong></span>
                            </div>
                            <p style="color: #22c55e; margin: 10px 0 0 0;">
                                ‚úì Eger min_sharp_score=40 ise ‚Üí <strong>ALARM TETIKLENIR!</strong>
                            </p>
                        </div>
                    </div>

                </div>
            </div>
            <script>
                function toggleSharpExplanation() {
                    const content = document.getElementById('sharpExplanationContent');
                    const toggle = document.getElementById('sharpExplanationToggle');
                    if (content.style.display === 'none') {
                        content.style.display = 'block';
                        toggle.textContent = '‚ñ≤';
                    } else {
                        content.style.display = 'none';
                        toggle.textContent = '‚ñº';
                    }
                }
            </script>
            <!-- SHARP ALARM HESAPLAMA ACIKLAMASI SONU -->

            <div class="config-grid">
                <div class="info-card">
                    <h3>üìä Minimum Market Volume Esikleri</h3>
                    <div class="form-group">
                        <label>1X2 Minimum Volume</label>
                        <input type="number" id="min_volume_1x2" value="3000" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>O/U 2.5 Minimum Volume</label>
                        <input type="number" id="min_volume_ou25" value="1000" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>BTTS Minimum Volume</label>
                        <input type="number" id="min_volume_btts" value="500" class="form-input">
                    </div>
                    <div class="form-group" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #30363d;">
                        <label>üí∞ Gelen Para Volume (min)</label>
                        <input type="number" id="min_amount_change" value="500" class="form-input">
                        <p class="form-hint" style="font-size: 11px; color: #8b949e; margin-top: 4px;">Son snapshot'ta gelen para bu degerden dusukse sharp hesaplanmaz</p>
                    </div>
                </div>

                <div class="info-card">
                    <h3>‚úñÔ∏è Carpanlar</h3>
                    <div class="form-group">
                        <label>Hacim Carpani (volume_multiplier)</label>
                        <input type="number" id="volume_multiplier" value="1" step="0.1" class="form-input">
                    </div>
                </div>
                
                <div class="info-card">
                    <h3>üìà Pay Araligi Carpanlari</h3>
                    <p class="form-hint" style="margin-bottom: 12px; color: #8b949e; font-size: 11px;">Her pay (share %) araligi icin farkli carpan. Pay bu aralikta ise o carpan kullanilir.</p>
                    
                    <div style="background: #161b22; padding: 10px; border-radius: 6px; margin-bottom: 10px;">
                        <label style="color: #22c55e; font-weight: 600; font-size: 12px;">Aralik 1 (Dusuk Pay)</label>
                        <div style="display: flex; gap: 8px; margin-top: 6px;">
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Min (%)</label>
                                <input type="number" id="share_range_1_min" value="0" step="1" class="form-input" style="font-size: 12px;">
                            </div>
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Max (%)</label>
                                <input type="number" id="share_range_1_max" value="50" step="1" class="form-input" style="font-size: 12px;">
                            </div>
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Carpan</label>
                                <input type="number" id="share_range_1_mult" value="1" step="0.1" class="form-input" style="font-size: 12px;">
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: #161b22; padding: 10px; border-radius: 6px; margin-bottom: 10px;">
                        <label style="color: #58a6ff; font-weight: 600; font-size: 12px;">Aralik 2 (Orta Pay)</label>
                        <div style="display: flex; gap: 8px; margin-top: 6px;">
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Min (%)</label>
                                <input type="number" id="share_range_2_min" value="50" step="1" class="form-input" style="font-size: 12px;">
                            </div>
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Max (%)</label>
                                <input type="number" id="share_range_2_max" value="75" step="1" class="form-input" style="font-size: 12px;">
                            </div>
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Carpan</label>
                                <input type="number" id="share_range_2_mult" value="1.5" step="0.1" class="form-input" style="font-size: 12px;">
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: #161b22; padding: 10px; border-radius: 6px; margin-bottom: 10px;">
                        <label style="color: #a78bfa; font-weight: 600; font-size: 12px;">Aralik 3 (Yuksek Pay)</label>
                        <div style="display: flex; gap: 8px; margin-top: 6px;">
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Min (%)</label>
                                <input type="number" id="share_range_3_min" value="75" step="1" class="form-input" style="font-size: 12px;">
                            </div>
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Max (%)</label>
                                <input type="number" id="share_range_3_max" value="90" step="1" class="form-input" style="font-size: 12px;">
                            </div>
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Carpan</label>
                                <input type="number" id="share_range_3_mult" value="2" step="0.1" class="form-input" style="font-size: 12px;">
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: #161b22; padding: 10px; border-radius: 6px;">
                        <label style="color: #f97316; font-weight: 600; font-size: 12px;">Aralik 4 (Cok Yuksek Pay)</label>
                        <div style="display: flex; gap: 8px; margin-top: 6px;">
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Min (%)</label>
                                <input type="number" id="share_range_4_min" value="90" step="1" class="form-input" style="font-size: 12px;">
                            </div>
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Max (%)</label>
                                <input type="number" id="share_range_4_max" value="100" step="1" class="form-input" style="font-size: 12px;">
                            </div>
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Carpan</label>
                                <input type="number" id="share_range_4_mult" value="3" step="0.1" class="form-input" style="font-size: 12px;">
                            </div>
                        </div>
                    </div>
                    <p class="form-hint" style="margin-top: 8px; color: #8b949e; font-size: 10px;">Pay degeri bu araliklara gore carpanla cogaltilir. Yuksek pay = yuksek etki.</p>
                </div>
                
                <div class="info-card">
                    <h3>üìä Oran Araligi Carpanlari ve Min Drop Esikleri</h3>
                    <p class="form-hint" style="margin-bottom: 12px; color: #8b949e; font-size: 11px;">Her oran araligi icin carpan ve min oran dususu esigi.</p>
                    
                    <div style="background: #161b22; padding: 10px; border-radius: 6px; margin-bottom: 10px;">
                        <label style="color: #58a6ff; font-weight: 600; font-size: 12px;">Aralik 1 (Kisa)</label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 6px; margin-top: 6px;">
                            <div>
                                <label style="font-size: 9px; color: #8b949e;">Min</label>
                                <input type="number" id="odds_range_1_min" value="1.01" step="0.01" class="form-input" style="font-size: 11px; padding: 6px;">
                            </div>
                            <div>
                                <label style="font-size: 9px; color: #8b949e;">Max</label>
                                <input type="number" id="odds_range_1_max" value="1.50" step="0.01" class="form-input" style="font-size: 11px; padding: 6px;">
                            </div>
                            <div>
                                <label style="font-size: 9px; color: #8b949e;">Carp</label>
                                <input type="number" id="odds_range_1_mult" value="10" step="0.1" class="form-input" style="font-size: 11px; padding: 6px;">
                            </div>
                            <div>
                                <label style="font-size: 9px; color: #f97316;">Drop%</label>
                                <input type="number" id="odds_range_1_min_drop" value="1" step="0.1" class="form-input" style="font-size: 11px; padding: 6px; border-color: #f97316;">
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: #161b22; padding: 10px; border-radius: 6px; margin-bottom: 10px;">
                        <label style="color: #a78bfa; font-weight: 600; font-size: 12px;">Aralik 2 (Orta)</label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 6px; margin-top: 6px;">
                            <div>
                                <label style="font-size: 9px; color: #8b949e;">Min</label>
                                <input type="number" id="odds_range_2_min" value="1.50" step="0.01" class="form-input" style="font-size: 11px; padding: 6px;">
                            </div>
                            <div>
                                <label style="font-size: 9px; color: #8b949e;">Max</label>
                                <input type="number" id="odds_range_2_max" value="2.10" step="0.01" class="form-input" style="font-size: 11px; padding: 6px;">
                            </div>
                            <div>
                                <label style="font-size: 9px; color: #8b949e;">Carp</label>
                                <input type="number" id="odds_range_2_mult" value="8" step="0.1" class="form-input" style="font-size: 11px; padding: 6px;">
                            </div>
                            <div>
                                <label style="font-size: 9px; color: #f97316;">Drop%</label>
                                <input type="number" id="odds_range_2_min_drop" value="2" step="0.1" class="form-input" style="font-size: 11px; padding: 6px; border-color: #f97316;">
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: #161b22; padding: 10px; border-radius: 6px; margin-bottom: 10px;">
                        <label style="color: #22c55e; font-weight: 600; font-size: 12px;">Aralik 3 (Yuksek)</label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 6px; margin-top: 6px;">
                            <div>
                                <label style="font-size: 9px; color: #8b949e;">Min</label>
                                <input type="number" id="odds_range_3_min" value="2.10" step="0.01" class="form-input" style="font-size: 11px; padding: 6px;">
                            </div>
                            <div>
                                <label style="font-size: 9px; color: #8b949e;">Max</label>
                                <input type="number" id="odds_range_3_max" value="3.50" step="0.01" class="form-input" style="font-size: 11px; padding: 6px;">
                            </div>
                            <div>
                                <label style="font-size: 9px; color: #8b949e;">Carp</label>
                                <input type="number" id="odds_range_3_mult" value="5" step="0.1" class="form-input" style="font-size: 11px; padding: 6px;">
                            </div>
                            <div>
                                <label style="font-size: 9px; color: #f97316;">Drop%</label>
                                <input type="number" id="odds_range_3_min_drop" value="3" step="0.1" class="form-input" style="font-size: 11px; padding: 6px; border-color: #f97316;">
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: #161b22; padding: 10px; border-radius: 6px;">
                        <label style="color: #f97316; font-weight: 600; font-size: 12px;">Aralik 4 (Cok Yuksek)</label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 6px; margin-top: 6px;">
                            <div>
                                <label style="font-size: 9px; color: #8b949e;">Min</label>
                                <input type="number" id="odds_range_4_min" value="3.50" step="0.01" class="form-input" style="font-size: 11px; padding: 6px;">
                            </div>
                            <div>
                                <label style="font-size: 9px; color: #8b949e;">Max</label>
                                <input type="number" id="odds_range_4_max" value="10.00" step="0.01" class="form-input" style="font-size: 11px; padding: 6px;">
                            </div>
                            <div>
                                <label style="font-size: 9px; color: #8b949e;">Carp</label>
                                <input type="number" id="odds_range_4_mult" value="3" step="0.1" class="form-input" style="font-size: 11px; padding: 6px;">
                            </div>
                            <div>
                                <label style="font-size: 9px; color: #f97316;">Drop%</label>
                                <input type="number" id="odds_range_4_min_drop" value="5" step="0.1" class="form-input" style="font-size: 11px; padding: 6px; border-color: #f97316;">
                            </div>
                        </div>
                    </div>
                    <p class="form-hint" style="margin-top: 8px; color: #8b949e; font-size: 10px;"><strong style="color: #f97316;">Drop%:</strong> Min oran dususu esigi. Bu degerden dusuk drop varsa alarm tetiklenmez.</p>
                </div>

                <div class="info-card">
                    <h3>üìà Maksimum Degerler (CAP)</h3>
                    <div class="form-group">
                        <label>Hacim Soku Maks (max_volume_cap)</label>
                        <input type="number" id="max_volume_cap" value="40" min="0" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>Oran Degisimi Maks (max_odds_cap)</label>
                        <input type="number" id="max_odds_cap" value="35" min="0" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>Pay Degisimi Maks (max_share_cap)</label>
                        <input type="number" id="max_share_cap" value="25" min="0" class="form-input">
                    </div>
                    <p class="form-hint">Her kriter bu degerle sinirlanir. Ornek: shock=50 ‚Üí cap=40 ise kullanilan=40</p>
                </div>

                <div class="info-card">
                    <h3>üéØ Esik Degerleri</h3>
                    <div class="form-group">
                        <label>Minimum Pay (min_share %)</label>
                        <input type="number" id="min_share" value="5" step="0.1" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>Minimum Sharp Skoru (min_sharp_score)</label>
                        <input type="number" id="min_sharp_score" value="10" step="0.1" class="form-input">
                    </div>
                </div>

            </div>

            <div class="info-card" style="margin-top: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
                    <h3 style="margin: 0;">üîî Sharp Alarmlar <span id="alarmCount" class="badge active">0</span> <span id="alarmTotalCount" class="alarm-total-count"></span></h3>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <div class="date-filter-group">
                            <button class="date-filter-btn" onclick="setDateFilter('sharp', 'yesterday')">D√ºn</button>
                            <button class="date-filter-btn" onclick="setDateFilter('sharp', 'today')">Bug√ºn</button>
                            <button class="date-filter-btn" onclick="setDateFilter('sharp', 'future')">Gelecek</button>
                            <button class="date-filter-btn active" onclick="setDateFilter('sharp', 'all')">T√ºm√º</button>
                        </div>
                        <input type="hidden" id="alarmDateFilter" value="">
                        <div style="position: relative;">
                            <input type="text" id="alarmSearchInput" placeholder="Takim ara..." 
                                   oninput="filterAlarms()" 
                                   style="padding: 8px 12px 8px 32px; background: #21262d; border: 1px solid #30363d; border-radius: 6px; color: #e6edf3; font-size: 13px; width: 160px;">
                            <svg style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); stroke: #8b949e;" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
                            </svg>
                        </div>
                    </div>
                </div>
                <div id="calcStatus" style="display: none; padding: 15px; margin-bottom: 15px; background: #1c2128; border-radius: 8px; border-left: 4px solid #f0883e;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="spinner" style="width: 20px; height: 20px; border: 3px solid #30363d; border-top-color: #f0883e; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                        <span id="calcProgress" style="color: #f0883e; font-weight: 500;">Hesaplama devam ediyor...</span>
                    </div>
                </div>
                <div id="alarmList" class="alarm-list">
                    <p style="color: #8b949e; padding: 20px 0; text-align: center;">Henuz alarm yok. Ayarlari kaydedip "Alarmlari Yeniden Hesapla" butonuna basin.</p>
                </div>
            </div>
            <style>
                @keyframes spin { to { transform: rotate(360deg); } }
            </style>

            <div id="alarmDetailModal" class="modal" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Alarm Detaylari</h3>
                        <button class="close-btn" onclick="closeAlarmModal()">&times;</button>
                    </div>
                    <div class="modal-body" id="alarmDetailBody">
                    </div>
                </div>
            </div>
        </div>

        <!-- PUBLIC MOVE PAGE -->
        <div id="page-publicmove" class="page-content">
            <div class="page-header">
                <div>
                    <h2 class="page-title" style="color: #FFD700;">ü™§ Public Move</h2>
                    <p class="page-subtitle">Sadece maca son 2 saat kala hareketleri inceler</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-danger" onclick="deleteAllPublicMoveAlarms()">Tum Alarmlari Sil</button>
                    <button class="btn btn-warning" onclick="recalculatePublicMoveAlarms()">Alarmlari Yeniden Hesapla</button>
                    <button class="btn" onclick="resetPublicMoveCalculation()" style="background: #f0b429; color: white;">Sifirla</button>
                    <button class="btn btn-primary" onclick="savePublicMoveConfig()">Kaydet</button>
                    <button class="btn" onclick="deleteAlarmConfig('publicmove')" style="background: #6e4000; color: white;">Ayarlari Sil</button>
                </div>
            </div>

            <div class="config-grid">
                <div class="info-card" style="border-left: 3px solid #FFD700;">
                    <h3>üìä Minimum Market Volume Esikleri</h3>
                    <div class="form-group">
                        <label>1X2 Minimum Volume</label>
                        <input type="number" id="ht_min_volume_1x2" value="3000" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>O/U 2.5 Minimum Volume</label>
                        <input type="number" id="ht_min_volume_ou25" value="1000" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>BTTS Minimum Volume</label>
                        <input type="number" id="ht_min_volume_btts" value="500" class="form-input">
                    </div>
                    <div class="form-group" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #30363d;">
                        <label>üí∞ Gelen Para Volume (min)</label>
                        <input type="number" id="ht_min_amount_change" value="500" class="form-input">
                        <p class="form-hint" style="font-size: 11px; color: #8b949e; margin-top: 4px;">Son snapshot'ta gelen para bu degerden dusukse hesaplanmaz</p>
                    </div>
                </div>

                <div class="info-card">
                    <h3>‚úñÔ∏è Carpanlar</h3>
                    <div class="form-group">
                        <label>Hacim Carpani (volume_multiplier)</label>
                        <input type="number" id="ht_volume_multiplier" value="1" step="0.1" class="form-input">
                    </div>
                </div>
                
                <div class="info-card">
                    <h3>üìà Pay Araligi Carpanlari</h3>
                    <p class="form-hint" style="margin-bottom: 12px; color: #8b949e; font-size: 11px;">Her pay (share %) araligi icin farkli carpan.</p>
                    
                    <div style="background: #161b22; padding: 10px; border-radius: 6px; margin-bottom: 10px;">
                        <label style="color: #22c55e; font-weight: 600; font-size: 12px;">Aralik 1 (Dusuk Pay)</label>
                        <div style="display: flex; gap: 8px; margin-top: 6px;">
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Min (%)</label>
                                <input type="number" id="ht_share_range_1_min" value="0" step="1" class="form-input" style="font-size: 12px;">
                            </div>
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Max (%)</label>
                                <input type="number" id="ht_share_range_1_max" value="50" step="1" class="form-input" style="font-size: 12px;">
                            </div>
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Carpan</label>
                                <input type="number" id="ht_share_range_1_mult" value="1" step="0.1" class="form-input" style="font-size: 12px;">
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: #161b22; padding: 10px; border-radius: 6px; margin-bottom: 10px;">
                        <label style="color: #58a6ff; font-weight: 600; font-size: 12px;">Aralik 2 (Orta Pay)</label>
                        <div style="display: flex; gap: 8px; margin-top: 6px;">
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Min (%)</label>
                                <input type="number" id="ht_share_range_2_min" value="50" step="1" class="form-input" style="font-size: 12px;">
                            </div>
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Max (%)</label>
                                <input type="number" id="ht_share_range_2_max" value="75" step="1" class="form-input" style="font-size: 12px;">
                            </div>
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Carpan</label>
                                <input type="number" id="ht_share_range_2_mult" value="1.5" step="0.1" class="form-input" style="font-size: 12px;">
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: #161b22; padding: 10px; border-radius: 6px; margin-bottom: 10px;">
                        <label style="color: #a78bfa; font-weight: 600; font-size: 12px;">Aralik 3 (Yuksek Pay)</label>
                        <div style="display: flex; gap: 8px; margin-top: 6px;">
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Min (%)</label>
                                <input type="number" id="ht_share_range_3_min" value="75" step="1" class="form-input" style="font-size: 12px;">
                            </div>
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Max (%)</label>
                                <input type="number" id="ht_share_range_3_max" value="90" step="1" class="form-input" style="font-size: 12px;">
                            </div>
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Carpan</label>
                                <input type="number" id="ht_share_range_3_mult" value="2" step="0.1" class="form-input" style="font-size: 12px;">
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: #161b22; padding: 10px; border-radius: 6px;">
                        <label style="color: #f97316; font-weight: 600; font-size: 12px;">Aralik 4 (Cok Yuksek Pay)</label>
                        <div style="display: flex; gap: 8px; margin-top: 6px;">
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Min (%)</label>
                                <input type="number" id="ht_share_range_4_min" value="90" step="1" class="form-input" style="font-size: 12px;">
                            </div>
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Max (%)</label>
                                <input type="number" id="ht_share_range_4_max" value="100" step="1" class="form-input" style="font-size: 12px;">
                            </div>
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Carpan</label>
                                <input type="number" id="ht_share_range_4_mult" value="3" step="0.1" class="form-input" style="font-size: 12px;">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="info-card">
                    <h3>üìä Oran Araligi Carpanlari</h3>
                    <p class="form-hint" style="margin-bottom: 12px; color: #8b949e; font-size: 11px;">Her oran araligi icin farkli carpan.</p>
                    
                    <div style="background: #161b22; padding: 10px; border-radius: 6px; margin-bottom: 10px;">
                        <label style="color: #58a6ff; font-weight: 600; font-size: 12px;">Aralik 1</label>
                        <div style="display: flex; gap: 8px; margin-top: 6px;">
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Min</label>
                                <input type="number" id="ht_odds_range_1_min" value="1.01" step="0.01" class="form-input" style="font-size: 12px;">
                            </div>
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Max</label>
                                <input type="number" id="ht_odds_range_1_max" value="1.50" step="0.01" class="form-input" style="font-size: 12px;">
                            </div>
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Carpan</label>
                                <input type="number" id="ht_odds_range_1_mult" value="10" step="0.1" class="form-input" style="font-size: 12px;">
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: #161b22; padding: 10px; border-radius: 6px; margin-bottom: 10px;">
                        <label style="color: #a78bfa; font-weight: 600; font-size: 12px;">Aralik 2</label>
                        <div style="display: flex; gap: 8px; margin-top: 6px;">
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Min</label>
                                <input type="number" id="ht_odds_range_2_min" value="1.50" step="0.01" class="form-input" style="font-size: 12px;">
                            </div>
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Max</label>
                                <input type="number" id="ht_odds_range_2_max" value="2.10" step="0.01" class="form-input" style="font-size: 12px;">
                            </div>
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Carpan</label>
                                <input type="number" id="ht_odds_range_2_mult" value="8" step="0.1" class="form-input" style="font-size: 12px;">
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: #161b22; padding: 10px; border-radius: 6px; margin-bottom: 10px;">
                        <label style="color: #22c55e; font-weight: 600; font-size: 12px;">Aralik 3</label>
                        <div style="display: flex; gap: 8px; margin-top: 6px;">
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Min</label>
                                <input type="number" id="ht_odds_range_3_min" value="2.10" step="0.01" class="form-input" style="font-size: 12px;">
                            </div>
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Max</label>
                                <input type="number" id="ht_odds_range_3_max" value="3.50" step="0.01" class="form-input" style="font-size: 12px;">
                            </div>
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Carpan</label>
                                <input type="number" id="ht_odds_range_3_mult" value="5" step="0.1" class="form-input" style="font-size: 12px;">
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: #161b22; padding: 10px; border-radius: 6px;">
                        <label style="color: #f97316; font-weight: 600; font-size: 12px;">Aralik 4</label>
                        <div style="display: flex; gap: 8px; margin-top: 6px;">
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Min</label>
                                <input type="number" id="ht_odds_range_4_min" value="3.50" step="0.01" class="form-input" style="font-size: 12px;">
                            </div>
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Max</label>
                                <input type="number" id="ht_odds_range_4_max" value="10.00" step="0.01" class="form-input" style="font-size: 12px;">
                            </div>
                            <div style="flex: 1;">
                                <label style="font-size: 10px; color: #8b949e;">Carpan</label>
                                <input type="number" id="ht_odds_range_4_mult" value="3" step="0.1" class="form-input" style="font-size: 12px;">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="info-card">
                    <h3>üìà Maksimum Degerler (CAP)</h3>
                    <div class="form-group">
                        <label>Hacim Soku Maks (max_volume_cap)</label>
                        <input type="number" id="ht_max_volume_cap" value="40" min="0" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>Oran Degisimi Maks (max_odds_cap)</label>
                        <input type="number" id="ht_max_odds_cap" value="35" min="0" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>Pay Degisimi Maks (max_share_cap)</label>
                        <input type="number" id="ht_max_share_cap" value="25" min="0" class="form-input">
                    </div>
                </div>

                <div class="info-card">
                    <h3>üéØ Esik Degerleri</h3>
                    <div class="form-group">
                        <label>Minimum Pay (min_share %)</label>
                        <input type="number" id="ht_min_share" value="5" step="0.1" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>Minimum Skor (min_sharp_score)</label>
                        <input type="number" id="ht_min_sharp_score" value="10" step="0.1" class="form-input">
                    </div>
                </div>

            </div>

            <div class="info-card" style="margin-top: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
                    <h3 style="margin: 0;">ü™§ Public Move Alarmlarƒ± <span id="htAlarmCount" class="badge active">0</span> <span id="htAlarmTotalCount" class="alarm-total-count"></span></h3>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <div class="date-filter-group">
                            <button class="date-filter-btn" onclick="setDateFilter('ht', 'yesterday')">D√ºn</button>
                            <button class="date-filter-btn" onclick="setDateFilter('ht', 'today')">Bug√ºn</button>
                            <button class="date-filter-btn" onclick="setDateFilter('ht', 'future')">Gelecek</button>
                            <button class="date-filter-btn active" onclick="setDateFilter('ht', 'all')">T√ºm√º</button>
                        </div>
                        <input type="hidden" id="htAlarmDateFilter" value="">
                        <div style="position: relative;">
                            <input type="text" id="htAlarmSearchInput" placeholder="Takim ara..." 
                                   oninput="filterPublicMoveAlarms()" 
                                   style="padding: 8px 12px 8px 32px; background: #21262d; border: 1px solid #30363d; border-radius: 6px; color: #e6edf3; font-size: 13px; width: 160px;">
                            <svg style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); stroke: #8b949e;" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
                            </svg>
                        </div>
                    </div>
                </div>
                <div id="htCalcStatus" style="display: none; padding: 15px; margin-bottom: 15px; background: #1c2128; border-radius: 8px; border-left: 4px solid #FFD700;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="spinner" style="width: 20px; height: 20px; border: 3px solid #30363d; border-top-color: #FFD700; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                        <span id="htCalcProgress" style="color: #FFD700; font-weight: 500;">Hesaplama devam ediyor...</span>
                    </div>
                </div>
                <div id="htAlarmList" class="alarm-list">
                    <p style="color: #8b949e; padding: 20px 0; text-align: center;">Henuz alarm yok. Ayarlari kaydedip "Alarmlari Yeniden Hesapla" butonuna basin.</p>
                </div>
            </div>
        </div>

        <!-- INSIDER INFO PAGE -->
        <div id="page-insider" class="page-content">
            <div class="page-header">
                <div>
                    <h2 class="page-title" style="color: #a371f7;">üïµÔ∏è Insider Info</h2>
                    <p class="page-subtitle">Dusuk hacim soku + yuksek oran dususu = Iceriden bilgi sezgisi</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-danger" onclick="deleteAllInsiderAlarms()">Tum Insider Alarmlari Sil</button>
                    <button class="btn" onclick="recalculateInsiderAlarms()" style="background: linear-gradient(135deg, #a371f7, #8b5cf6); color: white;">üïµÔ∏è Insider Hesapla</button>
                    <button class="btn" onclick="resetInsiderCalculation()" style="background: #f0b429; color: white;">Sifirla</button>
                    <button class="btn btn-primary" onclick="saveInsiderConfig()">Kaydet</button>
                    <button class="btn" onclick="deleteAlarmConfig('insider')" style="background: #6e4000; color: white;">Ayarlari Sil</button>
                </div>
            </div>

            <div class="config-grid">
                <div class="info-card" style="border-left: 3px solid #a371f7;">
                    <h3>üïµÔ∏è Insider Info Alarm Ayarlari</h3>
                    <p class="form-hint" style="font-size: 12px; color: #8b949e; margin-bottom: 15px;">
                        Acili≈ü‚Üí≈ûimdi oran dususu + dusus ani etrafinda sessiz hareket = Insider bilgisi suphesi<br>
                        <strong>Yeni Mantik:</strong> Acilis‚ÜíSimdi dusus >= Esik VE dusus aninin etrafindaki snapshotlarda HacimSok &lt; Esik, GelenPara &lt; MaxPara
                    </p>
                    <div class="form-group">
                        <label>Hacim Sok Esigi</label>
                        <input type="number" id="insider_hacim_sok_esigi" value="2" step="0.1" class="form-input">
                        <p class="form-hint" style="font-size: 10px; color: #8b949e;">Dusus ani etrafindaki snapshotlarda HacimSok bu degerden DUSUK olmali</p>
                    </div>
                    <div class="form-group">
                        <label>Oran Dusus Esigi (%)</label>
                        <input type="number" id="insider_oran_dusus_esigi" value="3" step="0.1" class="form-input">
                        <p class="form-hint" style="font-size: 10px; color: #8b949e;">Acilis‚ÜíSimdi oran dususu bu degere ESIT veya YUKSEK olmali</p>
                    </div>
                    <div class="form-group">
                        <label>Kontrol Snapshot Sayisi</label>
                        <input type="number" id="insider_sure_dakika" value="30" step="10" min="10" class="form-input">
                        <p class="form-hint" style="font-size: 10px; color: #8b949e;">Dusus aninin etrafinda kontrol edilecek snapshot sayisi (7 = 3 once + 1 dusus + 3 sonra)</p>
                    </div>
                    <div class="form-group">
                        <label>Max Para (¬£)</label>
                        <input type="number" id="insider_max_para" value="5000" step="500" class="form-input">
                        <p class="form-hint" style="font-size: 10px; color: #8b949e;">Dusus ani etrafindaki snapshotlarda GelenPara bu degerden DUSUK olmali</p>
                    </div>
                    <div class="form-group">
                        <label>Max Oran Esigi</label>
                        <input type="number" id="insider_max_odds_esigi" value="10.0" step="0.01" min="1.0" class="form-input" inputmode="decimal" lang="en">
                        <p class="form-hint" style="font-size: 10px; color: #8b949e;">Secenegin orani bu degerden YUKSEKSE elenir (ornek: 2.2)</p>
                    </div>
                </div>

                <div class="info-card">
                    <h3>üìñ Nasil Calisir?</h3>
                    <div style="font-size: 12px; color: #8b949e; line-height: 1.6;">
                        <p><strong style="color: #a371f7;">1. Acilis‚ÜíSimdi Dusus:</strong> Oranlar acilistan bugune >= %X dusmus mu?</p>
                        <p><strong style="color: #f0883e;">2. Dusus Anini Bul:</strong> En buyuk tek seferlik dususun oldugu snapshot</p>
                        <p><strong style="color: #58a6ff;">3. Etraf Snapshotlari:</strong> Dusus aninin etrafindaki N snapshot'a bak</p>
                        <p><strong style="color: #3fb950;">4. Sessiz Hareket:</strong> Bu snapshotlarda HacimSok &lt; Esik VE GelenPara &lt; MaxPara</p>
                        <div style="margin-top: 12px; padding: 10px; background: #21262d; border-radius: 6px; border-left: 3px solid #a371f7;">
                            <strong style="color: #a371f7;">Ornek (7 snapshot):</strong>
                            <div style="margin-top: 6px; font-family: monospace; font-size: 11px;">
                                [S1] [S2] [S3] [<span style="color: #ef4444; font-weight: bold;">S4*</span>] [S5] [S6] [S7]<br>
                                <span style="color: #64748b; margin-left: 80px;">‚Üë Dusus Ani</span>
                            </div>
                            <p style="margin-top: 8px; color: #8b949e;">Tum 7 snapshot'ta HacimSok &lt; 0.2 VE GelenPara &lt; ¬£300 ise = <span style="color: #a371f7; font-weight: 600;">INSIDER ALARM!</span></p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="info-card" style="margin-top: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
                    <h3 style="margin: 0; color: #a371f7;">üïµÔ∏è Insider Alarmlar <span id="insiderAlarmCount" class="badge" style="background: #a371f7;">0</span> <span id="insiderAlarmTotalCount" class="alarm-total-count"></span></h3>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <div class="date-filter-group">
                            <button class="date-filter-btn" onclick="setDateFilter('insider', 'yesterday')">D√ºn</button>
                            <button class="date-filter-btn" onclick="setDateFilter('insider', 'today')">Bug√ºn</button>
                            <button class="date-filter-btn" onclick="setDateFilter('insider', 'future')">Gelecek</button>
                            <button class="date-filter-btn active" onclick="setDateFilter('insider', 'all')">T√ºm√º</button>
                        </div>
                        <input type="hidden" id="insiderAlarmDateFilter" value="">
                        <div style="position: relative;">
                            <input type="text" id="insiderSearchInput" placeholder="Takim ara..." 
                                   oninput="filterInsiderAlarms()" 
                                   style="padding: 8px 12px 8px 32px; background: #21262d; border: 1px solid #30363d; border-radius: 6px; color: #e6edf3; font-size: 13px; width: 160px;">
                            <svg style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); stroke: #8b949e;" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
                            </svg>
                        </div>
                    </div>
                </div>
                <div id="insiderCalcStatus" style="display: none; padding: 15px; margin-bottom: 15px; background: #1c2128; border-radius: 8px; border-left: 4px solid #a371f7;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="spinner" style="width: 20px; height: 20px; border: 3px solid #30363d; border-top-color: #a371f7; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                        <span id="insiderCalcProgress" style="color: #a371f7; font-weight: 500;">Hesaplama devam ediyor...</span>
                    </div>
                </div>
                <div id="insiderAlarmList" class="alarm-list">
                    <p style="color: #8b949e; padding: 20px 0; text-align: center;">Henuz Insider alarm yok. "üïµÔ∏è Insider Hesapla" butonuna basin.</p>
                </div>
            </div>
        </div>

        <!-- BIG MONEY PAGE -->
        <div id="page-bigmoney" class="page-content">
            <div class="page-header">
                <div>
                    <h2 class="page-title" style="color: #FF4500;">üí∞ Big Money</h2>
                    <p class="page-subtitle">Buyuk para girislerini tespit et</p>
                </div>
            </div>

            <div class="grid-two-col">
                <div class="info-card">
                    <h3>üí∞ Big Money Alarm Ayarlari</h3>
                    <div class="info-row">
                        <span class="info-label">Gelen Para Limiti (¬£)</span>
                        <input type="number" id="bigMoneyLimit" class="config-input" value="15000" min="1000" step="1000" style="width: 100px;">
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="saveBigMoneyConfig()" style="background: #FF4500;">
                            <span class="btn-icon">üíæ</span> Kaydet
                        </button>
                        <button class="btn btn-success" onclick="calculateBigMoney()" style="background: #238636;">
                            <span class="btn-icon">üí∞</span> Big Money Hesapla
                        </button>
                        <button class="btn btn-warning" onclick="resetBigMoneyCalculation()" style="background: #f0b429;">
                            <span class="btn-icon">üîÑ</span> Sifirla
                        </button>
                        <button class="btn btn-danger" onclick="deleteBigMoneyAlarms()" style="background: #da3633;">
                            <span class="btn-icon">üóëÔ∏è</span> Alarmlari Sil
                        </button>
                        <button class="btn" onclick="deleteAlarmConfig('bigmoney')" style="background: #6e4000; color: white;">
                            <span class="btn-icon">‚öôÔ∏è</span> Ayarlari Sil
                        </button>
                    </div>
                </div>

                <div class="info-card">
                    <h3>üìñ Nasil Calisir?</h3>
                    <div style="font-size: 12px; color: #8b949e; line-height: 1.6;">
                        <p><strong style="color: #FF4500;">üí∞ BIG MONEY:</strong> Tek snapshot'ta bir secenege ¬£15,000+ para girisi</p>
                        <p><strong style="color: #ff7b00;">üî• HUGE MONEY:</strong> 2 ardisik snapshot'ta ¬£15,000+ para girisi</p>
                        <p style="margin-top: 10px; padding: 8px; background: #21262d; border-radius: 6px;">
                            <strong style="color: #f0b429;">Sinyal:</strong> Buyuk oyuncular (sharps, syndicates) pozisyon aliyor olabilir!
                        </p>
                    </div>
                </div>
            </div>

            <div class="info-card" style="margin-top: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
                    <h3 style="margin: 0; color: #FF4500;">üí∞ Big Money Alarmlar <span id="bigMoneyAlarmCount" class="badge" style="background: #FF4500;">0</span> <span id="bigMoneyAlarmTotalCount" class="alarm-total-count"></span></h3>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <div class="date-filter-group">
                            <button class="date-filter-btn" onclick="setDateFilter('bigMoney', 'yesterday')">D√ºn</button>
                            <button class="date-filter-btn" onclick="setDateFilter('bigMoney', 'today')">Bug√ºn</button>
                            <button class="date-filter-btn" onclick="setDateFilter('bigMoney', 'future')">Gelecek</button>
                            <button class="date-filter-btn active" onclick="setDateFilter('bigMoney', 'all')">T√ºm√º</button>
                        </div>
                        <input type="hidden" id="bigMoneyAlarmDateFilter" value="">
                        <div style="position: relative;">
                            <input type="text" id="bigMoneySearchInput" placeholder="Takim ara..." 
                                   oninput="filterBigMoneyAlarms()" 
                                   style="padding: 8px 12px 8px 32px; background: #21262d; border: 1px solid #30363d; border-radius: 6px; color: #e6edf3; font-size: 13px; width: 160px;">
                            <svg style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); stroke: #8b949e;" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
                            </svg>
                        </div>
                    </div>
                </div>
                <div id="bigMoneyCalcStatus" style="display: none; padding: 15px; margin-bottom: 15px; background: #1c2128; border-radius: 8px; border-left: 4px solid #FF4500;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="spinner" style="width: 20px; height: 20px; border: 3px solid #30363d; border-top-color: #FF4500; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                        <span id="bigMoneyCalcProgress" style="color: #FF4500; font-weight: 500;">Hesaplama devam ediyor...</span>
                    </div>
                </div>
                <div id="bigMoneyAlarmList" class="alarm-list">
                    <p style="color: #8b949e; padding: 20px 0; text-align: center;">Henuz Big Money alarm yok. "üí∞ Big Money Hesapla" butonuna basin.</p>
                </div>
            </div>
        </div>

        <!-- DROPPING ALERT PAGE -->
        <div id="page-dropping" class="page-content">
            <div class="page-header">
                <div>
                    <h2 class="page-title" style="color: #e74c3c;">üìâ Dropping Alert</h2>
                    <p class="page-subtitle">Acilis oranindan bu yana dusus yuzdesini takip et (L1, L2, L3)</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-danger" onclick="deleteAllDroppingAlarms()">Tum Alarmlari Sil</button>
                </div>
            </div>

            <div class="config-grid">
                <div class="info-card" style="border-left: 3px solid #9b59b6; grid-column: 1 / -1;">
                    <h3>üéØ Maksimum Oran Esigi (Max Odds Filter)</h3>
                    <p style="color: #8b949e; font-size: 12px; margin-bottom: 15px;">Acilis orani bu esiklerin uzerindeyse dropping alarmi tetiklenmez.</p>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
                        <div class="info-row" style="flex-direction: column; align-items: flex-start;">
                            <span class="info-label">1X2 Max Oran</span>
                            <input type="number" id="droppingMaxOdds1x2" class="config-input" value="5.0" min="1.5" max="20" step="0.5" style="width: 100px;">
                            <span style="color: #8b949e; font-size: 10px;">Varsayilan: 5.0</span>
                        </div>
                        <div class="info-row" style="flex-direction: column; align-items: flex-start;">
                            <span class="info-label">O/U 2.5 Max Oran</span>
                            <input type="number" id="droppingMaxOddsOu25" class="config-input" value="3.0" min="1.5" max="10" step="0.25" style="width: 100px;">
                            <span style="color: #8b949e; font-size: 10px;">Varsayilan: 3.0</span>
                        </div>
                        <div class="info-row" style="flex-direction: column; align-items: flex-start;">
                            <span class="info-label">BTTS Max Oran</span>
                            <input type="number" id="droppingMaxOddsBtts" class="config-input" value="3.0" min="1.5" max="10" step="0.25" style="width: 100px;">
                            <span style="color: #8b949e; font-size: 10px;">Varsayilan: 3.0</span>
                        </div>
                    </div>
                </div>

                <div class="info-card" style="border-left: 3px solid #e74c3c;">
                    <h3>üìâ Dropping L1 (Dusuk)</h3>
                    <div class="info-row">
                        <span class="info-label">Minimum Dusus Esigi (%)</span>
                        <input type="number" id="droppingMinL1" class="config-input" value="7" min="1" max="50" step="1" style="width: 80px;">
                    </div>
                    <div class="info-row">
                        <span class="info-label">Maksimum Dusus Esigi (%)</span>
                        <input type="number" id="droppingMaxL1" class="config-input" value="10" min="1" max="50" step="1" style="width: 80px;">
                    </div>
                    <p style="color: #8b949e; font-size: 11px; margin-top: 8px;">Seviye 1: Bu esikten baslar</p>
                </div>

                <div class="info-card" style="border-left: 3px solid #f39c12;">
                    <h3 style="display: flex; align-items: center; gap: 10px;">
                        üìâ Dropping L2 (Orta)
                        <label class="toggle-switch">
                            <input type="checkbox" id="droppingL2Enabled" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </h3>
                    <div class="info-row">
                        <span class="info-label">Minimum Dusus Esigi (%)</span>
                        <input type="number" id="droppingMinL2" class="config-input" value="10" min="1" max="50" step="1" style="width: 80px;">
                    </div>
                    <div class="info-row">
                        <span class="info-label">Maksimum Dusus Esigi (%)</span>
                        <input type="number" id="droppingMaxL2" class="config-input" value="15" min="1" max="50" step="1" style="width: 80px;">
                    </div>
                    <p style="color: #8b949e; font-size: 11px; margin-top: 8px;">Aktifse: Bu esik asildiginda Seviye 2 alarmi</p>
                </div>

                <div class="info-card" style="border-left: 3px solid #c0392b;">
                    <h3 style="display: flex; align-items: center; gap: 10px;">
                        üìâ Dropping L3 (Yuksek)
                        <label class="toggle-switch">
                            <input type="checkbox" id="droppingL3Enabled" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </h3>
                    <div class="info-row">
                        <span class="info-label">Minimum Dusus Esigi (%)</span>
                        <input type="number" id="droppingMinL3" class="config-input" value="15" min="1" max="50" step="1" style="width: 80px;">
                    </div>
                    <p style="color: #8b949e; font-size: 11px; margin-top: 8px;">Aktifse: Bu esikten fazlaysa Seviye 3 alarmi</p>
                </div>

                <div class="info-card" style="border-left: 3px solid #3498db;">
                    <h3 style="display: flex; align-items: center; gap: 10px;">
                        ‚è±Ô∏è Kalicilik Suresi
                        <label class="toggle-switch">
                            <input type="checkbox" id="droppingPersistenceEnabled" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </h3>
                    <div class="info-row">
                        <span class="info-label">Kalicilik Suresi (Dakika)</span>
                        <input type="number" id="droppingPersistenceMinutes" class="config-input" value="120" min="10" max="360" step="10" style="width: 80px;">
                    </div>
                    <p style="color: #8b949e; font-size: 11px; margin-top: 8px;">Aktifse: Dusus bu sure boyunca devam etmeli (10-360 dk)</p>
                </div>
            </div>

            <div class="info-card" style="margin-top: 20px;">
                <h3>üìä Minimum Market Volume Esikleri</h3>
                <div class="form-group">
                    <label>1X2 Minimum Volume</label>
                    <input type="number" id="dropping_min_volume_1x2" value="3000" class="form-input">
                </div>
                <div class="form-group">
                    <label>O/U 2.5 Minimum Volume</label>
                    <input type="number" id="dropping_min_volume_ou25" value="1000" class="form-input">
                </div>
                <div class="form-group">
                    <label>BTTS Minimum Volume</label>
                    <input type="number" id="dropping_min_volume_btts" value="500" class="form-input">
                </div>
                <div style="display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="saveDroppingConfig()" style="background: #e74c3c;">
                        <span class="btn-icon">üíæ</span> Kaydet
                    </button>
                    <button class="btn btn-success" onclick="calculateDropping()" style="background: #238636;">
                        <span class="btn-icon">üìâ</span> Dropping Hesapla
                    </button>
                    <button class="btn btn-warning" onclick="resetDroppingCalculation()" style="background: #f0b429;">
                        <span class="btn-icon">üîÑ</span> Sifirla
                    </button>
                    <button class="btn" onclick="deleteAlarmConfig('dropping')" style="background: #6e4000; color: white;">
                        <span class="btn-icon">‚öôÔ∏è</span> Ayarlari Sil
                    </button>
                </div>
            </div>

            <div class="info-card" style="margin-top: 20px;">
                <h3>üìñ Nasil Calisir?</h3>
                <div style="font-size: 12px; color: #8b949e; line-height: 1.6;">
                    <p><strong style="color: #e74c3c;">üìâ L1 DROPPING:</strong> Acilis oranindan %7-%10 arasi dusus</p>
                    <p><strong style="color: #f39c12;">üìâ L2 DROPPING:</strong> Acilis oranindan %10-%15 arasi dusus</p>
                    <p><strong style="color: #c0392b;">üìâ L3 DROPPING:</strong> Acilis oranindan %15+ dusus</p>
                    <p style="margin-top: 10px; padding: 8px; background: #21262d; border-radius: 6px;">
                        <strong style="color: #3498db;">Sinyal:</strong> Buyuk oran dususleri genellikle profesyonel bahiscilerin (sharps) pozisyon aldigini gosterir!
                    </p>
                </div>
            </div>

            <div class="info-card" style="margin-top: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
                    <h3 style="margin: 0; color: #e74c3c;">üìâ Dropping Alarmlar <span id="droppingAlarmCount" class="badge" style="background: #e74c3c;">0</span> <span id="droppingAlarmTotalCount" class="alarm-total-count"></span></h3>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <div class="date-filter-group">
                            <button class="date-filter-btn" onclick="setDateFilter('dropping', 'yesterday')">D√ºn</button>
                            <button class="date-filter-btn" onclick="setDateFilter('dropping', 'today')">Bug√ºn</button>
                            <button class="date-filter-btn" onclick="setDateFilter('dropping', 'future')">Gelecek</button>
                            <button class="date-filter-btn active" onclick="setDateFilter('dropping', 'all')">T√ºm√º</button>
                        </div>
                        <input type="hidden" id="droppingAlarmDateFilter" value="">
                        <div style="position: relative;">
                            <input type="text" id="droppingSearchInput" placeholder="Takim ara..." 
                                   oninput="filterDroppingAlarms()" 
                                   style="padding: 8px 12px 8px 32px; background: #21262d; border: 1px solid #30363d; border-radius: 6px; color: #e6edf3; font-size: 13px; width: 160px;">
                            <svg style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); stroke: #8b949e;" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
                            </svg>
                        </div>
                    </div>
                </div>
                <div id="droppingCalcStatus" style="display: none; padding: 15px; margin-bottom: 15px; background: #1c2128; border-radius: 8px; border-left: 4px solid #e74c3c;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="spinner" style="width: 20px; height: 20px; border: 3px solid #30363d; border-top-color: #e74c3c; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                        <span id="droppingCalcProgress" style="color: #e74c3c; font-weight: 500;">Hesaplama devam ediyor...</span>
                    </div>
                </div>
                <div id="droppingAlarmList" class="alarm-list">
                    <p style="color: #8b949e; padding: 20px 0; text-align: center;">Henuz Dropping alarm yok. "üìâ Dropping Hesapla" butonuna basin.</p>
                </div>
            </div>
        </div>

        <!-- VOLUME SHOCK (HACIM SOKU) PAGE -->
        <div id="page-volumeshock" class="page-content">
            <div class="page-header">
                <div>
                    <h2 class="page-title" style="color: #ff6b6b;">‚ö° Hacim Soku</h2>
                    <p class="page-subtitle">Mactan yeterince once gelen buyuk hacim artislarini tespit et</p>
                </div>
            </div>

            <div class="grid-two-col">
                <div class="info-card">
                    <h3>‚ö° Hacim Soku Alarm Ayarlari</h3>
                    <div class="info-row">
                        <span class="info-label">Hacim Soku Minimum Saat</span>
                        <input type="number" id="volumeShockMinSaat" class="config-input" value="5" min="1" max="24" step="0.5" style="width: 80px;">
                        <span style="color: #8b949e; font-size: 11px; margin-left: 8px;">Mactan en az kac saat once?</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Hacim Soku Minimum Deger</span>
                        <input type="number" id="volumeShockMinEsik" class="config-input" value="4" min="2" max="20" step="0.5" style="width: 80px;">
                        <span style="color: #8b949e; font-size: 11px; margin-left: 8px;">Kac katlik sok? (ornegin 4 = 4x)</span>
                    </div>
                    
                    <h4 style="margin-top: 20px; margin-bottom: 10px; color: #8b949e; font-size: 13px; border-top: 1px solid #30363d; padding-top: 15px;">üìä Minimum Market Volume Esikleri</h4>
                    <div class="info-row">
                        <span class="info-label">1X2 Minimum Volume</span>
                        <input type="number" id="vsMinVolume1x2" class="config-input" value="1000" min="0" max="10000" step="100" style="width: 100px;">
                        <span style="color: #8b949e; font-size: 11px; margin-left: 8px;">¬£</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">O/U 2.5 Minimum Volume</span>
                        <input type="number" id="vsMinVolumeOu25" class="config-input" value="500" min="0" max="10000" step="100" style="width: 100px;">
                        <span style="color: #8b949e; font-size: 11px; margin-left: 8px;">¬£</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">BTTS Minimum Volume</span>
                        <input type="number" id="vsMinVolumeBtts" class="config-input" value="300" min="0" max="10000" step="100" style="width: 100px;">
                        <span style="color: #8b949e; font-size: 11px; margin-left: 8px;">¬£</span>
                    </div>
                    
                    <h4 style="margin-top: 20px; margin-bottom: 10px; color: #8b949e; font-size: 13px; border-top: 1px solid #30363d; padding-top: 15px;">üí∞ Gelen Para Volume (min)</h4>
                    <div class="info-row">
                        <span class="info-label">Minimum Snapshot Para</span>
                        <input type="number" id="vsMinSnapshotPara" class="config-input" value="300" min="0" max="5000" step="50" style="width: 100px;">
                        <span style="color: #8b949e; font-size: 11px; margin-left: 8px;">¬£ - Son snapshot'ta gelen para bu degerden dusukse hacim soku hesaplanmaz</span>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="saveVolumeShockConfig()" style="background: #ff6b6b;">
                            <span class="btn-icon">üíæ</span> Kaydet
                        </button>
                        <button class="btn btn-success" onclick="calculateVolumeShock()" style="background: #238636;">
                            <span class="btn-icon">‚ö°</span> Hacim Soku Hesapla
                        </button>
                        <button class="btn btn-warning" onclick="resetVolumeShockCalculation()" style="background: #f0b429;">
                            <span class="btn-icon">üîÑ</span> Sifirla
                        </button>
                        <button class="btn btn-danger" onclick="deleteVolumeShockAlarms()" style="background: #da3633;">
                            <span class="btn-icon">üóëÔ∏è</span> Alarmlari Sil
                        </button>
                        <button class="btn" onclick="deleteAlarmConfig('volumeshock')" style="background: #6e4000; color: white;">
                            <span class="btn-icon">‚öôÔ∏è</span> Ayarlari Sil
                        </button>
                    </div>
                </div>

                <div class="info-card">
                    <h3>üìñ Nasil Calisir?</h3>
                    <div style="font-size: 12px; color: #8b949e; line-height: 1.6;">
                        <p><strong style="color: #ff6b6b;">‚ö° HACIM SOKU:</strong> Mactan yeterince ONCE gelen yuksek hacim artisi</p>
                        <p>Ornek: Mactan 6 saat once 5x hacim soku ‚Üí ALARM</p>
                        <p>Ornek: Mactan 1 saat once 10x hacim soku ‚Üí ALARM YOK (maca cok yakin)</p>
                        <p style="margin-top: 10px; padding: 8px; background: #21262d; border-radius: 6px;">
                            <strong style="color: #ff6b6b;">Mantik:</strong> Gercek "inside info" mac saatinden cok once gelir. Mac yaklastiginda gelen hacim normal market hareketleri olabilir.
                        </p>
                    </div>
                </div>
            </div>

            <div class="info-card" style="margin-top: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
                    <h3 style="margin: 0; color: #ff6b6b;">‚ö° Hacim Soku Alarmlar <span id="volumeShockAlarmCount" class="badge" style="background: #ff6b6b;">0</span> <span id="volumeShockAlarmTotalCount" class="alarm-total-count"></span></h3>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <div class="date-filter-group">
                            <button class="date-filter-btn" onclick="setDateFilter('volumeShock', 'yesterday')">D√ºn</button>
                            <button class="date-filter-btn" onclick="setDateFilter('volumeShock', 'today')">Bug√ºn</button>
                            <button class="date-filter-btn" onclick="setDateFilter('volumeShock', 'future')">Gelecek</button>
                            <button class="date-filter-btn active" onclick="setDateFilter('volumeShock', 'all')">T√ºm√º</button>
                        </div>
                        <input type="hidden" id="volumeShockAlarmDateFilter" value="">
                        <div style="position: relative;">
                            <input type="text" id="volumeShockSearchInput" placeholder="Takim ara..." 
                                   oninput="filterVolumeShockAlarms()" 
                                   style="padding: 8px 12px 8px 32px; background: #21262d; border: 1px solid #30363d; border-radius: 6px; color: #e6edf3; font-size: 13px; width: 160px;">
                            <svg style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); stroke: #8b949e;" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
                            </svg>
                        </div>
                    </div>
                </div>
                <div id="volumeShockCalcStatus" style="display: none; padding: 15px; margin-bottom: 15px; background: #1c2128; border-radius: 8px; border-left: 4px solid #ff6b6b;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="spinner" style="width: 20px; height: 20px; border: 3px solid #30363d; border-top-color: #ff6b6b; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                        <span id="volumeShockCalcProgress" style="color: #ff6b6b; font-weight: 500;">Hesaplama devam ediyor...</span>
                    </div>
                </div>
                <div id="volumeShockAlarmList" class="alarm-list">
                    <p style="color: #8b949e; padding: 20px 0; text-align: center;">Henuz Hacim Soku alarm yok. "‚ö° Hacim Soku Hesapla" butonuna basin.</p>
                </div>
            </div>
        </div>

        <!-- VOLUME LEADER (HACIM LIDERI DEGISTI) PAGE -->
        <div id="page-volumeleader" class="page-content">
            <div class="page-header">
                <div>
                    <h2 class="page-title" style="color: #06b6d4;">üëë Hacim Lideri Degisti</h2>
                    <p class="page-subtitle">Para akisi liderinin degistigini tespit et (%50+ pay degisimi)</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-danger" onclick="deleteAllVolumeLeaderAlarms()">Tum Alarmlari Sil</button>
                </div>
            </div>

            <div class="grid-two-col">
                <div class="info-card" style="border-left: 3px solid #06b6d4;">
                    <h3>üëë Hacim Lideri Ayarlari</h3>
                    <p style="color: #8b949e; font-size: 12px; margin-bottom: 15px;">
                        Bir secenek %50 veya daha fazla paya sahipse "lider"dir. Baska bir secenek %50+ paya ciktiginda alarm tetiklenir.
                    </p>
                    
                    <h4 style="margin-top: 20px; margin-bottom: 10px; color: #8b949e; font-size: 13px; border-top: 1px solid #30363d; padding-top: 15px;">üìä Minimum Volume Esikleri</h4>
                    <div class="info-row">
                        <span class="info-label">1X2 Minimum Volume</span>
                        <input type="number" id="vlMinVolume1x2" class="config-input" value="5000" min="0" max="50000" step="500" style="width: 100px;">
                        <span style="color: #8b949e; font-size: 11px; margin-left: 8px;">¬£</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">O/U 2.5 Minimum Volume</span>
                        <input type="number" id="vlMinVolumeOu25" class="config-input" value="2000" min="0" max="50000" step="500" style="width: 100px;">
                        <span style="color: #8b949e; font-size: 11px; margin-left: 8px;">¬£</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">BTTS Minimum Volume</span>
                        <input type="number" id="vlMinVolumeBtts" class="config-input" value="1000" min="0" max="50000" step="500" style="width: 100px;">
                        <span style="color: #8b949e; font-size: 11px; margin-left: 8px;">¬£</span>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="saveVolumeLeaderConfig()" style="background: #06b6d4;">
                            <span class="btn-icon">üíæ</span> Kaydet
                        </button>
                        <button class="btn btn-success" onclick="calculateVolumeLeader()" style="background: #238636;">
                            <span class="btn-icon">üëë</span> Hacim Lideri Hesapla
                        </button>
                        <button class="btn btn-warning" onclick="resetVolumeLeaderCalculation()" style="background: #f0b429;">
                            <span class="btn-icon">üîÑ</span> Sifirla
                        </button>
                        <button class="btn btn-danger" onclick="deleteAllVolumeLeaderAlarms()" style="background: #da3633;">
                            <span class="btn-icon">üóëÔ∏è</span> Alarmlari Sil
                        </button>
                        <button class="btn" onclick="deleteAlarmConfig('volumeleader')" style="background: #6e4000; color: white;">
                            <span class="btn-icon">‚öôÔ∏è</span> Ayarlari Sil
                        </button>
                    </div>
                </div>

                <div class="info-card">
                    <h3>üìñ Nasil Calisir?</h3>
                    <div style="font-size: 12px; color: #8b949e; line-height: 1.6;">
                        <p><strong style="color: #06b6d4;">üëë HACIM LIDERI:</strong> Bir secenek toplam hacmin %50 veya fazlasina sahipse "lider"dir.</p>
                        <p><strong style="color: #f0b429;">üîÑ LIDER DEGISIMI:</strong> Baska bir secenek %50+ paya ulastiginda alarm tetiklenir.</p>
                        <p>Ornek: 1X2 marketinde "1" secenegi %55 payla liderken, "X" secenegi %52'ye ciktiginda ‚Üí LIDER DEGISTI alarmi</p>
                        <p style="margin-top: 10px; padding: 8px; background: #21262d; border-radius: 6px;">
                            <strong style="color: #06b6d4;">Sinyal:</strong> Para akisinda dramatik degisim! Buyuk oyuncular pozisyon degistiriyor olabilir.
                        </p>
                    </div>
                </div>
            </div>

            <div class="info-card" style="margin-top: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
                    <h3 style="margin: 0; color: #06b6d4;">üëë Hacim Lideri Alarmlar <span id="volumeLeaderAlarmCount" class="badge" style="background: #06b6d4;">0</span> <span id="volumeLeaderAlarmTotalCount" class="alarm-total-count"></span></h3>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <div class="date-filter-group">
                            <button class="date-filter-btn" onclick="setDateFilter('volumeLeader', 'yesterday')">D√ºn</button>
                            <button class="date-filter-btn" onclick="setDateFilter('volumeLeader', 'today')">Bug√ºn</button>
                            <button class="date-filter-btn" onclick="setDateFilter('volumeLeader', 'future')">Gelecek</button>
                            <button class="date-filter-btn active" onclick="setDateFilter('volumeLeader', 'all')">T√ºm√º</button>
                        </div>
                        <input type="hidden" id="volumeLeaderAlarmDateFilter" value="">
                        <div style="position: relative;">
                            <input type="text" id="volumeLeaderSearchInput" placeholder="Takim ara..." 
                                   oninput="filterVolumeLeaderAlarms()" 
                                   style="padding: 8px 12px 8px 32px; background: #21262d; border: 1px solid #30363d; border-radius: 6px; color: #e6edf3; font-size: 13px; width: 160px;">
                            <svg style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); stroke: #8b949e;" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
                            </svg>
                        </div>
                    </div>
                </div>
                <div id="volumeLeaderCalcStatus" style="display: none; padding: 15px; margin-bottom: 15px; background: #1c2128; border-radius: 8px; border-left: 4px solid #06b6d4;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="spinner" style="width: 20px; height: 20px; border: 3px solid #30363d; border-top-color: #06b6d4; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                        <span id="volumeLeaderCalcProgress" style="color: #06b6d4; font-weight: 500;">Hesaplama devam ediyor...</span>
                    </div>
                </div>
                <div id="volumeLeaderAlarmList" class="alarm-list">
                    <p style="color: #8b949e; padding: 20px 0; text-align: center;">Henuz Hacim Lideri alarm yok. "üëë Hacim Lideri Hesapla" butonuna basin.</p>
                </div>
            </div>
        </div>

        <!-- MIM (Market Impact Money) PAGE -->
        <div id="page-mim" class="page-content">
            <div class="page-header">
                <div>
                    <h2 class="page-title" style="color: #3B82F6;">üíé MIM (Market Impact Money)</h2>
                    <p class="page-subtitle">Piyasa etkisi alarmlarini yonet - buyuk para hareketlerini tespit et</p>
                </div>
            </div>

            <div class="grid-two-col">
                <div class="info-card" style="border-left: 3px solid #3B82F6;">
                    <h3>üíé MIM Ayarlari</h3>
                    <p style="color: #8b949e; font-size: 12px; margin-bottom: 15px;">
                        MIM, piyasa etkisini olcer. Impact degeri ne kadar yuksekse, o secim icin para akisi o kadar gucludur.
                    </p>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Min. Impact Esigi</label>
                            <input type="number" id="mimMinImpact" value="0.10" min="0.01" max="1.0" step="0.01">
                            <span class="form-hint">Minimum impact degeri (varsayilan: 0.10)</span>
                        </div>
                        <div class="form-group">
                            <label>Min. Onceki Volume (¬£)</label>
                            <input type="number" id="mimMinPrevVolume" value="1000" min="0" step="100">
                            <span class="form-hint">Para gelmeden onceki min. hacim</span>
                        </div>
                    </div>
                    
                    <div class="btn-group" style="margin-top: 20px;">
                        <button class="btn btn-primary" onclick="saveMimConfig()" style="background: #238636;">
                            <span class="btn-icon">üíæ</span> Ayarlari Kaydet
                        </button>
                        <button class="btn btn-danger" onclick="deleteAllMimAlarms()" style="background: #da3633;">
                            <span class="btn-icon">üóëÔ∏è</span> Alarmlari Sil
                        </button>
                        <button class="btn" onclick="deleteAlarmConfig('mim')" style="background: #6e4000; color: white;">
                            <span class="btn-icon">‚öôÔ∏è</span> Ayarlari Sil
                        </button>
                    </div>
                </div>
                
                <div class="info-card" style="border-left: 3px solid #3B82F6;">
                    <h3>üìä MIM Istatistikleri</h3>
                    <div class="stats-mini">
                        <div class="stat-mini-item">
                            <span class="stat-mini-value" id="mimTotalAlarms">0</span>
                            <span class="stat-mini-label">Toplam Alarm</span>
                        </div>
                        <div class="stat-mini-item">
                            <span class="stat-mini-value" id="mimTodayAlarms">0</span>
                            <span class="stat-mini-label">Bugun</span>
                        </div>
                        <div class="stat-mini-item">
                            <span class="stat-mini-value" id="mimAvgImpact">-</span>
                            <span class="stat-mini-label">Ort. Impact</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="info-card" style="margin-top: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
                    <h3 style="margin: 0; color: #3B82F6;">üíé MIM Alarmlar <span id="mimAlarmCount" class="badge" style="background: #3B82F6;">0</span> <span id="mimAlarmTotalCount" class="alarm-total-count"></span></h3>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <div class="date-filter-group">
                            <button class="date-filter-btn" onclick="setDateFilter('mim', 'yesterday')">Dun</button>
                            <button class="date-filter-btn" onclick="setDateFilter('mim', 'today')">Bugun</button>
                            <button class="date-filter-btn" onclick="setDateFilter('mim', 'future')">Gelecek</button>
                            <button class="date-filter-btn active" onclick="setDateFilter('mim', 'all')">Tumu</button>
                        </div>
                        <input type="hidden" id="mimAlarmDateFilter" value="">
                        <div style="position: relative;">
                            <input type="text" id="mimSearchInput" placeholder="Takim ara..." 
                                   oninput="filterMimAlarms()" 
                                   style="padding: 8px 12px 8px 32px; background: #21262d; border: 1px solid #30363d; border-radius: 6px; color: #e6edf3; font-size: 13px; width: 160px;">
                            <svg style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); stroke: #8b949e;" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
                            </svg>
                        </div>
                    </div>
                </div>
                <div id="mimAlarmList" class="alarm-list">
                    <p style="color: #8b949e; padding: 20px 0; text-align: center;">Henuz MIM alarm yok.</p>
                </div>
            </div>
        </div>

        <!-- TELEGRAM PAGE -->
        <div id="page-telegram" class="page-content">
            <div class="page-header">
                <div>
                    <h2 class="page-title" style="color: #0088cc;">üì≤ Telegram Bildirimleri</h2>
                    <p class="page-subtitle">Alarm bildirimlerini Telegram'a gonder</p>
                </div>
            </div>

            <div class="grid-two-col">
                <div class="info-card" style="border-left: 3px solid #0088cc;">
                    <h3>üì≤ Telegram Ayarlari</h3>
                    <p style="color: #8b949e; font-size: 12px; margin-bottom: 15px;">
                        Alarmlar tetiklendiginde Telegram'a bildirim gondermek icin ayarlari yapin.
                    </p>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="telegramEnabled" style="width: 18px; height: 18px;">
                                <span>Telegram Bildirimlerini Etkinlestir</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-top: 15px;">
                        <label style="display: block; margin-bottom: 8px; color: #8b949e;">Mesaj Formati:</label>
                        <div style="display: flex; gap: 20px;">
                            <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                                <input type="radio" name="messageMode" id="messageModeImage" value="image" checked> üì∑ Gorsel Kart
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                                <input type="radio" name="messageMode" id="messageModeText" value="text"> üìù Metin
                            </label>
                        </div>
                        <span class="form-hint">Gorsel kart web UI'daki tasarimi kullanir (Playwright gerekli)</span>
                    </div>
                    
                    <div style="margin-top: 15px;">
                        <label style="display: block; margin-bottom: 8px; color: #8b949e;">Bildirim Gonderilecek Alarm Turleri:</label>
                        <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                            <label style="display: flex; align-items: center; gap: 5px; background: #21262d; padding: 6px 10px; border-radius: 6px; cursor: pointer;">
                                <input type="checkbox" class="telegram-alarm-type" value="SHARP" checked> üéØ Sharp
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px; background: #21262d; padding: 6px 10px; border-radius: 6px; cursor: pointer;">
                                <input type="checkbox" class="telegram-alarm-type" value="INSIDER" checked> üïµÔ∏è Insider
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px; background: #21262d; padding: 6px 10px; border-radius: 6px; cursor: pointer;">
                                <input type="checkbox" class="telegram-alarm-type" value="BIGMONEY" checked> üí∞ BigMoney
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px; background: #21262d; padding: 6px 10px; border-radius: 6px; cursor: pointer;">
                                <input type="checkbox" class="telegram-alarm-type" value="VOLUMESHOCK" checked> ‚ö° VolumeShock
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px; background: #21262d; padding: 6px 10px; border-radius: 6px; cursor: pointer;">
                                <input type="checkbox" class="telegram-alarm-type" value="DROPPING" checked> üìâ Dropping
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px; background: #21262d; padding: 6px 10px; border-radius: 6px; cursor: pointer;">
                                <input type="checkbox" class="telegram-alarm-type" value="PUBLICMOVE" checked> üë• PublicMove
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px; background: #21262d; padding: 6px 10px; border-radius: 6px; cursor: pointer;">
                                <input type="checkbox" class="telegram-alarm-type" value="VOLUMELEADER" checked> üèÜ VolumeLeader
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px; background: #21262d; padding: 6px 10px; border-radius: 6px; cursor: pointer;">
                                <input type="checkbox" class="telegram-alarm-type" value="MIM" checked> üíé MIM
                            </label>
                        </div>
                    </div>
                    
                    <div class="btn-group" style="margin-top: 20px;">
                        <button class="btn btn-primary" onclick="saveTelegramSettings()" style="background: #238636;">
                            <span class="btn-icon">üíæ</span> Ayarlari Kaydet
                        </button>
                        <button class="btn" onclick="testTelegramMessage()" style="background: #0088cc; color: white;">
                            <span class="btn-icon">üì§</span> Test Mesaji Gonder
                        </button>
                    </div>
                </div>
                
                <div class="info-card" style="border-left: 3px solid #0088cc;">
                    <h3>üí∞ Big Money Retrigger Ayarlari</h3>
                    <p style="color: #8b949e; font-size: 12px; margin-bottom: 15px;">
                        Big Money alarmlarinin tekrar tetiklenmesi icin ozel kurallar.
                    </p>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="bigMoneyRetriggerEnabled" checked style="width: 18px; height: 18px;">
                                <span>Retrigger Etkinlestir</span>
                            </label>
                            <span class="form-hint">Ayni mac icin yeni para geldiginde tekrar bildirim gonder</span>
                        </div>
                        <div class="form-group">
                            <label>Min. Delta (GBP)</label>
                            <input type="number" id="bigMoneyRetriggerDelta" value="500" min="100" step="100" style="width: 100px;">
                            <span class="form-hint">Retrigger icin gereken min. yeni para</span>
                        </div>
                        <div class="form-group">
                            <label>Cooldown (dakika)</label>
                            <input type="number" id="bigMoneyRetriggerCooldown" value="10" min="1" max="60" step="1" style="width: 80px;">
                            <span class="form-hint">Ayni alarm icin min. bekleme suresi</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="info-card" style="margin-top: 20px;">
                <h3>üìä Telegram Istatistikleri</h3>
                <div class="stats-mini">
                    <div class="stat-mini-item">
                        <span class="stat-mini-value" id="telegramTotalSent">0</span>
                        <span class="stat-mini-label">Toplam Gonderilen</span>
                    </div>
                    <div class="stat-mini-item">
                        <span class="stat-mini-value" id="telegramTodaySent">0</span>
                        <span class="stat-mini-label">Bugun</span>
                    </div>
                    <div class="stat-mini-item">
                        <span class="stat-mini-value" id="telegramStatus">-</span>
                        <span class="stat-mini-label">Durum</span>
                    </div>
                </div>
            </div>

            <div class="info-card" style="margin-top: 20px;">
                <h3>üìã Son Gonderilen Bildirimler</h3>
                <div id="telegramLogList" style="max-height: 400px; overflow-y: auto;">
                    <p style="color: #8b949e; padding: 20px 0; text-align: center;">Henuz bildirim gonderilmedi.</p>
                </div>
            </div>
        </div>

        <div id="page-system" class="page-content">
            <div class="page-header">
                <div>
                    <h2 class="page-title">Sistem Bilgisi</h2>
                    <p class="page-subtitle">Teknik detaylar ve konfigurasyonlar</p>
                </div>
            </div>

            <div class="info-card">
                <h3>üñ•Ô∏è Uygulama Bilgileri</h3>
                <div class="info-row">
                    <span class="info-label">Uygulama</span>
                    <span class="info-value">SmartXFlow Monitor</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Versiyon</span>
                    <span class="info-value">1.0</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Timezone</span>
                    <span class="info-value">Europe/Istanbul (TR)</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Scrape Araligi</span>
                    <span class="info-value">10 dakika</span>
                </div>
            </div>

            <div class="info-card">
                <h3>üóÑÔ∏è Veritabani</h3>
                <div class="info-row">
                    <span class="info-label">Provider</span>
                    <span class="info-value">Supabase (PostgreSQL)</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Baglanti</span>
                    <span class="info-value success" id="dbConnection">Aktif</span>
                </div>
            </div>

            <div class="info-card">
                <h3>üìã Veri Kaynaklari</h3>
                <div class="info-row">
                    <span class="info-label">Moneyway</span>
                    <span class="info-value">arbworld.net</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Dropping Odds</span>
                    <span class="info-value">arbworld.net</span>
                </div>
            </div>
        </div>

        <!-- Scraper Console Page -->
        <div id="page-scraper" class="page-content">
            <div class="page-header">
                <div>
                    <h2 class="page-title">Scraper Konsol</h2>
                    <p class="page-subtitle">Canlƒ± veri √ßekme loglarƒ± ve durum bilgisi</p>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="action-btn success" id="scraperStartBtn" onclick="toggleScraper('start')" style="background: #238636;">
                        <span>‚ñ∂Ô∏è</span> Ba≈ülat
                    </button>
                    <button class="action-btn danger" id="scraperStopBtn" onclick="toggleScraper('stop')" style="background: #da3633;">
                        <span>‚èπÔ∏è</span> Durdur
                    </button>
                    <button class="action-btn" onclick="window.open('/scraper/console', 'scraperConsole', 'width=900,height=600')">
                        <span>ü™ü</span> Yeni Pencerede A√ß
                    </button>
                    <button class="action-btn" onclick="clearScraperConsole()">
                        <span>üóëÔ∏è</span> Temizle
                    </button>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; margin-bottom: 20px;">
                <div class="stats-card">
                    <div class="stats-label">Durum</div>
                    <div class="stats-value" id="scraperStatus">Bekliyor...</div>
                </div>
                <div class="stats-card" style="min-width: 140px;">
                    <div class="stats-label">Interval (dk)</div>
                    <div class="stats-value" style="display: flex; align-items: center; gap: 6px;">
                        <input type="number" id="scraperIntervalInput" value="10" min="1" max="60" 
                               style="width: 50px; background: #21262d; border: 1px solid #30363d; border-radius: 4px; color: #4ade80; font-size: 14px; padding: 4px 6px; text-align: center;">
                        <button onclick="updateScraperInterval()" style="background: #238636; color: white; border: none; border-radius: 4px; padding: 4px 8px; font-size: 11px; cursor: pointer;">Uygula</button>
                    </div>
                </div>
                <div class="stats-card">
                    <div class="stats-label">Sonraki √áekim</div>
                    <div class="stats-value" id="scraperNextRun">-</div>
                </div>
                <div class="stats-card">
                    <div class="stats-label">Son √áekim</div>
                    <div class="stats-value" id="scraperLastRows">-</div>
                </div>
                <div class="stats-card">
                    <div class="stats-label">Son Alarm</div>
                    <div class="stats-value" id="scraperLastAlarms">-</div>
                </div>
            </div>

            <div class="info-card" style="padding: 0; overflow: hidden;">
                <div style="background: #010409; padding: 15px; font-family: 'Consolas', 'Courier New', monospace; font-size: 13px; line-height: 1.6; height: 500px; overflow-y: auto;" id="scraperConsoleOutput">
                    <div style="color: #484f58;">[Scraper Console baƒülanƒ±yor...]</div>
                </div>
            </div>
        </div>

        <!-- Alarm Engine Console Page -->
        <div id="page-alarmengine" class="page-content">
            <div class="page-header">
                <div>
                    <h2 class="page-title">Alarm Engine Konsol</h2>
                    <p class="page-subtitle">Alarm hesaplama loglarƒ± ve durum bilgisi</p>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="action-btn primary" id="alarmEngineStartBtn" onclick="controlAlarmEngine('start')" style="background: #238636; border-color: #238636;">
                        <span>‚ñ∂</span> Ba≈ülat
                    </button>
                    <button class="action-btn" id="alarmEngineStopBtn" onclick="controlAlarmEngine('stop')" style="background: #da3633; border-color: #da3633;">
                        <span>‚èπ</span> Durdur
                    </button>
                    <button class="action-btn" onclick="window.open('/alarm-engine/console', 'alarmEngineConsole', 'width=900,height=600')">
                        <span>ü™ü</span> Yeni Pencerede A√ß
                    </button>
                    <button class="action-btn" onclick="clearAlarmEngineConsole()">
                        <span>üóëÔ∏è</span> Temizle
                    </button>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 15px; margin-bottom: 20px;">
                <div class="stats-card">
                    <div class="stats-label">Durum</div>
                    <div class="stats-value" id="alarmEngineStatus">Durduruldu</div>
                </div>
                <div class="stats-card">
                    <div class="stats-label">Son Hesaplama</div>
                    <div class="stats-value" id="alarmEngineLastCalc">-</div>
                </div>
                <div class="stats-card">
                    <div class="stats-label">Sonraki Hesaplama</div>
                    <div class="stats-value" id="alarmEngineNextCalc">-</div>
                </div>
                <div class="stats-card">
                    <div class="stats-label">S√ºre</div>
                    <div class="stats-value" id="alarmEngineDuration">-</div>
                </div>
                <div class="stats-card">
                    <div class="stats-label">Toplam Alarm</div>
                    <div class="stats-value" id="alarmEngineCount" style="color: #f0883e;">-</div>
                </div>
                <div class="stats-card">
                    <div class="stats-label">Config</div>
                    <div class="stats-value" id="alarmEngineConfig">-</div>
                </div>
            </div>

            <div class="info-card" style="padding: 0; overflow: hidden;">
                <div style="background: #010409; padding: 15px; font-family: 'Consolas', 'Courier New', monospace; font-size: 13px; line-height: 1.6; height: 500px; overflow-y: auto;" id="alarmEngineConsoleOutput">
                    <div style="color: #484f58;">[Alarm Engine Console baƒülanƒ±yor...]</div>
                </div>
            </div>
        </div>
    </main>

    <div class="toast" id="toast"></div>

    <script>
        // Scraper Console variables
        let scraperSSE = null;
        
        function initScraperConsole() {
            // Load existing logs
            fetch('/scraper/logs')
                .then(r => r.json())
                .then(data => {
                    if (data.logs && data.logs.length > 0) {
                        const output = document.getElementById('scraperConsoleOutput');
                        output.innerHTML = '';
                        data.logs.forEach(log => addScraperLog(log));
                    }
                });
            
            // Start SSE connection
            if (!scraperSSE) {
                scraperSSE = new EventSource('/scraper/stream');
                scraperSSE.onmessage = (e) => addScraperLog(e.data);
                scraperSSE.onerror = () => {
                    document.getElementById('scraperStatus').textContent = 'Baƒülantƒ± kesildi';
                    document.getElementById('scraperStatus').style.color = '#f85149';
                };
            }
            
            // Update status
            updateScraperStatus();
            setInterval(updateScraperStatus, 5000);
        }
        
        function addScraperLog(text) {
            const output = document.getElementById('scraperConsoleOutput');
            const line = document.createElement('div');
            
            if (text.includes('HATA') || text.includes('ERROR')) {
                line.style.color = '#f85149';
            } else if (text.includes('tamamlandƒ±') || text.includes('ba≈üarƒ±lƒ±')) {
                line.style.color = '#3fb950';
            } else if (text.includes('---') || text.includes('===')) {
                line.style.color = '#484f58';
            } else if (text.includes('ba≈ülƒ±yor') || text.includes('√ßekiliyor')) {
                line.style.color = '#58a6ff';
            } else {
                line.style.color = '#c9d1d9';
            }
            
            line.textContent = text;
            output.appendChild(line);
            output.scrollTop = output.scrollHeight;
        }
        
        function clearScraperConsole() {
            const output = document.getElementById('scraperConsoleOutput');
            output.innerHTML = '<div style="color: #484f58;">[Console temizlendi]</div>';
        }
        
        function updateScraperInterval() {
            const input = document.getElementById('scraperIntervalInput');
            const newInterval = parseInt(input.value);
            
            if (isNaN(newInterval) || newInterval < 1 || newInterval > 60) {
                showToast('Interval 1-60 dakika arasƒ±nda olmalƒ±', 'error');
                return;
            }
            
            fetch('/scraper/interval', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({interval: newInterval})
            })
            .then(r => r.json())
            .then(data => {
                if (data.status === 'ok') {
                    showToast(`Interval ${newInterval} dakika olarak ayarlandƒ±`, 'success');
                } else {
                    showToast(data.message || 'Ayarlama ba≈üarƒ±sƒ±z', 'error');
                }
            })
            .catch(() => {
                showToast('Baƒülantƒ± hatasƒ±', 'error');
            });
        }
        
        function toggleScraper(action) {
            const startBtn = document.getElementById('scraperStartBtn');
            const stopBtn = document.getElementById('scraperStopBtn');
            
            startBtn.disabled = true;
            stopBtn.disabled = true;
            
            fetch('/scraper/control', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({action: action})
            })
            .then(r => r.json())
            .then(data => {
                if (data.status === 'ok') {
                    showToast(action === 'start' ? 'Scraper ba≈ülatƒ±ldƒ±' : 'Scraper durduruldu', 'success');
                    updateScraperStatus();
                } else {
                    showToast(data.message || 'ƒ∞≈ülem ba≈üarƒ±sƒ±z', 'error');
                }
            })
            .catch(() => {
                showToast('Baƒülantƒ± hatasƒ±', 'error');
            })
            .finally(() => {
                startBtn.disabled = false;
                stopBtn.disabled = false;
            });
        }
        
        function updateScraperStatus() {
            fetch('/scraper/status')
                .then(r => r.json())
                .then(data => {
                    const statusEl = document.getElementById('scraperStatus');
                    const statusText = data.status_text || (data.running ? '√áalƒ±≈üƒ±yor' : 'Durduruldu');
                    statusEl.textContent = statusText;
                    
                    if (data.is_disabled) {
                        statusEl.style.color = '#f0883e';
                    } else if (data.is_scraping) {
                        statusEl.style.color = '#58a6ff';
                    } else if (data.running) {
                        statusEl.style.color = '#3fb950';
                    } else {
                        statusEl.style.color = '#f85149';
                    }
                    
                    document.getElementById('scraperIntervalInput').value = data.interval_minutes || 10;
                    document.getElementById('scraperLastRows').textContent = data.last_rows ? data.last_rows + ' satƒ±r' : '-';
                    document.getElementById('scraperLastAlarms').textContent = data.last_alarm_count ? data.last_alarm_count + ' alarm' : '-';
                    
                    if (data.next_scrape) {
                        const next = new Date(data.next_scrape);
                        const now = new Date();
                        const diff = Math.max(0, Math.floor((next - now) / 1000));
                        const mins = Math.floor(diff / 60);
                        const secs = diff % 60;
                        document.getElementById('scraperNextRun').textContent = `${mins}:${String(secs).padStart(2, '0')}`;
                    } else {
                        document.getElementById('scraperNextRun').textContent = '-';
                    }
                    
                    // Buton durumlarƒ±nƒ± g√ºncelle
                    const startBtn = document.getElementById('scraperStartBtn');
                    const stopBtn = document.getElementById('scraperStopBtn');
                    if (data.is_disabled) {
                        startBtn.style.display = 'none';
                        stopBtn.style.display = 'none';
                    } else if (data.running) {
                        startBtn.style.opacity = '0.5';
                        startBtn.style.pointerEvents = 'none';
                        stopBtn.style.opacity = '1';
                        stopBtn.style.pointerEvents = 'auto';
                    } else {
                        startBtn.style.opacity = '1';
                        startBtn.style.pointerEvents = 'auto';
                        stopBtn.style.opacity = '0.5';
                        stopBtn.style.pointerEvents = 'none';
                    }
                })
                .catch(() => {
                    document.getElementById('scraperStatus').textContent = 'Baƒülantƒ± hatasƒ±';
                    document.getElementById('scraperStatus').style.color = '#f85149';
                });
        }
        
        // Alarm Engine Console variables
        let alarmEngineSSE = null;
        
        function initAlarmEngineConsole() {
            fetch('/alarm-engine/logs')
                .then(r => r.json())
                .then(data => {
                    if (data.logs && data.logs.length > 0) {
                        const output = document.getElementById('alarmEngineConsoleOutput');
                        output.innerHTML = '';
                        data.logs.forEach(log => addAlarmEngineLog(log));
                    }
                });
            
            if (!alarmEngineSSE) {
                alarmEngineSSE = new EventSource('/alarm-engine/stream');
                alarmEngineSSE.onmessage = (e) => addAlarmEngineLog(e.data);
                alarmEngineSSE.onerror = () => {
                    document.getElementById('alarmEngineStatus').textContent = 'Baƒülantƒ± kesildi';
                    document.getElementById('alarmEngineStatus').style.color = '#f85149';
                };
            }
            
            updateAlarmEngineStatus();
            setInterval(updateAlarmEngineStatus, 3000);
        }
        
        function addAlarmEngineLog(text) {
            const output = document.getElementById('alarmEngineConsoleOutput');
            const line = document.createElement('div');
            
            if (text.includes('HATA') || text.includes('ERROR') || text.includes('!!!')) {
                line.style.color = '#f85149';
            } else if (text.includes('TAMAMLANDI') || text.includes('tamamlandƒ±')) {
                line.style.color = '#3fb950';
            } else if (text.includes('---') || text.includes('===')) {
                line.style.color = '#484f58';
            } else if (text.includes('alarm') && text.match(/\d+/)) {
                line.style.color = '#f0883e';
                line.style.fontWeight = 'bold';
            } else if (text.includes('hesaplanƒ±yor') || text.includes('ba≈ülƒ±yor')) {
                line.style.color = '#58a6ff';
            } else {
                line.style.color = '#c9d1d9';
            }
            
            line.textContent = text;
            output.appendChild(line);
            output.scrollTop = output.scrollHeight;
        }
        
        function clearAlarmEngineConsole() {
            const output = document.getElementById('alarmEngineConsoleOutput');
            output.innerHTML = '<div style="color: #484f58;">[Console temizlendi]</div>';
        }
        
        function controlAlarmEngine(action) {
            const startBtn = document.getElementById('alarmEngineStartBtn');
            const stopBtn = document.getElementById('alarmEngineStopBtn');
            
            if (action === 'start') {
                startBtn.disabled = true;
                startBtn.textContent = 'Ba≈ülatƒ±lƒ±yor...';
            } else {
                stopBtn.disabled = true;
                stopBtn.textContent = 'Durduruluyor...';
            }
            
            fetch('/alarm-engine/control', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: action })
            })
            .then(r => r.json())
            .then(data => {
                if (data.status === 'ok') {
                    showToast(data.message, 'success');
                } else {
                    showToast(data.message || 'Hata olu≈ütu', 'error');
                }
                updateAlarmEngineStatus();
            })
            .catch(err => {
                showToast('Baƒülantƒ± hatasƒ±: ' + err.message, 'error');
            })
            .finally(() => {
                startBtn.disabled = false;
                startBtn.innerHTML = '<span>‚ñ∂</span> Ba≈ülat';
                stopBtn.disabled = false;
                stopBtn.innerHTML = '<span>‚èπ</span> Durdur';
            });
        }
        
        function updateAlarmEngineStatus() {
            fetch('/alarm-engine/status')
                .then(r => r.json())
                .then(data => {
                    const statusEl = document.getElementById('alarmEngineStatus');
                    const startBtn = document.getElementById('alarmEngineStartBtn');
                    const stopBtn = document.getElementById('alarmEngineStopBtn');
                    
                    statusEl.textContent = data.status_text || 'Bilinmiyor';
                    
                    if (data.running) {
                        statusEl.style.color = '#f0883e';
                        startBtn.style.opacity = '0.5';
                        stopBtn.style.opacity = '1';
                    } else {
                        statusEl.style.color = '#8b949e';
                        startBtn.style.opacity = '1';
                        stopBtn.style.opacity = '0.5';
                    }
                    
                    document.getElementById('alarmEngineConfig').textContent = data.configs_loaded ? 'Y√ºklendi' : 'Y√ºklenmedi';
                    document.getElementById('alarmEngineCount').textContent = data.last_alarm_count || 0;
                    document.getElementById('alarmEngineDuration').textContent = data.last_duration_seconds ? data.last_duration_seconds + 's' : '-';
                    
                    if (data.last_calculation) {
                        const d = new Date(data.last_calculation);
                        document.getElementById('alarmEngineLastCalc').textContent = d.toLocaleTimeString('tr-TR');
                    }
                    
                    if (data.next_calculation) {
                        const d = new Date(data.next_calculation);
                        document.getElementById('alarmEngineNextCalc').textContent = d.toLocaleTimeString('tr-TR');
                    } else {
                        document.getElementById('alarmEngineNextCalc').textContent = '-';
                    }
                })
                .catch(() => {
                    document.getElementById('alarmEngineStatus').textContent = 'Baƒülantƒ± hatasƒ±';
                    document.getElementById('alarmEngineStatus').style.color = '#f85149';
                });
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initScraperConsole();
            initAlarmEngineConsole();
        });
        
        // Alarm zamani parse - siralama icin (yeniden eskiye)
        function parseAlarmTime(dateStr) {
            if (!dateStr) return 0;
            
            // Format: "05.12.2025 06:56" veya "05.12.2025 06:56:30"
            const match1 = dateStr.match(/^(\d{2})\.(\d{2})\.(\d{4})\s+(\d{2}):(\d{2})(?::(\d{2}))?$/);
            if (match1) {
                const [, day, month, year, hour, min, sec] = match1;
                return new Date(year, month - 1, day, hour, min, sec || 0).getTime();
            }
            
            // ISO format: "2025-12-05T06:56:30"
            if (dateStr.includes('T')) {
                return new Date(dateStr).getTime();
            }
            
            return 0;
        }
        
        // Alarmlari yeniden eskiye sirala
        function sortAlarmsNewestFirst(alarms) {
            return alarms.sort((a, b) => {
                const timeA = parseAlarmTime(a.created_at || a.event_time || '');
                const timeB = parseAlarmTime(b.created_at || b.event_time || '');
                return timeB - timeA; // DESC - newest first
            });
        }
        
        function parseAlarmDate(alarm) {
            const dateStr = alarm.match_date || alarm.event_time || alarm.created_at || '';
            if (!dateStr) return null;
            
            let match = dateStr.match(/(\d{1,2})\.(\w{3})\.?(\d{4})?|(\d{2})\.(\d{2})\.(\d{4})/i);
            if (match) {
                if (match[4]) {
                    return `${match[6]}-${match[5]}-${match[4]}`;
                }
                const months = {'jan':'01','feb':'02','mar':'03','apr':'04','may':'05','jun':'06',
                               'jul':'07','aug':'08','sep':'09','oct':'10','nov':'11','dec':'12'};
                const day = match[1].padStart(2, '0');
                const mon = months[match[2].toLowerCase()] || '01';
                const year = match[3] || new Date().getFullYear();
                return `${year}-${mon}-${day}`;
            }
            
            if (dateStr.includes('T') || dateStr.match(/^\d{4}-\d{2}-\d{2}/)) {
                return dateStr.substring(0, 10);
            }
            return null;
        }
        
        function calculateHoursToKickoff(alarmOrDateStr) {
            // Eƒüer alarm objesi verilmi≈üse, match_date ve trigger_at'tan hesapla
            if (typeof alarmOrDateStr === 'object' && alarmOrDateStr !== null) {
                const alarm = alarmOrDateStr;
                // √ñnce mevcut deƒüeri kontrol et
                if (alarm.hours_to_kickoff && alarm.hours_to_kickoff > 0) {
                    return alarm.hours_to_kickoff;
                }
                
                const matchDateStr = alarm.match_date || alarm.kickoff || alarm.fixture_date;
                const triggerAtStr = alarm.trigger_at || alarm.event_time || alarm.created_at;
                
                if (!matchDateStr || !triggerAtStr) {
                    // Fallback: sadece match_date ile hesapla
                    return calculateHoursToKickoffFromString(matchDateStr);
                }
                
                const matchTime = parseMatchDate(matchDateStr);
                const triggerTime = parseTriggerAt(triggerAtStr);
                
                if (matchTime && triggerTime) {
                    const diffMs = matchTime - triggerTime;
                    const diffHours = diffMs / (1000 * 60 * 60);
                    return diffHours > 0 ? diffHours : 0;
                }
                
                return 0;
            }
            
            // String parametre i√ßin eski davranƒ±≈ü
            return calculateHoursToKickoffFromString(alarmOrDateStr);
        }
        
        function calculateHoursToKickoffFromString(matchDateStr) {
            if (!matchDateStr || matchDateStr === '-') return null;
            
            const matchTime = parseMatchDate(matchDateStr);
            
            if (matchTime) {
                const now = new Date();
                const diffMs = matchTime - now;
                const diffHours = diffMs / (1000 * 60 * 60);
                return diffHours > 0 ? diffHours : 0;
            }
            
            return null;
        }
        
        function parseMatchDate(matchDateStr) {
            if (!matchDateStr || matchDateStr === '-') return null;
            
            const monthMap = { 'Jan': 0, 'Feb': 1, 'Mar': 2, 'Apr': 3, 'May': 4, 'Jun': 5, 
                               'Jul': 6, 'Aug': 7, 'Sep': 8, 'Oct': 9, 'Nov': 10, 'Dec': 11 };
            
            // Format: "02.Dec 14:00:00"
            const match1 = matchDateStr.match(/^(\d{1,2})\.([A-Za-z]{3})\s+(\d{2}):(\d{2}):?(\d{2})?$/);
            if (match1) {
                const [, day, monthStr, hour, min] = match1;
                const monthIdx = monthMap[monthStr] ?? 0;
                const matchTime = new Date(2025, monthIdx, parseInt(day), parseInt(hour), parseInt(min));
                matchTime.setHours(matchTime.getHours() + 3);
                return matchTime;
            }
            
            // Format: "03.12.2025 14:00"
            const match2 = matchDateStr.match(/^(\d{2})\.(\d{2})\.(\d{4})\s+(\d{2}):(\d{2})$/);
            if (match2) {
                const [, day, month, year, hour, min] = match2;
                const matchTime = new Date(parseInt(year), parseInt(month) - 1, parseInt(day), parseInt(hour), parseInt(min));
                matchTime.setHours(matchTime.getHours() + 3);
                return matchTime;
            }
            
            return null;
        }
        
        function parseTriggerAt(triggerAtStr) {
            if (!triggerAtStr || triggerAtStr === '-') return null;
            
            // ISO format: "2025-12-08T18:22:19+03:00"
            const isoMatch = triggerAtStr.match(/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})/);
            if (isoMatch) {
                const [, year, month, day, hour, min, sec] = isoMatch;
                return new Date(parseInt(year), parseInt(month) - 1, parseInt(day), parseInt(hour), parseInt(min), parseInt(sec));
            }
            
            return new Date(triggerAtStr);
        }
        
        function formatMatchDateTR(dateStr) {
            if (!dateStr || dateStr === '-') return '-';
            
            const monthNames = ['Oca', '≈ûub', 'Mar', 'Nis', 'May', 'Haz', 'Tem', 'Aƒüu', 'Eyl', 'Eki', 'Kas', 'Ara'];
            const monthMap = { 'Jan': 0, 'Feb': 1, 'Mar': 2, 'Apr': 3, 'May': 4, 'Jun': 5, 
                               'Jul': 6, 'Aug': 7, 'Sep': 8, 'Oct': 9, 'Nov': 10, 'Dec': 11 };
            
            // Format: "02.Dec 14:00:00" veya "03.Dec 14:00:00"
            const match1 = dateStr.match(/^(\d{1,2})\.([A-Za-z]{3})\s+(\d{2}):(\d{2}):?(\d{2})?$/);
            if (match1) {
                const [, day, monthStr, hour, min] = match1;
                const monthIdx = monthMap[monthStr] ?? 0;
                const dt = new Date(2025, monthIdx, parseInt(day), parseInt(hour), parseInt(min));
                dt.setHours(dt.getHours() + 3); // +3 saat T√ºrkiye
                const monthName = monthNames[dt.getMonth()];
                const h = String(dt.getHours()).padStart(2, '0');
                const m = String(dt.getMinutes()).padStart(2, '0');
                const d = String(dt.getDate()).padStart(2, '0');
                return `${d} ${monthName} ${h}:${m}`;
            }
            
            // Format: "03.12.2025 14:00"
            const match2 = dateStr.match(/^(\d{2})\.(\d{2})\.(\d{4})\s+(\d{2}):(\d{2})$/);
            if (match2) {
                const [, day, month, year, hour, min] = match2;
                const dt = new Date(parseInt(year), parseInt(month) - 1, parseInt(day), parseInt(hour), parseInt(min));
                dt.setHours(dt.getHours() + 3); // +3 saat T√ºrkiye
                const monthName = monthNames[dt.getMonth()];
                const h = String(dt.getHours()).padStart(2, '0');
                const m = String(dt.getMinutes()).padStart(2, '0');
                const d = String(dt.getDate()).padStart(2, '0');
                return `${d} ${monthName} ${h}:${m}`;
            }
            
            return dateStr;
        }
        
        function getTodayDate() {
            const now = new Date();
            return now.toISOString().substring(0, 10);
        }
        
        function getYesterdayDate() {
            const now = new Date();
            now.setDate(now.getDate() - 1);
            return now.toISOString().substring(0, 10);
        }
        
        // D√ºn√ºn ma√ßlarƒ±nƒ± filtrele - sadece bug√ºn ve gelecek ma√ßlarƒ± g√∂ster
        // √ñNEMLƒ∞: match_date/fixture_date baz alƒ±nƒ±r, created_at DEƒûƒ∞L!
        function isMatchTodayOrFuture(alarm) {
            const matchDateStr = alarm.match_date || alarm.fixture_date || '';
            
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentDay = now.getDate();
            const currentYear = now.getFullYear();
            
            // SADECE match_date kontrol√º (format: "03.Dec 17:30:00" veya "04.Dec 15:00:00")
            if (matchDateStr) {
                const parts = matchDateStr.split(' ')[0];
                if (parts && parts.includes('.')) {
                    const [dayStr, monthStr] = parts.split('.');
                    const monthMap = { 'Jan': 0, 'Feb': 1, 'Mar': 2, 'Apr': 3, 'May': 4, 'Jun': 5, 
                                      'Jul': 6, 'Aug': 7, 'Sep': 8, 'Oct': 9, 'Nov': 10, 'Dec': 11 };
                    const matchMonth = monthMap[monthStr];
                    const matchDay = parseInt(dayStr);
                    
                    if (matchMonth !== undefined && !isNaN(matchDay)) {
                        // Bug√ºn veya gelecek tarihse g√∂ster
                        if (matchMonth > currentMonth) return true;
                        if (matchMonth === currentMonth && matchDay >= currentDay) return true;
                        // Yƒ±l ge√ßi≈üi durumu (Aralƒ±k -> Ocak)
                        if (matchMonth < currentMonth && currentMonth >= 10 && matchMonth <= 2) return true;
                        return false;
                    }
                }
            }
            
            // match_date yoksa g√∂sterme (eski/ge√ßersiz alarm)
            return false;
        }
        
        const dateFilterModes = {};
        
        function setDateFilter(alarmType, mode) {
            dateFilterModes[alarmType] = mode;
            
            const buttonGroup = event.target.parentElement;
            buttonGroup.querySelectorAll('.date-filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const filterFunctions = {
                'sharp': filterAlarms,
                'ht': filterPublicMoveAlarms,
                'insider': filterInsiderAlarms,
                'bigMoney': filterBigMoneyAlarms,
                'dropping': filterDroppingAlarms,
                'volumeShock': filterVolumeShockAlarms,
                'volumeLeader': filterVolumeLeaderAlarms,
                'mim': filterMimAlarms
            };
            
            if (filterFunctions[alarmType]) {
                filterFunctions[alarmType]();
            }
        }
        
        function filterAlarmsByDateMode(alarms, alarmType) {
            const mode = dateFilterModes[alarmType] || 'all';
            if (mode === 'all') return alarms;
            
            const today = getTodayDate();
            const yesterday = getYesterdayDate();
            
            return alarms.filter(alarm => {
                const alarmDate = parseAlarmDate(alarm);
                if (!alarmDate) return mode === 'all';
                
                if (mode === 'today') {
                    return alarmDate === today;
                } else if (mode === 'yesterday') {
                    return alarmDate === yesterday;
                } else if (mode === 'future') {
                    return alarmDate > today;
                }
                return true;
            });
        }
        
        function updateTotalCount(totalCountId, total) {
            const el = document.getElementById(totalCountId);
            if (el) {
                el.textContent = `(Toplam: ${total})`;
            }
        }

        function showPage(pageId) {
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
            });
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            document.getElementById('page-' + pageId).classList.add('active');
            document.querySelector(`[data-page="${pageId}"]`).classList.add('active');

            if (pageId === 'dashboard') loadDashboard();
            if (pageId === 'markets') loadMarkets();
            if (pageId === 'sharp') loadSharpAlarms();
            if (pageId === 'publicmove') loadPublicMovePage();
            if (pageId === 'insider') loadInsiderPage();
            if (pageId === 'bigmoney') loadBigMoneyPage();
            if (pageId === 'dropping') loadDroppingPage();
            if (pageId === 'volumeshock') loadVolumeShockPage();
            if (pageId === 'volumeleader') loadVolumeLeaderPage();
            if (pageId === 'mim') loadMimPage();
            if (pageId === 'telegram') loadTelegramPage();
        }
        
        async function loadTelegramPage() {
            await Promise.all([loadTelegramSettings(), loadTelegramStats()]);
        }

        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast ' + type + ' show';
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        async function loadDashboard() {
            console.log('[Admin] loadDashboard started');
            try {
                const response = await fetch('/api/status?t=' + Date.now());
                console.log('[Admin] Status response:', response.ok);
                if (response.ok) {
                    const data = await response.json();
                    console.log('[Admin] Status data:', data);
                    
                    const lastUpdateEl = document.getElementById('lastUpdate');
                    const supabaseStatusEl = document.getElementById('supabaseStatus');
                    const scraperModeEl = document.getElementById('scraperMode');
                    const workModeEl = document.getElementById('workMode');
                    const dbStatusEl = document.getElementById('dbStatus');
                    
                    if (lastUpdateEl) lastUpdateEl.textContent = data.last_data_update_tr || '-';
                    if (supabaseStatusEl) {
                        supabaseStatusEl.textContent = data.supabase_connected ? 'Bagli' : 'Bagli Degil';
                        supabaseStatusEl.className = 'info-value ' + (data.supabase_connected ? 'success' : 'error');
                    }
                    if (scraperModeEl) scraperModeEl.textContent = data.scraping_enabled ? 'Aktif' : 'Devre Disi';
                    if (workModeEl) workModeEl.textContent = data.mode || 'server';
                    if (dbStatusEl) {
                        dbStatusEl.textContent = data.supabase_connected ? 'OK' : 'Hata';
                        dbStatusEl.className = 'stat-value ' + (data.supabase_connected ? 'green' : 'red');
                    }
                }
            } catch (error) {
                console.error('[Admin] Dashboard yukleme hatasi:', error);
            }

            try {
                const response = await fetch('/api/matches?market=moneyway_1x2&t=' + Date.now());
                console.log('[Admin] Matches response:', response.ok);
                if (response.ok) {
                    const data = await response.json();
                    console.log('[Admin] Matches count:', Array.isArray(data) ? data.length : 0);
                    const totalMatchesEl = document.getElementById('totalMatches');
                    if (totalMatchesEl) totalMatchesEl.textContent = Array.isArray(data) ? data.length : 0;
                }
            } catch (error) {
                console.error('[Admin] Mac sayisi yukleme hatasi:', error);
            }
        }

        async function loadMarkets() {
            const markets = [
                { id: 'mw1x2Count', market: 'moneyway_1x2' },
                { id: 'mwou25Count', market: 'moneyway_ou25' },
                { id: 'mwbttsCount', market: 'moneyway_btts' },
                { id: 'dp1x2Count', market: 'dropping_1x2' },
                { id: 'dpou25Count', market: 'dropping_ou25' },
                { id: 'dpbttsCount', market: 'dropping_btts' }
            ];

            for (const m of markets) {
                try {
                    const response = await fetch(`/api/matches?market=${m.market}`);
                    if (response.ok) {
                        const data = await response.json();
                        document.getElementById(m.id).textContent = Array.isArray(data) ? data.length : 0;
                    }
                } catch (error) {
                    document.getElementById(m.id).textContent = 'Hata';
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadDashboard();
            loadAlarms();
            loadSharpConfig();
        });

        function getSharpConfig() {
            return {
                min_volume_1x2: parseInt(document.getElementById('min_volume_1x2').value) || 3000,
                min_volume_ou25: parseInt(document.getElementById('min_volume_ou25').value) || 1000,
                min_volume_btts: parseInt(document.getElementById('min_volume_btts').value) || 500,
                min_amount_change: parseInt(document.getElementById('min_amount_change').value) || 500,
                volume_multiplier: parseFloat(document.getElementById('volume_multiplier').value) || 1,
                share_range_1_min: parseFloat(document.getElementById('share_range_1_min').value) || 0,
                share_range_1_max: parseFloat(document.getElementById('share_range_1_max').value) || 50,
                share_range_1_mult: parseFloat(document.getElementById('share_range_1_mult').value) || 1,
                share_range_2_min: parseFloat(document.getElementById('share_range_2_min').value) || 50,
                share_range_2_max: parseFloat(document.getElementById('share_range_2_max').value) || 75,
                share_range_2_mult: parseFloat(document.getElementById('share_range_2_mult').value) || 1.5,
                share_range_3_min: parseFloat(document.getElementById('share_range_3_min').value) || 75,
                share_range_3_max: parseFloat(document.getElementById('share_range_3_max').value) || 90,
                share_range_3_mult: parseFloat(document.getElementById('share_range_3_mult').value) || 2,
                share_range_4_min: parseFloat(document.getElementById('share_range_4_min').value) || 90,
                share_range_4_max: parseFloat(document.getElementById('share_range_4_max').value) || 100,
                share_range_4_mult: parseFloat(document.getElementById('share_range_4_mult').value) || 3,
                max_volume_cap: parseFloat(document.getElementById('max_volume_cap').value) || 40,
                max_odds_cap: parseFloat(document.getElementById('max_odds_cap').value) || 35,
                max_share_cap: parseFloat(document.getElementById('max_share_cap').value) || 25,
                min_share: parseFloat(document.getElementById('min_share').value) || 5,
                min_sharp_score: parseFloat(document.getElementById('min_sharp_score').value) || 10,
                odds_range_1_min: parseFloat(document.getElementById('odds_range_1_min').value) || 1.01,
                odds_range_1_max: parseFloat(document.getElementById('odds_range_1_max').value) || 1.50,
                odds_range_1_mult: parseFloat(document.getElementById('odds_range_1_mult').value) || 10,
                odds_range_1_min_drop: parseFloat(document.getElementById('odds_range_1_min_drop').value) || 1,
                odds_range_2_min: parseFloat(document.getElementById('odds_range_2_min').value) || 1.50,
                odds_range_2_max: parseFloat(document.getElementById('odds_range_2_max').value) || 2.10,
                odds_range_2_mult: parseFloat(document.getElementById('odds_range_2_mult').value) || 8,
                odds_range_2_min_drop: parseFloat(document.getElementById('odds_range_2_min_drop').value) || 2,
                odds_range_3_min: parseFloat(document.getElementById('odds_range_3_min').value) || 2.10,
                odds_range_3_max: parseFloat(document.getElementById('odds_range_3_max').value) || 3.50,
                odds_range_3_mult: parseFloat(document.getElementById('odds_range_3_mult').value) || 5,
                odds_range_3_min_drop: parseFloat(document.getElementById('odds_range_3_min_drop').value) || 3,
                odds_range_4_min: parseFloat(document.getElementById('odds_range_4_min').value) || 3.50,
                odds_range_4_max: parseFloat(document.getElementById('odds_range_4_max').value) || 10.00,
                odds_range_4_mult: parseFloat(document.getElementById('odds_range_4_mult').value) || 3,
                odds_range_4_min_drop: parseFloat(document.getElementById('odds_range_4_min_drop').value) || 5
            };
        }

        function setSharpConfig(config) {
            if (!config) return;
            document.getElementById('min_volume_1x2').value = config.min_volume_1x2 ?? '';
            document.getElementById('min_volume_ou25').value = config.min_volume_ou25 ?? '';
            document.getElementById('min_volume_btts').value = config.min_volume_btts ?? '';
            document.getElementById('min_amount_change').value = config.min_amount_change ?? '';
            document.getElementById('volume_multiplier').value = config.volume_multiplier ?? '';
            document.getElementById('share_range_1_min').value = config.share_range_1_min ?? '';
            document.getElementById('share_range_1_max').value = config.share_range_1_max ?? '';
            document.getElementById('share_range_1_mult').value = config.share_range_1_mult ?? '';
            document.getElementById('share_range_2_min').value = config.share_range_2_min ?? '';
            document.getElementById('share_range_2_max').value = config.share_range_2_max ?? '';
            document.getElementById('share_range_2_mult').value = config.share_range_2_mult ?? '';
            document.getElementById('share_range_3_min').value = config.share_range_3_min ?? '';
            document.getElementById('share_range_3_max').value = config.share_range_3_max ?? '';
            document.getElementById('share_range_3_mult').value = config.share_range_3_mult ?? '';
            document.getElementById('share_range_4_min').value = config.share_range_4_min ?? '';
            document.getElementById('share_range_4_max').value = config.share_range_4_max ?? '';
            document.getElementById('share_range_4_mult').value = config.share_range_4_mult ?? '';
            document.getElementById('max_volume_cap').value = config.max_volume_cap ?? '';
            document.getElementById('max_odds_cap').value = config.max_odds_cap ?? '';
            document.getElementById('max_share_cap').value = config.max_share_cap ?? '';
            document.getElementById('min_share').value = config.min_share ?? '';
            document.getElementById('min_sharp_score').value = config.min_sharp_score ?? '';
            document.getElementById('odds_range_1_min').value = config.odds_range_1_min ?? '';
            document.getElementById('odds_range_1_max').value = config.odds_range_1_max ?? '';
            document.getElementById('odds_range_1_mult').value = config.odds_range_1_mult ?? '';
            document.getElementById('odds_range_1_min_drop').value = config.odds_range_1_min_drop ?? '';
            document.getElementById('odds_range_2_min').value = config.odds_range_2_min ?? '';
            document.getElementById('odds_range_2_max').value = config.odds_range_2_max ?? '';
            document.getElementById('odds_range_2_mult').value = config.odds_range_2_mult ?? '';
            document.getElementById('odds_range_2_min_drop').value = config.odds_range_2_min_drop ?? '';
            document.getElementById('odds_range_3_min').value = config.odds_range_3_min ?? '';
            document.getElementById('odds_range_3_max').value = config.odds_range_3_max ?? '';
            document.getElementById('odds_range_3_mult').value = config.odds_range_3_mult ?? '';
            document.getElementById('odds_range_3_min_drop').value = config.odds_range_3_min_drop ?? '';
            document.getElementById('odds_range_4_min').value = config.odds_range_4_min ?? '';
            document.getElementById('odds_range_4_max').value = config.odds_range_4_max ?? '';
            document.getElementById('odds_range_4_mult').value = config.odds_range_4_mult ?? '';
            document.getElementById('odds_range_4_min_drop').value = config.odds_range_4_min_drop ?? '';
        }

        async function deleteAlarmConfig(alarmType) {
            const alarmNames = {
                'sharp': 'Sharp',
                'insider': 'Insider',
                'bigmoney': 'Big Money',
                'volumeshock': 'Hacim Soku',
                'dropping': 'Dropping',
                'publicmove': 'Public Move',
                'volumeleader': 'Hacim Lideri'
            };
            const displayName = alarmNames[alarmType] || alarmType;
            
            if (!confirm(`${displayName} alarm AYARLARINI silmek istediginizden emin misiniz?\n\nBu islem alarm kosullarini sifirlar. Yeni config kaydetmeniz gerekecek.`)) return;
            
            try {
                const response = await fetch(`/api/alarm-settings/${alarmType}`, {
                    method: 'DELETE'
                });
                const data = await response.json();
                if (data.status === 'ok') {
                    showToast(`${displayName} ayarlari silindi!`, 'success');
                } else {
                    showToast(`Silme hatasi: ${data.message}`, 'error');
                }
            } catch (error) {
                showToast('Baglanti hatasi!', 'error');
                console.error('Delete config error:', error);
            }
        }

        async function saveSharpConfig() {
            const config = getSharpConfig();
            try {
                const response = await fetch('/api/sharp/config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });
                if (response.ok) {
                    showToast('Ayarlar kaydedildi!', 'success');
                } else {
                    showToast('Kaydetme hatasi!', 'error');
                }
            } catch (error) {
                showToast('Baglanti hatasi!', 'error');
            }
        }

        async function loadSharpConfig() {
            try {
                const response = await fetch('/api/sharp/config');
                if (response.ok) {
                    const config = await response.json();
                    setSharpConfig(config);
                }
            } catch (error) {
                console.error('Config yukleme hatasi:', error);
            }
        }

        async function deleteAllAlarms() {
            if (!confirm('Tum Sharp alarmlarini silmek istediginizden emin misiniz?')) return;
            try {
                const response = await fetch('/api/sharp/alarms', { method: 'DELETE' });
                if (response.ok) {
                    showToast('Tum alarmlar silindi!', 'success');
                    loadAlarms();
                } else {
                    showToast('Silme hatasi!', 'error');
                }
            } catch (error) {
                showToast('Baglanti hatasi!', 'error');
            }
        }

        let calcStatusInterval = null;
        
        async function resetSharpCalculation() {
            try {
                const response = await fetch('/api/sharp/reset', { method: 'POST' });
                const data = await response.json();
                if (data.success) {
                    hideCalcStatus();
                    showToast('Sharp hesaplama sifirlandi!', 'success');
                }
            } catch (error) {
                showToast('Sifirlama hatasi!', 'error');
            }
        }

        async function recalculateAlarms() {
            showToast('Alarmlar hesaplaniyor...', 'info');
            showCalcStatus(true, 'Hesaplama baslatiliyor...');
            
            try {
                startCalcStatusCheck();
                
                const response = await fetch('/api/sharp/calculate', { method: 'POST' });
                
                stopCalcStatusCheck();
                
                if (response.ok) {
                    const result = await response.json();
                    showCalcStatus(false, `Tamamlandi! ${result.count || 0} alarm bulundu.`);
                    showToast(`${result.count || 0} alarm uretildi!`, 'success');
                    loadAlarms();
                    
                    setTimeout(() => hideCalcStatus(), 3000);
                } else {
                    showCalcStatus(false, 'Hesaplama hatasi!');
                    showToast('Hesaplama hatasi!', 'error');
                }
            } catch (error) {
                stopCalcStatusCheck();
                showCalcStatus(false, 'Baglanti hatasi!');
                showToast('Baglanti hatasi!', 'error');
            }
        }

        async function resetInsiderCalculation() {
            try {
                const response = await fetch('/api/insider/reset', { method: 'POST' });
                const data = await response.json();
                if (data.success) {
                    hideInsiderCalcStatus();
                    showToast('Insider hesaplama sifirlandi!', 'success');
                }
            } catch (error) {
                showToast('Sifirlama hatasi!', 'error');
            }
        }
        
        async function recalculateInsiderAlarms() {
            showToast('Insider alarmlar hesaplaniyor...', 'info');
            showInsiderCalcStatus(true, 'Insider alarm hesaplama baslatiliyor...');
            
            try {
                const response = await fetch('/api/insider/calculate', { method: 'POST' });
                
                if (response.ok) {
                    const result = await response.json();
                    showInsiderCalcStatus(false, `Tamamlandi! ${result.count || 0} Insider alarm bulundu.`);
                    showToast(`${result.count || 0} Insider alarm uretildi!`, 'success');
                    loadInsiderAlarms();
                    
                    setTimeout(() => hideInsiderCalcStatus(), 3000);
                } else {
                    showInsiderCalcStatus(false, 'Insider hesaplama hatasi!');
                    showToast('Insider hesaplama hatasi!', 'error');
                }
            } catch (error) {
                showInsiderCalcStatus(false, 'Baglanti hatasi!');
                showToast('Baglanti hatasi!', 'error');
            }
        }

        function showInsiderCalcStatus(isCalculating, message) {
            const statusEl = document.getElementById('insiderCalcStatus');
            const progressEl = document.getElementById('insiderCalcProgress');
            const spinnerEl = statusEl.querySelector('.spinner');
            
            statusEl.style.display = 'block';
            progressEl.textContent = message;
            
            if (isCalculating) {
                spinnerEl.style.display = 'block';
                progressEl.style.color = '#a371f7';
                statusEl.style.borderLeftColor = '#a371f7';
            } else {
                spinnerEl.style.display = 'none';
                progressEl.style.color = '#3fb950';
                statusEl.style.borderLeftColor = '#3fb950';
            }
        }

        function hideInsiderCalcStatus() {
            const statusEl = document.getElementById('insiderCalcStatus');
            statusEl.style.display = 'none';
        }

        function showCalcStatus(isCalculating, message) {
            const statusEl = document.getElementById('calcStatus');
            const progressEl = document.getElementById('calcProgress');
            const spinnerEl = statusEl.querySelector('.spinner');
            
            statusEl.style.display = 'block';
            progressEl.textContent = message;
            
            if (isCalculating) {
                spinnerEl.style.display = 'block';
                progressEl.style.color = '#f0883e';
                statusEl.style.borderLeftColor = '#f0883e';
            } else {
                spinnerEl.style.display = 'none';
                progressEl.style.color = '#3fb950';
                statusEl.style.borderLeftColor = '#3fb950';
            }
        }

        function hideCalcStatus() {
            document.getElementById('calcStatus').style.display = 'none';
        }

        function startCalcStatusCheck() {
            calcStatusInterval = setInterval(async () => {
                try {
                    const response = await fetch('/api/sharp/status');
                    if (response.ok) {
                        const status = await response.json();
                        if (status.calculating) {
                            showCalcStatus(true, status.progress || 'Hesaplama devam ediyor...');
                        }
                    }
                } catch (e) {}
            }, 1000);
        }

        function stopCalcStatusCheck() {
            if (calcStatusInterval) {
                clearInterval(calcStatusInterval);
                calcStatusInterval = null;
            }
        }

        let allAlarms = [];
        
        async function loadSharpAlarms() {
            try {
                const response = await fetch('/api/sharp/alarms');
                if (response.ok) {
                    const alarms = await response.json();
                    // Yeniden eskiye sirala
                    allAlarms = sortAlarmsNewestFirst(alarms);
                    updateTotalCount('alarmTotalCount', allAlarms.length);
                    renderSharpAlarms(allAlarms);
                }
            } catch (error) {
                console.error('Sharp alarm yukleme hatasi:', error);
            }
        }

        function loadAlarms() {
            loadSharpAlarms();
        }

        function filterAlarms() {
            const searchTerm = document.getElementById('alarmSearchInput').value.toLowerCase().trim();
            let filtered = filterAlarmsByDateMode(allAlarms, 'sharp');
            
            if (searchTerm) {
                filtered = filtered.filter(alarm => 
                    (alarm.home || '').toLowerCase().includes(searchTerm) ||
                    (alarm.away || '').toLowerCase().includes(searchTerm)
                );
            }
            
            updateTotalCount('alarmTotalCount', allAlarms.length);
            renderAlarms(filtered, allAlarms.length);
        }

        function renderSharpAlarms(alarms, totalCount = null) {
            const container = document.getElementById('alarmList');
            const countEl = document.getElementById('alarmCount');
            
            if (!alarms || alarms.length === 0) {
                const searchTerm = document.getElementById('alarmSearchInput')?.value || '';
                if (searchTerm) {
                    container.innerHTML = '<p style="color: #8b949e; padding: 20px 0; text-align: center;">Aramayla eslesen alarm yok.</p>';
                    countEl.textContent = `0/${totalCount || 0}`;
                } else {
                    container.innerHTML = '<p style="color: #8b949e; padding: 20px 0; text-align: center;">Henuz alarm yok.</p>';
                    countEl.textContent = '0';
                }
                return;
            }

            countEl.textContent = totalCount ? `${alarms.length}/${totalCount}` : alarms.length;
            container.innerHTML = alarms.map((alarm, idx) => `
                <div class="alarm-item" onclick="showAlarmDetail(${idx})">
                    <div class="alarm-info">
                        <div class="alarm-match">${alarm.home} vs ${alarm.away}</div>
                        <div class="alarm-meta">${alarm.market} | ${alarm.selection} | ${alarm.created_at || ''}</div>
                        <div class="alarm-breakdown" style="display: flex; gap: 12px; margin-top: 6px; font-size: 11px;">
                            <span style="color: #f0883e;" title="Hacim Katkisi">‚ö° ${(alarm.volume_contrib || alarm.shock_value || 0).toFixed(1)}</span>
                            <span style="color: #58a6ff;" title="Oran Katkisi">üìâ ${(alarm.odds_contrib || alarm.odds_value || 0).toFixed(1)}</span>
                            <span style="color: #3fb950;" title="Pay Katkisi">üìä ${(alarm.share_contrib || alarm.share_value || 0).toFixed(1)}</span>
                        </div>
                    </div>
                    <div class="alarm-score">${(alarm.sharp_score || alarm.smart_score || 0).toFixed(1)}</div>
                </div>
            `).join('');

            window.currentAlarms = alarms;
        }

        function renderAlarms(alarms, totalCount = null) {
            renderSharpAlarms(alarms, totalCount);
        }

        // ==================== PUBLIC MOVE FUNCTIONS ====================
        let allPublicMoveAlarms = [];

        async function loadPublicMovePage() {
            await loadPublicMoveConfig();
            await loadPublicMoveAlarms();
        }

        async function loadPublicMoveConfig() {
            try {
                const response = await fetch('/api/publicmove/config');
                if (response.ok) {
                    const config = await response.json();
                    document.getElementById('ht_min_volume_1x2').value = config.min_volume_1x2 ?? '';
                    document.getElementById('ht_min_volume_ou25').value = config.min_volume_ou25 ?? '';
                    document.getElementById('ht_min_volume_btts').value = config.min_volume_btts ?? '';
                    document.getElementById('ht_volume_multiplier').value = config.volume_multiplier ?? '';
                    document.getElementById('ht_max_volume_cap').value = config.max_volume_cap ?? '';
                    document.getElementById('ht_max_odds_cap').value = config.max_odds_cap ?? '';
                    document.getElementById('ht_max_share_cap').value = config.max_share_cap ?? '';
                    document.getElementById('ht_min_share').value = config.min_share ?? '';
                    document.getElementById('ht_min_sharp_score').value = config.min_sharp_score ?? '';
                    document.getElementById('ht_min_amount_change').value = config.min_amount_change ?? '';
                    
                    document.getElementById('ht_odds_range_1_min').value = config.odds_range_1_min ?? '';
                    document.getElementById('ht_odds_range_1_max').value = config.odds_range_1_max ?? '';
                    document.getElementById('ht_odds_range_1_mult').value = config.odds_range_1_mult ?? '';
                    document.getElementById('ht_odds_range_2_min').value = config.odds_range_2_min ?? '';
                    document.getElementById('ht_odds_range_2_max').value = config.odds_range_2_max ?? '';
                    document.getElementById('ht_odds_range_2_mult').value = config.odds_range_2_mult ?? '';
                    document.getElementById('ht_odds_range_3_min').value = config.odds_range_3_min ?? '';
                    document.getElementById('ht_odds_range_3_max').value = config.odds_range_3_max ?? '';
                    document.getElementById('ht_odds_range_3_mult').value = config.odds_range_3_mult ?? '';
                    document.getElementById('ht_odds_range_4_min').value = config.odds_range_4_min ?? '';
                    document.getElementById('ht_odds_range_4_max').value = config.odds_range_4_max ?? '';
                    document.getElementById('ht_odds_range_4_mult').value = config.odds_range_4_mult ?? '';
                    
                    document.getElementById('ht_share_range_1_min').value = config.share_range_1_min ?? '';
                    document.getElementById('ht_share_range_1_max').value = config.share_range_1_max ?? '';
                    document.getElementById('ht_share_range_1_mult').value = config.share_range_1_mult ?? '';
                    document.getElementById('ht_share_range_2_min').value = config.share_range_2_min ?? '';
                    document.getElementById('ht_share_range_2_max').value = config.share_range_2_max ?? '';
                    document.getElementById('ht_share_range_2_mult').value = config.share_range_2_mult ?? '';
                    document.getElementById('ht_share_range_3_min').value = config.share_range_3_min ?? '';
                    document.getElementById('ht_share_range_3_max').value = config.share_range_3_max ?? '';
                    document.getElementById('ht_share_range_3_mult').value = config.share_range_3_mult ?? '';
                    document.getElementById('ht_share_range_4_min').value = config.share_range_4_min ?? '';
                    document.getElementById('ht_share_range_4_max').value = config.share_range_4_max ?? '';
                    document.getElementById('ht_share_range_4_mult').value = config.share_range_4_mult ?? '';
                }
            } catch (error) {
                console.error('PublicMove config yukleme hatasi:', error);
            }
        }

        async function loadPublicMoveAlarms() {
            try {
                const response = await fetch('/api/publicmove/alarms');
                if (response.ok) {
                    const alarms = await response.json();
                    // Yeniden eskiye sirala
                    allPublicMoveAlarms = sortAlarmsNewestFirst(alarms);
                    updateTotalCount('htAlarmTotalCount', allPublicMoveAlarms.length);
                    renderPublicMoveAlarms(allPublicMoveAlarms);
                }
            } catch (error) {
                console.error('PublicMove alarm yukleme hatasi:', error);
            }
        }

        function renderPublicMoveAlarms(alarms, totalCount = null) {
            const container = document.getElementById('htAlarmList');
            const countEl = document.getElementById('htAlarmCount');
            
            if (!alarms || alarms.length === 0) {
                const searchTerm = document.getElementById('htAlarmSearchInput')?.value || '';
                if (searchTerm) {
                    container.innerHTML = '<p style="color: #8b949e; padding: 20px 0; text-align: center;">Aramayla eslesen alarm yok.</p>';
                    countEl.textContent = `0/${totalCount || 0}`;
                } else {
                    container.innerHTML = '<p style="color: #8b949e; padding: 20px 0; text-align: center;">Henuz Public Move alarm yok.</p>';
                    countEl.textContent = '0';
                }
                return;
            }

            countEl.textContent = totalCount ? `${alarms.length}/${totalCount}` : alarms.length;
            container.innerHTML = alarms.map((alarm, idx) => {
                const details = alarm.calc_details || {};
                const hasDetails = Object.keys(details).length > 0;
                
                // Eƒüer calc_details yoksa, eski alarmlar i√ßin mesaj g√∂ster
                const detailsContent = hasDetails ? `
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px;">
                        <!-- Hacim ≈ûoku -->
                        <div style="background: #21262d; padding: 8px; border-radius: 6px;">
                            <div style="color: #FFD700; font-weight: 600; margin-bottom: 4px;">‚ö° Hacim ≈ûoku</div>
                            <div style="color: #c9d1d9;">Para Giri≈üi: <span style="color: #3fb950;">¬£${(alarm.amount_change || 0).toLocaleString('en-GB')}</span></div>
                            <div style="color: #8b949e;">√áarpan: √ó${details.volume_multiplier || 1}</div>
                            <div style="color: #8b949e;">Max Cap: ${details.max_volume_cap || 40}</div>
                            <div style="color: #FFD700; margin-top: 4px; font-weight: 600;">= ${(alarm.shock_value || 0).toFixed(2)}</div>
                        </div>
                        <!-- Oran Deƒüi≈üimi -->
                        <div style="background: #21262d; padding: 8px; border-radius: 6px;">
                            <div style="color: #58a6ff; font-weight: 600; margin-bottom: 4px;">üìâ Oran D√º≈ü√º≈ü√º</div>
                            <div style="color: #c9d1d9;">Oran: <span style="color: #f85149;">${details.prev_odds}</span> ‚Üí <span style="color: #3fb950;">${alarm.current_odds}</span></div>
                            <div style="color: #c9d1d9;">D√º≈ü√º≈ü: <span style="color: #58a6ff;">%${details.drop_pct.toFixed(2)}</span></div>
                            <div style="color: #8b949e;">Min D√º≈ü√º≈ü: %${details.min_drop_threshold}</div>
                            <div style="color: #8b949e;">√áarpan: √ó${details.odds_mult}</div>
                            <div style="color: #58a6ff; margin-top: 4px; font-weight: 600;">= ${(alarm.odds_value || 0).toFixed(2)}</div>
                        </div>
                        <!-- Pay Deƒüi≈üimi -->
                        <div style="background: #21262d; padding: 8px; border-radius: 6px;">
                            <div style="color: #3fb950; font-weight: 600; margin-bottom: 4px;">üìä Pay Deƒüi≈üimi</div>
                            <div style="color: #c9d1d9;">Pay: <span style="color: #8b949e;">${details.prev_share}%</span> ‚Üí <span style="color: #3fb950;">${(alarm.current_share || 0).toFixed(1)}%</span></div>
                            <div style="color: #c9d1d9;">Artƒ±≈ü: <span style="color: #3fb950;">+${details.share_diff.toFixed(2)}%</span></div>
                            <div style="color: #8b949e;">√áarpan: √ó${details.share_mult}</div>
                            <div style="color: #3fb950; margin-top: 4px; font-weight: 600;">= ${(alarm.share_value || 0).toFixed(2)}</div>
                        </div>
                    </div>
                    <!-- Toplam Skor -->
                    <div style="margin-top: 12px; padding: 8px; background: linear-gradient(135deg, #FFCC00, #FFD700); border-radius: 6px; text-align: center;">
                        <span style="color: #000; font-weight: 600; font-size: 12px;">
                            TOPLAM SKOR = ${(alarm.shock_value || 0).toFixed(1)} + ${(alarm.odds_value || 0).toFixed(1)} + ${(alarm.share_value || 0).toFixed(1)} = <span style="font-size: 14px;">${(alarm.sharp_score || 0).toFixed(1)}</span>
                        </span>
                    </div>
                    <div style="margin-top: 8px; color: #8b949e; font-size: 10px; text-align: center;">
                        Min Skor E≈üiƒüi: ${details.min_sharp_score || 10} | Hacim: ¬£${(alarm.volume || 0).toLocaleString('en-GB')}
                    </div>
                ` : `
                    <div style="text-align: center; padding: 20px; color: #f0883e;">
                        <div style="font-size: 24px; margin-bottom: 8px;">‚ö†Ô∏è</div>
                        <div>Bu alarm eski formatta. Detaylarƒ± g√∂rmek i√ßin:</div>
                        <div style="margin-top: 8px;"><strong>"Alarmlarƒ± Yeniden Hesapla"</strong> butonuna basƒ±n.</div>
                    </div>
                `;
                
                return `
                <div class="alarm-item" style="border-left: 3px solid #FFD700; cursor: pointer;" onclick="toggleHtCalcDetails(${idx})">
                    <div class="alarm-info" style="flex: 1;">
                        <div class="alarm-match">
                            <span style="background:linear-gradient(135deg, #FFCC00, #FFD700);color:#000;padding:2px 6px;border-radius:4px;font-size:10px;margin-right:8px;font-weight:600;">ü™§ PUBLIC MOVE</span>
                            ${alarm.home} vs ${alarm.away}
                            <span style="color: #8b949e; font-size: 10px; margin-left: 8px;">‚ñº detay</span>
                        </div>
                        <div class="alarm-meta">${alarm.market} | ${alarm.selection} | ${alarm.event_time || ''}</div>
                        <div class="alarm-breakdown" style="display: flex; gap: 12px; margin-top: 6px; font-size: 11px;">
                            <span style="color: #FFD700;" title="Hacim">üí∞ ¬£${Math.round(alarm.volume || 0).toLocaleString('en-GB')}</span>
                            <span style="color: #58a6ff;" title="Oran Dususu">üìâ ${(alarm.odds_drop || 0).toFixed(2)}</span>
                            <span style="color: #3fb950;" title="Pay Degisimi">üìä ${(alarm.delta || alarm.share_change || 0).toFixed(1)}%</span>
                        </div>
                        <!-- Hesaplama Detaylarƒ± -->
                        <div id="htCalcDetails_${idx}" style="display: none; margin-top: 12px; padding: 12px; background: #161b22; border-radius: 8px; font-size: 11px; border: 1px solid #30363d;">
                            <div style="font-weight: 600; color: #f0883e; margin-bottom: 8px; font-size: 12px;">üìä Hesaplama Detaylarƒ±</div>
                            ${detailsContent}
                        </div>
                    </div>
                    <div class="alarm-score" style="background: linear-gradient(135deg, #FFCC00, #FFD700); color: #000;">${(alarm.move_score || alarm.trap_score || alarm.sharp_score || 0).toFixed(1)}</div>
                </div>
            `}).join('');
        }
        
        function toggleHtCalcDetails(idx) {
            const detailEl = document.getElementById(`htCalcDetails_${idx}`);
            if (detailEl) {
                detailEl.style.display = detailEl.style.display === 'none' ? 'block' : 'none';
            }
        }

        function filterPublicMoveAlarms() {
            const searchTerm = document.getElementById('htAlarmSearchInput').value.toLowerCase().trim();
            let filtered = filterAlarmsByDateMode(allPublicMoveAlarms, 'ht');
            
            if (searchTerm) {
                filtered = filtered.filter(alarm => 
                    (alarm.home || '').toLowerCase().includes(searchTerm) ||
                    (alarm.away || '').toLowerCase().includes(searchTerm)
                );
            }
            
            updateTotalCount('htAlarmTotalCount', allPublicMoveAlarms.length);
            renderPublicMoveAlarms(filtered, allPublicMoveAlarms.length);
        }

        async function savePublicMoveConfig() {
            const config = {
                min_volume_1x2: parseInt(document.getElementById('ht_min_volume_1x2').value) || 3000,
                min_volume_ou25: parseInt(document.getElementById('ht_min_volume_ou25').value) || 1000,
                min_volume_btts: parseInt(document.getElementById('ht_min_volume_btts').value) || 500,
                volume_multiplier: parseFloat(document.getElementById('ht_volume_multiplier').value) || 1,
                max_volume_cap: parseInt(document.getElementById('ht_max_volume_cap').value) || 40,
                max_odds_cap: parseInt(document.getElementById('ht_max_odds_cap').value) || 35,
                max_share_cap: parseInt(document.getElementById('ht_max_share_cap').value) || 25,
                min_share: parseFloat(document.getElementById('ht_min_share').value) || 5,
                min_sharp_score: parseFloat(document.getElementById('ht_min_sharp_score').value) || 10,
                min_amount_change: parseInt(document.getElementById('ht_min_amount_change').value) || 500,
                
                odds_range_1_min: parseFloat(document.getElementById('ht_odds_range_1_min').value) || 1.01,
                odds_range_1_max: parseFloat(document.getElementById('ht_odds_range_1_max').value) || 1.50,
                odds_range_1_mult: parseFloat(document.getElementById('ht_odds_range_1_mult').value) || 10,
                odds_range_2_min: parseFloat(document.getElementById('ht_odds_range_2_min').value) || 1.50,
                odds_range_2_max: parseFloat(document.getElementById('ht_odds_range_2_max').value) || 2.10,
                odds_range_2_mult: parseFloat(document.getElementById('ht_odds_range_2_mult').value) || 8,
                odds_range_3_min: parseFloat(document.getElementById('ht_odds_range_3_min').value) || 2.10,
                odds_range_3_max: parseFloat(document.getElementById('ht_odds_range_3_max').value) || 3.50,
                odds_range_3_mult: parseFloat(document.getElementById('ht_odds_range_3_mult').value) || 5,
                odds_range_4_min: parseFloat(document.getElementById('ht_odds_range_4_min').value) || 3.50,
                odds_range_4_max: parseFloat(document.getElementById('ht_odds_range_4_max').value) || 10.00,
                odds_range_4_mult: parseFloat(document.getElementById('ht_odds_range_4_mult').value) || 3,
                
                share_range_1_min: parseFloat(document.getElementById('ht_share_range_1_min').value) || 0,
                share_range_1_max: parseFloat(document.getElementById('ht_share_range_1_max').value) || 50,
                share_range_1_mult: parseFloat(document.getElementById('ht_share_range_1_mult').value) || 1,
                share_range_2_min: parseFloat(document.getElementById('ht_share_range_2_min').value) || 50,
                share_range_2_max: parseFloat(document.getElementById('ht_share_range_2_max').value) || 75,
                share_range_2_mult: parseFloat(document.getElementById('ht_share_range_2_mult').value) || 1.5,
                share_range_3_min: parseFloat(document.getElementById('ht_share_range_3_min').value) || 75,
                share_range_3_max: parseFloat(document.getElementById('ht_share_range_3_max').value) || 90,
                share_range_3_mult: parseFloat(document.getElementById('ht_share_range_3_mult').value) || 2,
                share_range_4_min: parseFloat(document.getElementById('ht_share_range_4_min').value) || 90,
                share_range_4_max: parseFloat(document.getElementById('ht_share_range_4_max').value) || 100,
                share_range_4_mult: parseFloat(document.getElementById('ht_share_range_4_mult').value) || 3
            };

            try {
                const response = await fetch('/api/publicmove/config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });
                if (response.ok) {
                    showToast('Public Move ayarlari kaydedildi!', 'success');
                } else {
                    showToast('Kaydetme hatasi!', 'error');
                }
            } catch (error) {
                showToast('Hata: ' + error.message, 'error');
            }
        }

        async function resetPublicMoveCalculation() {
            try {
                const response = await fetch('/api/publicmove/reset', { method: 'POST' });
                const data = await response.json();
                if (data.success) {
                    document.getElementById('htCalcStatus').style.display = 'none';
                    showToast('Public Move hesaplama sifirlandi!', 'success');
                }
            } catch (error) {
                showToast('Sifirlama hatasi!', 'error');
            }
        }
        
        async function recalculatePublicMoveAlarms() {
            const statusEl = document.getElementById('htCalcStatus');
            const progressEl = document.getElementById('htCalcProgress');
            
            statusEl.style.display = 'block';
            progressEl.textContent = 'Hesaplama baslatiliyor...';

            try {
                const response = await fetch('/api/publicmove/calculate', { method: 'POST' });
                if (response.ok) {
                    const checkStatus = async () => {
                        const statusRes = await fetch('/api/publicmove/status');
                        if (statusRes.ok) {
                            const status = await statusRes.json();
                            progressEl.textContent = status.progress || 'Hesaplaniyor...';
                            if (!status.calculating) {
                                statusEl.style.display = 'none';
                                showToast(`Hesaplama tamamlandi! ${status.alarm_count} alarm bulundu.`, 'success');
                                loadPublicMoveAlarms();
                                return;
                            }
                            setTimeout(checkStatus, 1000);
                        }
                    };
                    checkStatus();
                } else {
                    statusEl.style.display = 'none';
                    showToast('Hesaplama hatasi!', 'error');
                }
            } catch (error) {
                statusEl.style.display = 'none';
                showToast('Hata: ' + error.message, 'error');
            }
        }

        async function deleteAllPublicMoveAlarms() {
            if (!confirm('Tum Public Move alarmlarini silmek istediginize emin misiniz?')) return;
            
            try {
                const response = await fetch('/api/publicmove/alarms', { method: 'DELETE' });
                if (response.ok) {
                    showToast('Tum Public Move alarmlari silindi!', 'success');
                    loadPublicMoveAlarms();
                } else {
                    showToast('Silme hatasi!', 'error');
                }
            } catch (error) {
                showToast('Hata: ' + error.message, 'error');
            }
        }

        // ==================== INSIDER INFO FUNCTIONS ====================
        let allInsiderAlarms = [];

        async function loadInsiderPage() {
            await loadInsiderConfig();
            await loadInsiderAlarms();
        }

        async function loadInsiderConfig() {
            try {
                const response = await fetch('/api/alarm-settings/insider');
                if (response.ok) {
                    const data = await response.json();
                    const config = data.setting?.config || {};
                    document.getElementById('insider_hacim_sok_esigi').value = config.hacim_sok_esigi ?? '';
                    document.getElementById('insider_oran_dusus_esigi').value = config.oran_dusus_esigi ?? '';
                    document.getElementById('insider_sure_dakika').value = config.sure_dakika ?? '';
                    document.getElementById('insider_max_para').value = config.max_para ?? '';
                    document.getElementById('insider_max_odds_esigi').value = config.max_odds_esigi ?? '';
                }
            } catch (error) {
                console.error('Insider config yukleme hatasi:', error);
            }
        }

        async function loadInsiderAlarms() {
            try {
                const response = await fetch('/api/insider/alarms');
                if (response.ok) {
                    const alarms = await response.json();
                    // Yeniden eskiye sirala
                    allInsiderAlarms = sortAlarmsNewestFirst(alarms);
                    updateTotalCount('insiderAlarmTotalCount', allInsiderAlarms.length);
                    renderInsiderAlarms(allInsiderAlarms);
                }
            } catch (error) {
                console.error('Insider alarm yukleme hatasi:', error);
            }
        }

        let expandedInsiderAlarms = {};
        
        function renderInsiderAlarms(alarms, totalCount = null) {
            const container = document.getElementById('insiderAlarmList');
            const countEl = document.getElementById('insiderAlarmCount');
            
            if (!alarms || alarms.length === 0) {
                const searchTerm = document.getElementById('insiderSearchInput')?.value || '';
                if (searchTerm) {
                    container.innerHTML = '<p style="color: #8b949e; padding: 20px 0; text-align: center;">Aramayla eslesen Insider alarm yok.</p>';
                    countEl.textContent = `0/${totalCount || 0}`;
                } else {
                    container.innerHTML = '<p style="color: #8b949e; padding: 20px 0; text-align: center;">Henuz Insider alarm yok. "üïµÔ∏è Insider Hesapla" butonuna basin.</p>';
                    countEl.textContent = '0';
                }
                return;
            }

            countEl.textContent = totalCount ? `${alarms.length}/${totalCount}` : alarms.length;
            container.innerHTML = alarms.map((alarm, idx) => {
                const alarmKey = `${alarm.home}_${alarm.away}_${alarm.market}_${alarm.selection}`;
                const isExpanded = expandedInsiderAlarms[alarmKey] || false;
                const expandIcon = isExpanded ? '‚ñº' : '‚ñ∂';
                
                const eventTime = alarm.event_time || alarm.created_at || '-';
                let formattedEventTime = '-';
                if (eventTime && eventTime !== '-') {
                    try {
                        const dt = new Date(eventTime);
                        formattedEventTime = dt.toLocaleString('tr-TR', {day:'2-digit', month:'2-digit', year:'numeric', hour:'2-digit', minute:'2-digit', second:'2-digit'});
                    } catch(e) { formattedEventTime = eventTime; }
                }
                
                const dropTimeRaw = alarm.trigger_at || alarm.drop_moment || alarm.drop_time || '';
                const dropTimeFormatted = dropTimeRaw ? (() => {
                    try {
                        const dt = new Date(dropTimeRaw);
                        return dt.toLocaleString('tr-TR', {day:'2-digit', month:'2-digit', hour:'2-digit', minute:'2-digit'});
                    } catch(e) { return dropTimeRaw; }
                })() : '-';
                
                return `
                <div class="insider-accordion-wrapper">
                    <div class="alarm-item ${isExpanded ? 'expanded' : ''}" onclick="toggleInsiderAccordion('${alarmKey}', ${idx})" style="border-left: 3px solid #a371f7; cursor: pointer;">
                        <div class="alarm-info">
                            <div class="alarm-match">
                                <span style="margin-right: 8px; color: #a371f7; font-size: 14px; font-weight: bold;">${expandIcon}</span>
                                <span style="background:#a371f7;color:#fff;padding:2px 6px;border-radius:4px;font-size:10px;margin-right:8px;">üïµÔ∏è INSIDER</span>
                                ${alarm.home} vs ${alarm.away}
                            </div>
                            <div class="alarm-meta">${alarm.market} | ${alarm.selection} | ${alarm.created_at || ''}</div>
                            <div class="alarm-breakdown" style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 4px; font-size: 11px;">
                                <span style="color: #a371f7;" title="Acilis‚ÜíSimdi">üìâ ${(alarm.opening_odds || alarm.open_odds || 0).toFixed(2)}‚Üí${(alarm.current_odds || 0).toFixed(2)} (%${(alarm.oran_dusus_pct || alarm.odds_change_percent || 0).toFixed(1)})</span>
                                <span style="color: #ef4444;" title="Dusus Ani">‚ö° Dusus Ani: ${dropTimeFormatted}</span>
                                <span style="color: #f0883e;" title="Ortalama Hacim Soku">üìä Ort.HacimSok: ${(alarm.hacim_sok || alarm.avg_volume_shock || 0).toFixed(3)}x</span>
                                <span style="color: #3fb950;" title="Kontrol Edilen Snapshot">üì∏ ${alarm.snapshot_count || alarm.surrounding_count || 7} snapshot</span>
                            </div>
                        </div>
                        <div class="alarm-score" style="background: linear-gradient(135deg, #a371f7, #8b5cf6);">üïµÔ∏è</div>
                    </div>
                    <div class="insider-detail-panel" id="insider_detail_${idx}" style="display: ${isExpanded ? 'block' : 'none'};">
                        <div class="insider-detail-grid">
                            <div class="insider-detail-section">
                                <div class="insider-detail-title">üìâ A√áILI≈û ‚Üí ≈ûƒ∞MDƒ∞ ORAN DEƒûƒ∞≈ûƒ∞Mƒ∞</div>
                                <div class="insider-detail-row">
                                    <span class="insider-detail-label">A√ßƒ±lƒ±≈ü Oranƒ±:</span>
                                    <span class="insider-detail-value" style="color: #94a3b8; font-size: 15px; font-weight: 600;">${(alarm.opening_odds || 0).toFixed(2)}</span>
                                </div>
                                <div class="insider-detail-row">
                                    <span class="insider-detail-label">Son Oran:</span>
                                    <span class="insider-detail-value" style="color: #22c55e; font-weight: 700; font-size: 15px;">${(alarm.current_odds || 0).toFixed(2)}</span>
                                </div>
                                <div class="insider-detail-row">
                                    <span class="insider-detail-label">Toplam D√º≈ü√º≈ü:</span>
                                    <span class="insider-detail-value" style="color: #ef4444; font-weight: 700; font-size: 15px;">%${(alarm.oran_dusus_pct || 0).toFixed(2)}</span>
                                </div>
                                <div class="insider-detail-row" style="border-top: 1px solid #30363d; margin-top: 10px; padding-top: 10px; background: rgba(163,113,247,0.08); padding: 10px; border-radius: 6px; margin-left: -8px; margin-right: -8px;">
                                    <span class="insider-detail-label" style="font-weight: 600;">üìå Se√ßenek:</span>
                                    <span class="insider-detail-value" style="color: #a371f7; font-weight: 700; font-size: 15px;">${alarm.market} ‚Üí ${alarm.selection}</span>
                                </div>
                            </div>
                            <div class="insider-detail-section">
                                <div class="insider-detail-title">‚ö° D√ú≈û√ú≈û ANI Bƒ∞LGƒ∞Sƒ∞</div>
                                <div class="insider-detail-row">
                                    <span class="insider-detail-label">D√º≈ü√º≈ü Anƒ±:</span>
                                    <span class="insider-detail-value" style="color: #ef4444; font-weight: 700;">${dropTimeFormatted}</span>
                                </div>
                                <div class="insider-detail-row">
                                    <span class="insider-detail-label">Kontrol Penceresi:</span>
                                    <span class="insider-detail-value" style="color: #58a6ff;">${alarm.snapshot_count || 7} snapshot (d√º≈ü√º≈ü anƒ± etrafƒ±)</span>
                                </div>
                                <div class="insider-detail-row">
                                    <span class="insider-detail-label">Ort. Hacim ≈ûok:</span>
                                    <span class="insider-detail-value" style="color: #f59e0b; font-weight: 700;">${(alarm.hacim_sok || 0).toFixed(4)}x</span>
                                </div>
                                <div class="insider-detail-row">
                                    <span class="insider-detail-label">Ma√ß Saati:</span>
                                    <span class="insider-detail-value" style="color: #3fb950;">${formatMatchDateTR(alarm.match_date)}</span>
                                </div>
                            </div>
                            <div class="insider-detail-section">
                                <div class="insider-detail-title">üì∏ D√ú≈û√ú≈û ANI ETRAFINDAKƒ∞ SNAPSHOTLAR</div>
                                ${((alarm.surrounding_snapshots || alarm.snapshot_details) && (alarm.surrounding_snapshots || alarm.snapshot_details).length > 0) ? 
                                    (alarm.surrounding_snapshots || alarm.snapshot_details).map((snap, i, arr) => {
                                        let snapTime = '-';
                                        const timeField = snap.time || snap.scraped_at;
                                        if (timeField) {
                                            try {
                                                const dt = new Date(timeField);
                                                snapTime = dt.toLocaleTimeString('tr-TR', {hour:'2-digit', minute:'2-digit'});
                                            } catch(e) { snapTime = timeField; }
                                        }
                                        const isDropMoment = snap.is_trigger === true || (i === Math.floor(arr.length / 2));
                                        const labelStyle = isDropMoment ? 'color:#ef4444;font-weight:700;' : '';
                                        const valueStyle = isDropMoment ? 'color:#ef4444;font-weight:700;' : 'color:#a371f7;font-weight:600;';
                                        const marker = isDropMoment ? ' ‚Üê D√ú≈û√ú≈û' : '';
                                        // Gelen para hesapla (backend 'amount' veya 'incoming' kullanƒ±yor)
                                        let gelenPara = snap.incoming || 0;
                                        const snapAmt = snap.amount !== undefined ? snap.amount : snap.amt;
                                        const prevAmt = i > 0 ? (arr[i-1].amount !== undefined ? arr[i-1].amount : arr[i-1].amt) : undefined;
                                        if (!gelenPara && i > 0 && snapAmt !== undefined && prevAmt !== undefined) {
                                            gelenPara = (snapAmt || 0) - (prevAmt || 0);
                                        }
                                        const amtDisplay = snapAmt !== undefined ? '¬£' + Math.round(snapAmt) : '';
                                        const gelenDisplay = gelenPara > 0 ? ' (+¬£' + Math.round(gelenPara) + ')' : '';
                                        // A√ßƒ±lƒ±≈ü oranƒ±na g√∂re d√º≈ü√º≈ü y√ºzdesi hesapla
                                        const openingOdds = alarm.opening_odds || (arr[0] && arr[0].odds) || snap.odds;
                                        const currentOdds = snap.odds || 0;
                                        let dropPctDisplay = '';
                                        if (openingOdds > 0 && i > 0) {
                                            const dropPct = ((openingOdds - currentOdds) / openingOdds) * 100;
                                            if (dropPct > 0) {
                                                dropPctDisplay = ' <span style="color:#ef4444;font-size:10px;font-weight:600;">(-' + dropPct.toFixed(1) + '%)</span>';
                                            } else if (dropPct < 0) {
                                                dropPctDisplay = ' <span style="color:#22c55e;font-size:10px;font-weight:600;">(+' + Math.abs(dropPct).toFixed(1) + '%)</span>';
                                            }
                                        }
                                        return '<div class="insider-detail-row"><span class="insider-detail-label" style="' + labelStyle + '">Snap ' + (i+1) + ':</span><span class="insider-detail-value"><span style="' + valueStyle + '">' + (snap.odds || 0).toFixed(2) + '</span>' + dropPctDisplay + ' <span style="color:#22c55e;font-size:11px;">' + amtDisplay + gelenDisplay + '</span> <span style="color:#64748b;font-size:11px;">(' + snapTime + ')' + marker + '</span></span></div>';
                                    }).join('') 
                                    : '<div class="insider-detail-row"><span class="insider-detail-label">Detay:</span><span class="insider-detail-value" style="color:#64748b;">Yeniden hesaplayƒ±n</span></div>'
                                }
                                <div class="insider-detail-row" style="border-top: 1px solid #30363d; margin-top: 8px; padding-top: 8px;">
                                    <span class="insider-detail-label">Hesaplama:</span>
                                    <span class="insider-detail-value" style="font-size: 11px; color: #64748b;">${alarm.created_at || '-'}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            }).join('');

            window.currentInsiderAlarms = alarms;
        }
        
        function toggleInsiderAccordion(alarmKey, idx) {
            expandedInsiderAlarms[alarmKey] = !expandedInsiderAlarms[alarmKey];
            const detailPanel = document.getElementById('insider_detail_' + idx);
            const alarmItem = detailPanel?.previousElementSibling;
            
            if (expandedInsiderAlarms[alarmKey]) {
                detailPanel.style.display = 'block';
                if (alarmItem) alarmItem.classList.add('expanded');
            } else {
                detailPanel.style.display = 'none';
                if (alarmItem) alarmItem.classList.remove('expanded');
            }
            
            const expandIcon = alarmItem?.querySelector('.alarm-match span:first-child');
            if (expandIcon) {
                expandIcon.textContent = expandedInsiderAlarms[alarmKey] ? '‚ñº' : '‚ñ∂';
            }
        }

        function filterInsiderAlarms() {
            const searchTerm = document.getElementById('insiderSearchInput').value.toLowerCase().trim();
            let filtered = filterAlarmsByDateMode(allInsiderAlarms, 'insider');
            
            if (searchTerm) {
                filtered = filtered.filter(alarm => 
                    (alarm.home || '').toLowerCase().includes(searchTerm) ||
                    (alarm.away || '').toLowerCase().includes(searchTerm)
                );
            }
            
            updateTotalCount('insiderAlarmTotalCount', allInsiderAlarms.length);
            renderInsiderAlarms(filtered, allInsiderAlarms.length);
        }

        async function saveInsiderConfig() {
            const config = {
                hacim_sok_esigi: parseFloat(document.getElementById('insider_hacim_sok_esigi').value) || 2,
                oran_dusus_esigi: parseFloat(document.getElementById('insider_oran_dusus_esigi').value) || 3,
                sure_dakika: parseInt(document.getElementById('insider_sure_dakika').value) || 30,
                max_para: parseFloat(document.getElementById('insider_max_para').value) || 5000,
                max_odds_esigi: parseFloat(document.getElementById('insider_max_odds_esigi').value) || 10.0,
                min_volume_1x2: 3000,
                min_volume_ou25: 1000,
                min_volume_btts: 1000
            };
            
            try {
                const response = await fetch('/api/alarm-settings/insider', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ enabled: true, config: config })
                });
                if (response.ok) {
                    showToast('Insider ayarlari kaydedildi!', 'success');
                } else {
                    showToast('Kayit hatasi!', 'error');
                }
            } catch (error) {
                showToast('Baglanti hatasi!', 'error');
            }
        }

        async function deleteAllInsiderAlarms() {
            if (!confirm('Tum Insider alarmlari silinecek. Emin misiniz?')) return;
            
            try {
                const response = await fetch('/api/insider/delete', { method: 'POST' });
                if (response.ok) {
                    showToast('Tum Insider alarmlar silindi!', 'success');
                    loadInsiderAlarms();
                } else {
                    showToast('Silme hatasi!', 'error');
                }
            } catch (error) {
                showToast('Baglanti hatasi!', 'error');
            }
        }

        function showInsiderAlarmDetail(idx) {
            const alarm = window.currentInsiderAlarms[idx];
            if (!alarm) return;

            const modal = document.getElementById('alarmDetailModal');
            const body = document.getElementById('alarmDetailBody');

            body.innerHTML = `
                <div class="detail-section">
                    <h4 style="color: #a371f7;">üïµÔ∏è Insider Info Alarm Detaylari</h4>
                    <div class="detail-row"><span class="detail-label">Mac</span><span class="detail-value">${alarm.home} vs ${alarm.away}</span></div>
                    <div class="detail-row"><span class="detail-label">Market</span><span class="detail-value">${alarm.market}</span></div>
                    <div class="detail-row"><span class="detail-label">Secenek</span><span class="detail-value">${alarm.selection}</span></div>
                    <div class="detail-row"><span class="detail-label">Mac Tarihi</span><span class="detail-value" style="color: #58a6ff;">${formatMatchDateTR(alarm.match_date)}</span></div>
                    <div class="detail-row"><span class="detail-label">Hesaplama Tarihi</span><span class="detail-value">${alarm.created_at || '-'}</span></div>
                </div>
                <div class="detail-section">
                    <h4>üìä Oran Bilgileri</h4>
                    <div class="detail-row"><span class="detail-label">Opening Odds (Acilis)</span><span class="detail-value">${alarm.opening_odds || '-'}</span></div>
                    <div class="detail-row"><span class="detail-label">Son Oran</span><span class="detail-value">${alarm.current_odds || '-'}</span></div>
                    <div class="detail-row"><span class="detail-label">Oran Dususu (maks)</span><span class="detail-value highlight" style="color: #a371f7;">${(alarm.oran_dusus_pct || 0).toFixed(2)}%</span></div>
                </div>
                <div class="detail-section">
                    <h4>‚ö° Hacim Soku & Para</h4>
                    <div class="detail-row"><span class="detail-label">Ortalama Hacim Soku</span><span class="detail-value">${(alarm.hacim_sok || 0).toFixed(2)}x</span></div>
                    <div class="detail-row"><span class="detail-label">Hacim Sok Esigi</span><span class="detail-value">&lt; ${alarm.insider_hacim_sok_esigi ?? 'N/A'}x</span></div>
                    <div class="detail-row"><span class="detail-label">Ortalama Gelen Para</span><span class="detail-value">¬£${Math.round(alarm.gelen_para || 0).toLocaleString('en-GB')}</span></div>
                    <div class="detail-row"><span class="detail-label">Max Para Esigi</span><span class="detail-value">&lt; ¬£${alarm.insider_max_para ?? 'N/A'}</span></div>
                    <div class="detail-row"><span class="detail-label">Son Oran</span><span class="detail-value" style="color: #f0b429;">${(alarm.current_odds || 0).toFixed(2)}</span></div>
                    <div class="detail-row"><span class="detail-label">Max Oran Esigi</span><span class="detail-value">‚â§ ${alarm.insider_max_odds_esigi ?? 'N/A'}</span></div>
                </div>
                <div class="detail-section">
                    <h4>‚è±Ô∏è Sure & Snapshot</h4>
                    <div class="detail-row"><span class="detail-label">Gerekli Sure</span><span class="detail-value">${alarm.insider_sure_dakika ?? 'N/A'} dakika</span></div>
                    <div class="detail-row"><span class="detail-label">Ardisik Snapshot</span><span class="detail-value">${alarm.snapshot_count ?? 'N/A'} snapshot</span></div>
                </div>
                <div class="detail-section">
                    <h4 style="color: #a371f7;">üïµÔ∏è Insider Sinyali</h4>
                    <p style="font-size: 12px; color: #8b949e; line-height: 1.6;">
                        Bu macta ${alarm.insider_sure_dakika ?? 'N/A'} dakika boyunca (${alarm.snapshot_count ?? 'N/A'} ardisik snapshot):
                        <br>‚Ä¢ Hacim Soku ${(alarm.hacim_sok || 0).toFixed(2)}x < ${alarm.insider_hacim_sok_esigi ?? 'N/A'}x (dusuk)
                        <br>‚Ä¢ Oran Dususu ${(alarm.oran_dusus_pct || 0).toFixed(1)}% >= ${alarm.insider_oran_dusus_esigi ?? 'N/A'}% (yuksek)
                        <br>‚Ä¢ Gelen Para ¬£${Math.round(alarm.gelen_para || 0).toLocaleString('en-GB')} < ¬£${alarm.insider_max_para ?? 'N/A'} (dusuk)
                        <br><br>
                        <strong style="color: #a371f7;">Sonuc:</strong> Buyuk para girisi olmadan oranlar dusuyor = birileri bir seyler biliyor olabilir!
                    </p>
                </div>
            `;
            modal.style.display = 'flex';
        }

        // ==================== BIG MONEY FUNCTIONS ====================
        let allBigMoneyAlarms = [];

        async function loadBigMoneyPage() {
            await loadBigMoneyConfig();
            await loadBigMoneyAlarms();
        }

        async function loadDroppingPage() {
            await loadDroppingConfig();
            await loadDroppingAlarms();
        }

        async function loadBigMoneyConfig() {
            try {
                const response = await fetch('/api/bigmoney/config');
                if (response.ok) {
                    const config = await response.json();
                    document.getElementById('bigMoneyLimit').value = config.big_money_limit ?? '';
                }
            } catch (error) {
                console.error('Big Money config yukleme hatasi:', error);
            }
        }

        async function loadBigMoneyAlarms() {
            try {
                const response = await fetch('/api/bigmoney/alarms');
                if (response.ok) {
                    const alarms = await response.json();
                    // Yeniden eskiye sirala
                    allBigMoneyAlarms = sortAlarmsNewestFirst(alarms);
                    updateTotalCount('bigMoneyAlarmTotalCount', allBigMoneyAlarms.length);
                    renderBigMoneyAlarms(allBigMoneyAlarms);
                }
            } catch (error) {
                console.error('Big Money alarm yukleme hatasi:', error);
            }
        }

        function renderBigMoneyAlarms(alarms, totalCount = null) {
            const container = document.getElementById('bigMoneyAlarmList');
            const countEl = document.getElementById('bigMoneyAlarmCount');
            
            if (!alarms || alarms.length === 0) {
                const searchTerm = document.getElementById('bigMoneySearchInput')?.value || '';
                if (searchTerm) {
                    container.innerHTML = '<p style="color: #8b949e; padding: 20px 0; text-align: center;">Aramayla eslesen Big Money alarm yok.</p>';
                    countEl.textContent = `0/${totalCount || 0}`;
                } else {
                    container.innerHTML = '<p style="color: #8b949e; padding: 20px 0; text-align: center;">Henuz Big Money alarm yok. "üí∞ Big Money Hesapla" butonuna basin.</p>';
                    countEl.textContent = '0';
                }
                return;
            }

            countEl.textContent = totalCount ? `${alarms.length}/${totalCount}` : alarms.length;
            container.innerHTML = alarms.map((alarm, idx) => {
                const isHuge = alarm.is_huge;
                const bgColor = isHuge ? '#ff7b00' : '#FF4500';
                const icon = isHuge ? 'üî•' : 'üí∞';
                const label = isHuge ? 'HUGE MONEY' : 'BIG MONEY';
                const zebraStyle = idx % 2 === 0 ? 'background: #161b22;' : 'background: #1c2128;';
                
                return `
                <div class="bigmoney-alarm-wrapper" id="bigmoney-alarm-${idx}">
                    <div class="alarm-item" onclick="toggleBigMoneyDetail(${idx})" style="border-left: 3px solid ${bgColor}; cursor: pointer; ${zebraStyle}">
                        <div class="alarm-info">
                            <div class="alarm-match">
                                <span style="margin-right: 8px; color: ${bgColor}; font-size: 14px; font-weight: bold;" id="bigmoney-toggle-icon-${idx}">‚ñ∂</span>
                                <span style="background:${bgColor};color:#fff;padding:2px 6px;border-radius:4px;font-size:10px;margin-right:8px;">${icon} ${label}</span>
                                ${alarm.home} vs ${alarm.away}
                            </div>
                            <div class="alarm-meta">${alarm.market} | ${alarm.selection} | ${alarm.created_at || ''}</div>
                            <div class="alarm-breakdown" style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 6px; font-size: 11px;">
                                <span style="color: ${bgColor};" title="Gelen Para">üí∞ Gelen: ¬£${Math.round(alarm.incoming_money || 0).toLocaleString('en-GB')}</span>
                                ${isHuge ? `<span style="color: #ff7b00;" title="Toplam">üî• Toplam: ¬£${Math.round(alarm.huge_total || 0).toLocaleString('en-GB')}</span>` : ''}
                                <span style="color: #58a6ff;" title="Limit">üìä Limit: ¬£${Math.round(alarm.big_money_limit || 15000).toLocaleString('en-GB')}</span>
                                <span style="color: #3fb950;" title="Snapshot Sayisi">üì∏ ${alarm.snapshot_count || 1} kez</span>
                            </div>
                        </div>
                        <div class="alarm-score" style="background: linear-gradient(135deg, ${bgColor}, ${isHuge ? '#ff5500' : '#CC3700'});">${icon}</div>
                    </div>
                    <div id="bigmoney-detail-${idx}" class="bigmoney-alarm-detail" style="display: none; background: #0d1117; border: 1px solid #30363d; border-top: none; border-left: 3px solid ${bgColor}; border-radius: 0 0 8px 8px; padding: 15px; margin-top: -5px;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <div class="bigmoney-detail-section">
                                <div style="color: ${bgColor}; font-weight: 600; margin-bottom: 8px; font-size: 12px;">${icon} ${label} DETAYI</div>
                                <div class="detail-row-inline"><span style="color: #8b949e;">Gelen Para:</span> <span style="color: ${bgColor}; font-weight: 700; font-size: 16px;">¬£${Math.round(alarm.incoming_money || 0).toLocaleString('en-GB')}</span></div>
                                <div class="detail-row-inline"><span style="color: #8b949e;">Alarm Limiti:</span> <span style="color: #f0f6fc;">¬£${Math.round(alarm.big_money_limit || 15000).toLocaleString('en-GB')}</span></div>
                                ${isHuge ? `<div class="detail-row-inline"><span style="color: #8b949e;">2 Snapshot Toplami:</span> <span style="color: #ff7b00; font-weight: 700;">¬£${Math.round(alarm.huge_total || 0).toLocaleString('en-GB')}</span></div>` : ''}
                                <div class="detail-row-inline"><span style="color: #8b949e;">Limit Asan Snapshot:</span> <span style="color: #3fb950;">${alarm.snapshot_count || 1} kez</span></div>
                            </div>
                            <div class="bigmoney-detail-section">
                                <div style="color: #58a6ff; font-weight: 600; margin-bottom: 8px; font-size: 12px;">üìä MAC BILGILERI</div>
                                <div class="detail-row-inline"><span style="color: #8b949e;">Ev Sahibi:</span> <span style="color: #f0f6fc;">${alarm.home}</span></div>
                                <div class="detail-row-inline"><span style="color: #8b949e;">Deplasman:</span> <span style="color: #f0f6fc;">${alarm.away}</span></div>
                                <div class="detail-row-inline"><span style="color: #8b949e;">Market:</span> <span style="color: #f0f6fc;">${alarm.market}</span></div>
                                <div class="detail-row-inline"><span style="color: #8b949e;">Secenek:</span> <span style="color: #a371f7; font-weight: 600;">${alarm.selection}</span></div>
                            </div>
                            <div class="bigmoney-detail-section">
                                <div style="color: #f0883e; font-weight: 600; margin-bottom: 8px; font-size: 12px;">üìÖ ZAMAN BILGILERI</div>
                                <div class="detail-row-inline"><span style="color: #8b949e;">Mac Tarihi:</span> <span style="color: #58a6ff;">${formatMatchDateTR(alarm.match_date)}</span></div>
                                <div class="detail-row-inline"><span style="color: #8b949e;">Hesaplama:</span> <span style="color: #f0f6fc;">${alarm.created_at || '-'}</span></div>
                            </div>
                        </div>
                        <div style="margin-top: 12px; padding: 10px; background: rgba(${isHuge ? '255,123,0' : '255,69,0'}, 0.15); border-radius: 6px; border-left: 3px solid ${bgColor};">
                            <span style="color: ${bgColor}; font-weight: 600;">${icon} ${label} Sinyali:</span>
                            <span style="color: #c9d1d9; font-size: 12px; margin-left: 8px;">
                                ${isHuge ? 
                                    `2 ardisik snapshot'ta ${alarm.selection} secenegine ¬£${(alarm.big_money_limit || 15000).toLocaleString('en-GB')}+ para girisi! Syndicates veya profesyonel bahisciler seri sekilde pozisyon aliyor olabilir!` 
                                    : 
                                    `Tek snapshot'ta ${alarm.selection} secenegine ¬£${Math.round(alarm.incoming_money || 0).toLocaleString('en-GB')} para girisi! Buyuk oyuncular pozisyon aliyor olabilir!`
                                }
                            </span>
                        </div>
                    </div>
                </div>
            `}).join('');

            window.currentBigMoneyAlarms = alarms;
        }
        
        function toggleBigMoneyDetail(idx) {
            const detailEl = document.getElementById(`bigmoney-detail-${idx}`);
            const toggleIcon = document.getElementById(`bigmoney-toggle-icon-${idx}`);
            
            if (detailEl.style.display === 'none') {
                detailEl.style.display = 'block';
                if (toggleIcon) toggleIcon.textContent = '‚ñº';
            } else {
                detailEl.style.display = 'none';
                if (toggleIcon) toggleIcon.textContent = '‚ñ∂';
            }
        }

        function filterBigMoneyAlarms() {
            const searchTerm = document.getElementById('bigMoneySearchInput').value.toLowerCase().trim();
            let filtered = filterAlarmsByDateMode(allBigMoneyAlarms, 'bigMoney');
            
            if (searchTerm) {
                filtered = filtered.filter(alarm => 
                    (alarm.home || '').toLowerCase().includes(searchTerm) ||
                    (alarm.away || '').toLowerCase().includes(searchTerm)
                );
            }
            
            updateTotalCount('bigMoneyAlarmTotalCount', allBigMoneyAlarms.length);
            renderBigMoneyAlarms(filtered, allBigMoneyAlarms.length);
        }

        async function saveBigMoneyConfig() {
            const config = {
                big_money_limit: parseFloat(document.getElementById('bigMoneyLimit').value) || 15000
            };
            
            try {
                const response = await fetch('/api/bigmoney/config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });
                if (response.ok) {
                    showToast('Big Money ayarlari kaydedildi!', 'success');
                } else {
                    showToast('Kayit hatasi!', 'error');
                }
            } catch (error) {
                showToast('Baglanti hatasi!', 'error');
            }
        }

        async function deleteBigMoneyAlarms() {
            if (!confirm('Tum Big Money alarmlari silinecek. Emin misiniz?')) return;
            
            try {
                const response = await fetch('/api/bigmoney/delete', { method: 'POST' });
                if (response.ok) {
                    showToast('Tum Big Money alarmlar silindi!', 'success');
                    loadBigMoneyAlarms();
                } else {
                    showToast('Silme hatasi!', 'error');
                }
            } catch (error) {
                showToast('Baglanti hatasi!', 'error');
            }
        }

        // =====================================================
        // VOLUME SHOCK (HACIM SOKU) FUNCTIONS
        // =====================================================
        
        let allVolumeShockAlarms = [];
        
        async function loadVolumeShockPage() {
            await loadVolumeShockConfig();
            await loadVolumeShockAlarms();
        }
        
        async function loadVolumeShockConfig() {
            try {
                const response = await fetch('/api/volumeshock/config');
                const config = await response.json();
                document.getElementById('volumeShockMinSaat').value = config.hacim_soku_min_saat ?? '';
                document.getElementById('volumeShockMinEsik').value = config.hacim_soku_min_esik ?? '';
                document.getElementById('vsMinVolume1x2').value = config.min_volume_1x2 ?? '';
                document.getElementById('vsMinVolumeOu25').value = config.min_volume_ou25 ?? '';
                document.getElementById('vsMinVolumeBtts').value = config.min_volume_btts ?? '';
                document.getElementById('vsMinSnapshotPara').value = config.min_son_snapshot_para ?? '';
            } catch (error) {
                console.error('Volume Shock config load error:', error);
            }
        }
        
        async function loadVolumeShockAlarms() {
            try {
                const response = await fetch('/api/volumeshock/alarms');
                const alarms = await response.json();
                // Yeniden eskiye sirala
                allVolumeShockAlarms = sortAlarmsNewestFirst(alarms);
                updateTotalCount('volumeShockAlarmTotalCount', allVolumeShockAlarms.length);
                renderVolumeShockAlarms(allVolumeShockAlarms);
            } catch (error) {
                console.error('Volume Shock alarms load error:', error);
            }
        }
        
        function renderVolumeShockAlarms(alarms, totalCount = null) {
            const container = document.getElementById('volumeShockAlarmList');
            const countBadge = document.getElementById('volumeShockAlarmCount');
            
            countBadge.textContent = totalCount !== null ? `${alarms.length}/${totalCount}` : alarms.length;
            
            if (!alarms || alarms.length === 0) {
                container.innerHTML = '<p style="color: #8b949e; padding: 20px 0; text-align: center;">Henuz Hacim Soku alarm yok.</p>';
                return;
            }
            
            container.innerHTML = alarms.map((alarm, idx) => {
                const incomingMoney = alarm.incoming_money || 0;
                const avgPrevious = alarm.avg_previous || 0;
                let shockValue = alarm.volume_shock_value || alarm.volume_shock || alarm.volume_shock_multiplier;
                if (!shockValue || shockValue === 0) {
                    shockValue = avgPrevious > 0 ? (incomingMoney / avgPrevious) : null;
                }
                const shockDisplay = shockValue !== null ? shockValue.toFixed(1) + 'x' : 'N/A';
                const shockDetailDisplay = shockValue !== null ? shockValue.toFixed(3) + 'x' : 'N/A';
                
                const matchDate = alarm.match_date || '-';
                const calculatedHours = calculateHoursToKickoff(matchDate);
                const hoursToKickoff = calculatedHours !== null ? calculatedHours : (alarm.hours_to_kickoff || 0);
                const eventTime = alarm.event_time || '-';
                const createdAt = alarm.created_at || '-';
                const minSaat = alarm.hacim_soku_min_saat || 5;
                const minEsik = alarm.hacim_soku_min_esik || 4;
                
                return `
                <div class="vs-alarm-wrapper" id="vs-alarm-${idx}">
                    <div class="alarm-item" onclick="toggleVolumeShockDetail(${idx})" style="border-left: 3px solid #ff6b6b; cursor: pointer;">
                        <div class="alarm-info">
                            <div class="alarm-match">
                                <span style="background:#ff6b6b;color:#fff;padding:2px 6px;border-radius:4px;font-size:10px;margin-right:8px;">‚ö° HACIM SOKU</span>
                                ${alarm.home} vs ${alarm.away}
                                <span id="vs-toggle-icon-${idx}" style="margin-left: 8px; color: #8b949e; font-size: 12px;">‚ñº</span>
                            </div>
                            <div class="alarm-meta">${alarm.market} | ${alarm.selection} | ${createdAt}</div>
                            <div class="alarm-breakdown" style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 6px; font-size: 11px;">
                                <span style="color: #ff6b6b;" title="Sok Degeri">‚ö° Sok: ${shockDisplay}</span>
                                <span style="color: #58a6ff;" title="Mactan Once">‚è∞ Mactan ${hoursToKickoff.toFixed(1)}s once</span>
                                <span style="color: #3fb950;" title="Gelen Para">üí∞ ¬£${Math.round(incomingMoney).toLocaleString('en-GB')}</span>
                            </div>
                        </div>
                        <div class="alarm-score" style="background: linear-gradient(135deg, #ff6b6b, #ff4757);">${shockDisplay}</div>
                    </div>
                    <div id="vs-detail-${idx}" class="vs-alarm-detail" style="display: none; background: #161b22; border: 1px solid #30363d; border-top: none; border-radius: 0 0 8px 8px; padding: 15px; margin-top: -5px;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <div class="vs-detail-section">
                                <div style="color: #58a6ff; font-weight: 600; margin-bottom: 8px; font-size: 12px;">üìÖ ZAMAN BILGILERI</div>
                                <div class="vs-detail-row"><span style="color: #8b949e;">Mac Saati:</span> <span style="color: #3fb950;">${formatMatchDateTR(matchDate)}</span></div>
                                <div class="vs-detail-row"><span style="color: #8b949e;">Olay Zamani:</span> <span style="color: #f0f6fc;">${eventTime}</span></div>
                                <div class="vs-detail-row"><span style="color: #8b949e;">Hesaplama:</span> <span style="color: #f0f6fc;">${createdAt}</span></div>
                                <div class="vs-detail-row"><span style="color: #8b949e;">Mactan Once:</span> <span style="color: #58a6ff; font-weight: 600;">${hoursToKickoff.toFixed(2)} saat</span></div>
                            </div>
                            <div class="vs-detail-section">
                                <div style="color: #ff6b6b; font-weight: 600; margin-bottom: 8px; font-size: 12px;">‚ö° SOK METRIKLERI</div>
                                <div class="vs-detail-row"><span style="color: #8b949e;">Sok Degeri:</span> <span style="color: #ff6b6b; font-weight: 700; font-size: 16px;">${shockDetailDisplay}</span></div>
                                <div class="vs-detail-row"><span style="color: #8b949e;">Gelen Para:</span> <span style="color: #3fb950; font-weight: 600;">¬£${Math.round(incomingMoney).toLocaleString('en-GB')}</span></div>
                                <div class="vs-detail-row"><span style="color: #8b949e;">Ort. Onceki:</span> <span style="color: #f0f6fc;">¬£${Math.round(avgPrevious).toLocaleString('en-GB')}</span></div>
                            </div>
                            <div class="vs-detail-section">
                                <div style="color: #a371f7; font-weight: 600; margin-bottom: 8px; font-size: 12px;">‚öôÔ∏è KULLANILAN ESIKLER</div>
                                <div class="vs-detail-row"><span style="color: #8b949e;">Min Saat:</span> <span style="color: #f0f6fc;">${minSaat} saat</span></div>
                                <div class="vs-detail-row"><span style="color: #8b949e;">Min Sok Esigi:</span> <span style="color: #f0f6fc;">${minEsik}x</span></div>
                            </div>
                            <div class="vs-detail-section">
                                <div style="color: #f0883e; font-weight: 600; margin-bottom: 8px; font-size: 12px;">üìä MAC BILGILERI</div>
                                <div class="vs-detail-row"><span style="color: #8b949e;">Ev Sahibi:</span> <span style="color: #f0f6fc;">${alarm.home}</span></div>
                                <div class="vs-detail-row"><span style="color: #8b949e;">Deplasman:</span> <span style="color: #f0f6fc;">${alarm.away}</span></div>
                                <div class="vs-detail-row"><span style="color: #8b949e;">Market:</span> <span style="color: #f0f6fc;">${alarm.market}</span></div>
                                <div class="vs-detail-row"><span style="color: #8b949e;">Secenek:</span> <span style="color: #f0f6fc;">${alarm.selection}</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            `}).join('');
            
            window.currentVolumeShockAlarms = alarms;
        }
        
        function toggleVolumeShockDetail(idx) {
            const detailEl = document.getElementById(`vs-detail-${idx}`);
            const toggleIcon = document.getElementById(`vs-toggle-icon-${idx}`);
            
            if (detailEl.style.display === 'none') {
                detailEl.style.display = 'block';
                if (toggleIcon) toggleIcon.textContent = '‚ñ≤';
            } else {
                detailEl.style.display = 'none';
                if (toggleIcon) toggleIcon.textContent = '‚ñº';
            }
        }
        
        function filterVolumeShockAlarms() {
            const searchTerm = document.getElementById('volumeShockSearchInput').value.toLowerCase().trim();
            let filtered = filterAlarmsByDateMode(allVolumeShockAlarms, 'volumeShock');
            
            if (searchTerm) {
                filtered = filtered.filter(alarm => 
                    (alarm.home || '').toLowerCase().includes(searchTerm) ||
                    (alarm.away || '').toLowerCase().includes(searchTerm)
                );
            }
            
            updateTotalCount('volumeShockAlarmTotalCount', allVolumeShockAlarms.length);
            renderVolumeShockAlarms(filtered, allVolumeShockAlarms.length);
        }
        
        async function saveVolumeShockConfig() {
            const config = {
                hacim_soku_min_saat: parseFloat(document.getElementById('volumeShockMinSaat').value) || 5,
                hacim_soku_min_esik: parseFloat(document.getElementById('volumeShockMinEsik').value) || 4,
                min_volume_1x2: parseInt(document.getElementById('vsMinVolume1x2').value) || 1000,
                min_volume_ou25: parseInt(document.getElementById('vsMinVolumeOu25').value) || 500,
                min_volume_btts: parseInt(document.getElementById('vsMinVolumeBtts').value) || 300,
                min_son_snapshot_para: parseInt(document.getElementById('vsMinSnapshotPara').value) || 300
            };
            
            try {
                const response = await fetch('/api/volumeshock/config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });
                if (response.ok) {
                    showToast('Hacim Soku ayarlari kaydedildi!', 'success');
                } else {
                    showToast('Kayit hatasi!', 'error');
                }
            } catch (error) {
                showToast('Baglanti hatasi!', 'error');
            }
        }
        
        async function deleteVolumeShockAlarms() {
            if (!confirm('Tum Hacim Soku alarmlari silinecek. Emin misiniz?')) return;
            
            try {
                const response = await fetch('/api/volumeshock/delete', { method: 'POST' });
                if (response.ok) {
                    showToast('Tum Hacim Soku alarmlar silindi!', 'success');
                    loadVolumeShockAlarms();
                } else {
                    showToast('Silme hatasi!', 'error');
                }
            } catch (error) {
                showToast('Baglanti hatasi!', 'error');
            }
        }
        
        function showVolumeShockCalcStatus() {
            const statusEl = document.getElementById('volumeShockCalcStatus');
            if (statusEl) statusEl.style.display = 'block';
        }
        
        function hideVolumeShockCalcStatus() {
            const statusEl = document.getElementById('volumeShockCalcStatus');
            if (statusEl) statusEl.style.display = 'none';
        }
        
        async function resetVolumeShockCalculation() {
            try {
                const response = await fetch('/api/volumeshock/reset', { method: 'POST' });
                const data = await response.json();
                if (data.success) {
                    hideVolumeShockCalcStatus();
                    showToast('Hacim Soku hesaplama sifirlandi!', 'success');
                }
            } catch (error) {
                showToast('Sifirlama hatasi!', 'error');
            }
        }
        
        async function calculateVolumeShock() {
            showVolumeShockCalcStatus();
            document.getElementById('volumeShockCalcProgress').textContent = 'Hacim Soku hesaplaniyor...';
            
            try {
                const response = await fetch('/api/volumeshock/calculate', { method: 'POST' });
                const data = await response.json();
                
                if (data.success) {
                    // Poll for completion
                    let checkCount = 0;
                    const maxChecks = 60;
                    const checkInterval = setInterval(async () => {
                        checkCount++;
                        try {
                            const statusRes = await fetch('/api/volumeshock/status');
                            const status = await statusRes.json();
                            
                            document.getElementById('volumeShockCalcProgress').textContent = status.progress || 'Hesaplaniyor...';
                            
                            if (!status.calculating || checkCount >= maxChecks) {
                                clearInterval(checkInterval);
                                hideVolumeShockCalcStatus();
                                showToast(`Hacim Soku hesaplandi! ${status.alarm_count || 0} alarm bulundu.`, 'success');
                                loadVolumeShockAlarms();
                            }
                        } catch (e) {
                            clearInterval(checkInterval);
                            hideVolumeShockCalcStatus();
                        }
                    }, 2000);
                } else {
                    hideVolumeShockCalcStatus();
                    showToast('Hesaplama hatasi: ' + (data.error || 'Bilinmeyen hata'), 'error');
                }
            } catch (error) {
                hideVolumeShockCalcStatus();
                showToast('Baglanti hatasi!', 'error');
            }
        }
        
        function showVolumeShockAlarmDetail(idx) {
            const alarm = window.currentVolumeShockAlarms[idx];
            if (!alarm) return;

            const modal = document.getElementById('alarmDetailModal');
            const body = document.getElementById('alarmDetailBody');

            body.innerHTML = `
                <div class="detail-section">
                    <h4>‚ö° Hacim Soku Alarm Detayi</h4>
                    <div class="detail-row"><span class="detail-label">Mac</span><span class="detail-value">${alarm.home} vs ${alarm.away}</span></div>
                    <div class="detail-row"><span class="detail-label">Market</span><span class="detail-value">${alarm.market}</span></div>
                    <div class="detail-row"><span class="detail-label">Secenek</span><span class="detail-value">${alarm.selection}</span></div>
                    <div class="detail-row"><span class="detail-label">Mac Tarihi</span><span class="detail-value" style="color: #58a6ff;">${formatMatchDateTR(alarm.match_date)}</span></div>
                    <div class="detail-row"><span class="detail-label">Hesaplama Tarihi</span><span class="detail-value">${alarm.created_at || '-'}</span></div>
                </div>
                <div class="detail-section">
                    <h4 style="color: #ff6b6b;">‚ö° Hacim Soku Metrikleri</h4>
                    <div class="detail-row"><span class="detail-label">Sok Degeri</span><span class="detail-value highlight" style="color: #ff6b6b;">${(alarm.volume_shock_value || alarm.volume_shock || alarm.volume_shock_multiplier || 0).toFixed(2)}x</span></div>
                    <div class="detail-row"><span class="detail-label">Mactan Once</span><span class="detail-value" style="color: #58a6ff;">${(calculateHoursToKickoff(alarm) || 0).toFixed(1)} saat</span></div>
                    <div class="detail-row"><span class="detail-label">Gelen Para</span><span class="detail-value" style="color: #3fb950;">¬£${Math.round(alarm.incoming_money || 0).toLocaleString('en-GB')}</span></div>
                </div>
                <div class="detail-section">
                    <h4>‚öôÔ∏è Kullanilan Esikler</h4>
                    <div class="detail-row"><span class="detail-label">Min Saat Esigi</span><span class="detail-value">${alarm.hacim_soku_min_saat || 5} saat</span></div>
                    <div class="detail-row"><span class="detail-label">Min Sok Esigi</span><span class="detail-value">${alarm.hacim_soku_min_esik || 4}x</span></div>
                </div>
            `;
            
            modal.style.display = 'flex';
        }
        
        // =====================================================
        // END VOLUME SHOCK FUNCTIONS
        // =====================================================

        // =====================================================
        // VOLUME LEADER (HACIM LIDERI DEGISTI) FUNCTIONS
        // =====================================================
        
        let allVolumeLeaderAlarms = [];
        
        async function loadVolumeLeaderPage() {
            await loadVolumeLeaderConfig();
            await loadVolumeLeaderAlarms();
        }
        
        async function loadVolumeLeaderConfig() {
            try {
                const response = await fetch('/api/volumeleader/config');
                const config = await response.json();
                document.getElementById('vlMinVolume1x2').value = config.min_volume_1x2 ?? '';
                document.getElementById('vlMinVolumeOu25').value = config.min_volume_ou25 ?? '';
                document.getElementById('vlMinVolumeBtts').value = config.min_volume_btts ?? '';
            } catch (error) {
                console.error('Volume Leader config load error:', error);
            }
        }
        
        async function loadVolumeLeaderAlarms() {
            try {
                const response = await fetch('/api/volumeleader/alarms');
                const alarms = await response.json();
                // Yeniden eskiye sirala
                allVolumeLeaderAlarms = sortAlarmsNewestFirst(alarms);
                updateTotalCount('volumeLeaderAlarmTotalCount', allVolumeLeaderAlarms.length);
                renderVolumeLeaderAlarms(allVolumeLeaderAlarms);
            } catch (error) {
                console.error('Volume Leader alarms load error:', error);
            }
        }
        
        function renderVolumeLeaderAlarms(alarms, totalCount = null) {
            const container = document.getElementById('volumeLeaderAlarmList');
            const countBadge = document.getElementById('volumeLeaderAlarmCount');
            
            countBadge.textContent = totalCount !== null ? `${alarms.length}/${totalCount}` : alarms.length;
            
            if (!alarms || alarms.length === 0) {
                container.innerHTML = '<p style="color: #8b949e; padding: 20px 0; text-align: center;">Henuz Hacim Lideri alarm yok. "üëë Hacim Lideri Hesapla" butonuna basin.</p>';
                return;
            }
            
            container.innerHTML = alarms.map((alarm, idx) => {
                const oldLeader = alarm.old_leader || '-';
                const newLeader = alarm.new_leader || '-';
                const oldShare = alarm.old_leader_share || 0;
                const newShare = alarm.new_leader_share || 0;
                const volume = alarm.total_volume || 0;
                const createdAt = alarm.created_at || '-';
                const zebraStyle = idx % 2 === 0 ? 'background: #161b22;' : 'background: #1c2128;';
                
                return `
                <div class="vl-alarm-wrapper" id="vl-alarm-${idx}">
                    <div class="alarm-item" onclick="toggleVolumeLeaderDetail(${idx})" style="border-left: 3px solid #06b6d4; cursor: pointer; ${zebraStyle}">
                        <div class="alarm-info">
                            <div class="alarm-match">
                                <span style="margin-right: 8px; color: #06b6d4; font-size: 14px; font-weight: bold;" id="vl-toggle-icon-${idx}">‚ñ∂</span>
                                <span style="background:#06b6d4;color:#fff;padding:2px 6px;border-radius:4px;font-size:10px;margin-right:8px;">üëë LIDER DEGISTI</span>
                                ${alarm.home} vs ${alarm.away}
                            </div>
                            <div class="alarm-meta">${alarm.market} | ${createdAt}</div>
                            <div class="alarm-breakdown" style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 6px; font-size: 11px;">
                                <span style="color: #f85149;" title="Eski Lider">üî¥ ${oldLeader} (%${oldShare.toFixed(0)})</span>
                                <span style="color: #8b949e;">‚Üí</span>
                                <span style="color: #3fb950;" title="Yeni Lider">üü¢ ${newLeader} (%${newShare.toFixed(0)})</span>
                                <span style="color: #58a6ff;" title="Volume">üí∞ ¬£${Math.round(volume).toLocaleString('en-GB')}</span>
                            </div>
                        </div>
                        <div class="alarm-score" style="background: linear-gradient(135deg, #06b6d4, #0891b2);">üëë</div>
                    </div>
                    <div id="vl-detail-${idx}" class="vl-alarm-detail" style="display: none; background: #0d1117; border: 1px solid #30363d; border-top: none; border-left: 3px solid #06b6d4; border-radius: 0 0 8px 8px; padding: 15px; margin-top: -5px;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <div class="vl-detail-section">
                                <div style="color: #06b6d4; font-weight: 600; margin-bottom: 8px; font-size: 12px;">üëë LIDER DEGISIMI DETAYI</div>
                                <div class="detail-row-inline"><span style="color: #8b949e;">Eski Lider:</span> <span style="color: #f85149; font-weight: 700; font-size: 15px;">${oldLeader}</span></div>
                                <div class="detail-row-inline"><span style="color: #8b949e;">Eski Pay:</span> <span style="color: #f85149; font-weight: 600;">%${oldShare.toFixed(1)}</span></div>
                                <div class="detail-row-inline"><span style="color: #8b949e;">Yeni Lider:</span> <span style="color: #3fb950; font-weight: 700; font-size: 15px;">${newLeader}</span></div>
                                <div class="detail-row-inline"><span style="color: #8b949e;">Yeni Pay:</span> <span style="color: #3fb950; font-weight: 600;">%${newShare.toFixed(1)}</span></div>
                            </div>
                            <div class="vl-detail-section">
                                <div style="color: #58a6ff; font-weight: 600; margin-bottom: 8px; font-size: 12px;">üìä MAC BILGILERI</div>
                                <div class="detail-row-inline"><span style="color: #8b949e;">Ev Sahibi:</span> <span style="color: #f0f6fc;">${alarm.home}</span></div>
                                <div class="detail-row-inline"><span style="color: #8b949e;">Deplasman:</span> <span style="color: #f0f6fc;">${alarm.away}</span></div>
                                <div class="detail-row-inline"><span style="color: #8b949e;">Market:</span> <span style="color: #f0f6fc;">${alarm.market}</span></div>
                                <div class="detail-row-inline"><span style="color: #8b949e;">Toplam Hacim:</span> <span style="color: #3fb950; font-weight: 600;">¬£${Math.round(volume).toLocaleString('en-GB')}</span></div>
                            </div>
                            <div class="vl-detail-section">
                                <div style="color: #f0883e; font-weight: 600; margin-bottom: 8px; font-size: 12px;">üìÖ ZAMAN BILGILERI</div>
                                <div class="detail-row-inline"><span style="color: #8b949e;">Mac Tarihi:</span> <span style="color: #58a6ff;">${formatMatchDateTR(alarm.match_date)}</span></div>
                                <div class="detail-row-inline"><span style="color: #8b949e;">Hesaplama:</span> <span style="color: #f0f6fc;">${createdAt}</span></div>
                            </div>
                        </div>
                        <div style="margin-top: 12px; padding: 10px; background: rgba(6, 182, 212, 0.15); border-radius: 6px; border-left: 3px solid #06b6d4;">
                            <span style="color: #06b6d4; font-weight: 600;">üëë Lider Degisimi Sinyali:</span>
                            <span style="color: #c9d1d9; font-size: 12px; margin-left: 8px;">
                                ${oldLeader} secenegi %${oldShare.toFixed(0)} payla liderken, ${newLeader} secenegi %${newShare.toFixed(0)} paya ulasarak yeni lider oldu. Buyuk oyuncular pozisyon degistiriyor olabilir!
                            </span>
                        </div>
                    </div>
                </div>
            `}).join('');
            
            window.currentVolumeLeaderAlarms = alarms;
        }
        
        function toggleVolumeLeaderDetail(idx) {
            const detailEl = document.getElementById(`vl-detail-${idx}`);
            const toggleIcon = document.getElementById(`vl-toggle-icon-${idx}`);
            
            if (detailEl.style.display === 'none') {
                detailEl.style.display = 'block';
                if (toggleIcon) toggleIcon.textContent = '‚ñº';
            } else {
                detailEl.style.display = 'none';
                if (toggleIcon) toggleIcon.textContent = '‚ñ∂';
            }
        }
        
        function filterVolumeLeaderAlarms() {
            const searchTerm = document.getElementById('volumeLeaderSearchInput').value.toLowerCase().trim();
            let filtered = filterAlarmsByDateMode(allVolumeLeaderAlarms, 'volumeLeader');
            
            if (searchTerm) {
                filtered = filtered.filter(alarm => 
                    (alarm.home || '').toLowerCase().includes(searchTerm) ||
                    (alarm.away || '').toLowerCase().includes(searchTerm)
                );
            }
            
            updateTotalCount('volumeLeaderAlarmTotalCount', allVolumeLeaderAlarms.length);
            renderVolumeLeaderAlarms(filtered, allVolumeLeaderAlarms.length);
        }
        
        async function saveVolumeLeaderConfig() {
            const config = {
                min_volume_1x2: parseInt(document.getElementById('vlMinVolume1x2').value) || 5000,
                min_volume_ou25: parseInt(document.getElementById('vlMinVolumeOu25').value) || 2000,
                min_volume_btts: parseInt(document.getElementById('vlMinVolumeBtts').value) || 1000,
                leader_threshold: 50
            };
            
            try {
                const response = await fetch('/api/volumeleader/config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });
                if (response.ok) {
                    showToast('Hacim Lideri ayarlari kaydedildi!', 'success');
                } else {
                    showToast('Kayit hatasi!', 'error');
                }
            } catch (error) {
                showToast('Baglanti hatasi!', 'error');
            }
        }
        
        async function deleteAllVolumeLeaderAlarms() {
            if (!confirm('Tum Hacim Lideri alarmlari silinecek. Emin misiniz?')) return;
            
            try {
                const response = await fetch('/api/volumeleader/alarms', { method: 'DELETE' });
                if (response.ok) {
                    showToast('Tum Hacim Lideri alarmlar silindi!', 'success');
                    loadVolumeLeaderAlarms();
                } else {
                    showToast('Silme hatasi!', 'error');
                }
            } catch (error) {
                showToast('Baglanti hatasi!', 'error');
            }
        }
        
        // ============================================
        // MIM (Market Impact Money) FUNCTIONS
        // ============================================
        let mimAlarms = [];
        let mimFilteredAlarms = [];
        
        async function loadMimPage() {
            await Promise.all([loadMimConfig(), loadMimAlarms()]);
        }
        
        async function loadMimConfig() {
            try {
                const response = await fetch('/api/mim/config');
                const config = await response.json();
                document.getElementById('mimMinImpact').value = config.min_impact_threshold ?? 0.10;
                document.getElementById('mimMinPrevVolume').value = config.min_prev_volume ?? 1000;
            } catch (error) {
                console.error('MIM config yuklenemedi:', error);
            }
        }
        
        async function loadMimAlarms() {
            try {
                const response = await fetch('/api/alarms/mim');
                mimAlarms = await response.json();
                mimAlarms.sort((a, b) => new Date(b.trigger_at || b.created_at) - new Date(a.trigger_at || a.created_at));
                mimFilteredAlarms = [...mimAlarms];
                
                updateMimStats();
                renderMimAlarms();
            } catch (error) {
                console.error('MIM alarmlar yuklenemedi:', error);
            }
        }
        
        function updateMimStats() {
            document.getElementById('mimTotalAlarms').textContent = mimAlarms.length;
            
            const today = new Date().toISOString().split('T')[0];
            const todayAlarms = mimAlarms.filter(a => {
                const alarmDate = (a.trigger_at || a.created_at || '').split('T')[0];
                return alarmDate === today;
            });
            document.getElementById('mimTodayAlarms').textContent = todayAlarms.length;
            
            if (mimAlarms.length > 0) {
                const avgImpact = mimAlarms.reduce((sum, a) => sum + (a.impact || 0), 0) / mimAlarms.length;
                document.getElementById('mimAvgImpact').textContent = avgImpact.toFixed(2);
            } else {
                document.getElementById('mimAvgImpact').textContent = '-';
            }
            
            document.getElementById('mimAlarmCount').textContent = mimFilteredAlarms.length;
        }
        
        function renderMimAlarms() {
            const container = document.getElementById('mimAlarmList');
            const countEl = document.getElementById('mimAlarmCount');
            const totalCountEl = document.getElementById('mimAlarmTotalCount');
            
            if (countEl) countEl.textContent = mimFilteredAlarms.length;
            if (totalCountEl && mimAlarms.length !== mimFilteredAlarms.length) {
                totalCountEl.textContent = `/ ${mimAlarms.length} toplam`;
            } else if (totalCountEl) {
                totalCountEl.textContent = '';
            }
            
            if (!mimFilteredAlarms || mimFilteredAlarms.length === 0) {
                container.innerHTML = '<p style="color: #8b949e; padding: 20px 0; text-align: center;">Henuz MIM alarm yok.</p>';
                return;
            }
            
            let html = `
                <div class="alarm-table-wrapper" style="overflow-x: auto;">
                    <table class="alarm-table" style="width: 100%; font-size: 12px;">
                        <thead>
                            <tr style="background: #161b22; color: #8b949e;">
                                <th style="padding: 10px; text-align: left;">Mac</th>
                                <th style="padding: 10px; text-align: center;">Market</th>
                                <th style="padding: 10px; text-align: center;">Impact</th>
                                <th style="padding: 10px; text-align: right;">Gelen Para</th>
                                <th style="padding: 10px; text-align: right;">Toplam Hacim</th>
                                <th style="padding: 10px; text-align: right;">Onceki Hacim</th>
                                <th style="padding: 10px; text-align: center;">Zaman</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            mimFilteredAlarms.slice(0, 100).forEach(alarm => {
                const matchName = `${alarm.home || '-'} vs ${alarm.away || '-'}`;
                const market = alarm.market || '-';
                const impact = alarm.impact || alarm.money_impact || 0;
                const impactPct = (impact * 100).toFixed(1);
                const prevVol = alarm.prev_volume || alarm.previous_volume || 0;
                const currVol = alarm.current_volume || alarm.total_volume || alarm.volume || 0;
                const moneyDiff = currVol - prevVol;
                
                const eventTime = alarm.trigger_at || alarm.event_time || alarm.created_at || '-';
                const formattedTime = eventTime !== '-' ? formatDateTime(eventTime) : '-';
                
                const impactColor = impact >= 0.20 ? '#22c55e' : impact >= 0.15 ? '#3B82F6' : '#60a5fa';
                
                html += `
                    <tr style="border-bottom: 1px solid #21262d; cursor: pointer;" onclick="showMimAlarmDetail(${JSON.stringify(alarm).replace(/"/g, '&quot;')})">
                        <td style="padding: 10px; color: #e6edf3;">${matchName}</td>
                        <td style="padding: 10px; text-align: center;"><span style="background: rgba(59,130,246,0.2); color: #3B82F6; padding: 2px 8px; border-radius: 4px; font-size: 11px;">${market}</span></td>
                        <td style="padding: 10px; text-align: center; color: ${impactColor}; font-weight: 700;">${impactPct}%</td>
                        <td style="padding: 10px; text-align: right; color: #22c55e; font-weight: 600;">+¬£${Number(moneyDiff).toLocaleString('en-GB')}</td>
                        <td style="padding: 10px; text-align: right; color: #e6edf3;">¬£${Number(currVol).toLocaleString('en-GB')}</td>
                        <td style="padding: 10px; text-align: right; color: #8b949e;">¬£${Number(prevVol).toLocaleString('en-GB')}</td>
                        <td style="padding: 10px; text-align: center; color: #8b949e; font-size: 11px;">${formattedTime}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table></div>';
            
            if (mimFilteredAlarms.length > 100) {
                html += `<p style="text-align: center; color: #6e7681; padding: 10px; font-size: 12px;">+${mimFilteredAlarms.length - 100} daha fazla alarm...</p>`;
            }
            
            container.innerHTML = html;
        }
        
        function showMimAlarmDetail(alarm) {
            const impact = alarm.impact || alarm.money_impact || 0;
            const impactPct = (impact * 100).toFixed(1);
            const prevVol = alarm.prev_volume || alarm.previous_volume || 0;
            const currVol = alarm.current_volume || alarm.total_volume || 0;
            const moneyDiff = currVol - prevVol;
            
            const body = document.querySelector('.modal-body') || document.createElement('div');
            body.innerHTML = `
                <div style="padding: 20px; background: #0d1117; border-radius: 8px;">
                    <h3 style="color: #3B82F6; margin-bottom: 15px;">üíé MIM Alarm Detayi</h3>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                        <div><strong style="color: #8b949e;">Mac:</strong> <span style="color: #e6edf3;">${alarm.home} vs ${alarm.away}</span></div>
                        <div><strong style="color: #8b949e;">Market:</strong> <span style="color: #e6edf3;">${alarm.market}</span></div>
                        <div><strong style="color: #8b949e;">Impact:</strong> <span style="color: #3B82F6; font-weight: 700;">${impactPct}%</span></div>
                        <div><strong style="color: #8b949e;">Gelen Para:</strong> <span style="color: #22c55e; font-weight: 600;">+¬£${Number(moneyDiff).toLocaleString('en-GB')}</span></div>
                        <div><strong style="color: #8b949e;">Toplam Hacim:</strong> <span style="color: #e6edf3;">¬£${Number(currVol).toLocaleString('en-GB')}</span></div>
                        <div><strong style="color: #8b949e;">Onceki Hacim:</strong> <span style="color: #8b949e;">¬£${Number(prevVol).toLocaleString('en-GB')}</span></div>
                    </div>
                </div>
            `;
            console.log('MIM Alarm Detail:', alarm);
        }
        
        function filterMimAlarms() {
            const searchInput = document.getElementById('mimSearchInput');
            const dateFilter = document.getElementById('mimAlarmDateFilter')?.value || '';
            const searchTerm = (searchInput?.value || '').toLowerCase();
            
            mimFilteredAlarms = mimAlarms.filter(alarm => {
                const matchName = `${alarm.home || ''} ${alarm.away || ''}`.toLowerCase();
                const matchesSearch = !searchTerm || matchName.includes(searchTerm);
                
                let matchesDate = true;
                if (dateFilter) {
                    const matchDate = alarm.match_date || alarm.kickoff || '';
                    const today = new Date().toISOString().split('T')[0];
                    const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];
                    
                    if (dateFilter === 'today') {
                        matchesDate = matchDate.startsWith(today);
                    } else if (dateFilter === 'yesterday') {
                        matchesDate = matchDate.startsWith(yesterday);
                    } else if (dateFilter === 'future') {
                        matchesDate = matchDate > today;
                    }
                }
                
                return matchesSearch && matchesDate;
            });
            
            renderMimAlarms();
        }
        
        async function saveMimConfig() {
            const config = {
                min_impact_threshold: parseFloat(document.getElementById('mimMinImpact').value) || 0.10,
                min_prev_volume: parseInt(document.getElementById('mimMinPrevVolume').value) || 1000
            };
            
            try {
                const response = await fetch('/api/mim/config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });
                if (response.ok) {
                    showToast('MIM ayarlari kaydedildi!', 'success');
                } else {
                    showToast('Kayit hatasi!', 'error');
                }
            } catch (error) {
                showToast('Baglanti hatasi!', 'error');
            }
        }
        
        async function deleteAllMimAlarms() {
            if (!confirm('Tum MIM alarmlari silinecek. Emin misiniz?')) return;
            
            try {
                const response = await fetch('/api/mim/alarms', { method: 'DELETE' });
                if (response.ok) {
                    showToast('Tum MIM alarmlar silindi!', 'success');
                    loadMimAlarms();
                } else {
                    showToast('Silme hatasi!', 'error');
                }
            } catch (error) {
                showToast('Baglanti hatasi!', 'error');
            }
        }
        
        // MIM date filter handler
        function setupMimDateFilter() {
            const btns = document.querySelectorAll('#page-mim .date-filter-btn');
            btns.forEach(btn => {
                btn.addEventListener('click', function() {
                    btns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                });
            });
        }
        
        // ============================================
        // END MIM FUNCTIONS
        // ============================================
        
        // ============================================
        // TELEGRAM FUNCTIONS
        // ============================================
        
        async function loadTelegramSettings() {
            try {
                const response = await fetch('/api/telegram/settings');
                const data = await response.json();
                
                if (data.success && data.settings) {
                    document.getElementById('telegramEnabled').checked = data.settings.telegram_enabled === 'true';
                    
                    const messageMode = data.settings.telegram_message_mode || 'image';
                    document.getElementById('messageModeImage').checked = messageMode === 'image';
                    document.getElementById('messageModeText').checked = messageMode === 'text';
                    
                    const alarmTypes = JSON.parse(data.settings.telegram_alarm_types || '[]');
                    document.querySelectorAll('.telegram-alarm-type').forEach(checkbox => {
                        checkbox.checked = alarmTypes.includes(checkbox.value);
                    });
                    
                    document.getElementById('bigMoneyRetriggerEnabled').checked = data.settings.big_money_retrigger_enabled === 'true';
                    document.getElementById('bigMoneyRetriggerDelta').value = data.settings.big_money_retrigger_min_delta || 500;
                    document.getElementById('bigMoneyRetriggerCooldown').value = data.settings.big_money_retrigger_cooldown_min || 10;
                }
            } catch (error) {
                console.error('Telegram ayarlari yuklenemedi:', error);
            }
        }
        
        async function saveTelegramSettings() {
            const alarmTypes = [];
            document.querySelectorAll('.telegram-alarm-type:checked').forEach(checkbox => {
                alarmTypes.push(checkbox.value);
            });
            
            const messageMode = document.getElementById('messageModeImage').checked ? 'image' : 'text';
            
            const settings = {
                telegram_enabled: document.getElementById('telegramEnabled').checked ? 'true' : 'false',
                telegram_message_mode: messageMode,
                telegram_alarm_types: JSON.stringify(alarmTypes),
                big_money_retrigger_enabled: document.getElementById('bigMoneyRetriggerEnabled').checked ? 'true' : 'false',
                big_money_retrigger_min_delta: document.getElementById('bigMoneyRetriggerDelta').value,
                big_money_retrigger_cooldown_min: document.getElementById('bigMoneyRetriggerCooldown').value
            };
            
            try {
                const response = await fetch('/api/telegram/settings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(settings)
                });
                
                if (response.ok) {
                    showToast('Telegram ayarlari kaydedildi!', 'success');
                } else {
                    showToast('Kayit hatasi!', 'error');
                }
            } catch (error) {
                showToast('Baglanti hatasi!', 'error');
            }
        }
        
        async function testTelegramMessage() {
            try {
                const response = await fetch('/api/telegram/test', { method: 'POST' });
                const data = await response.json();
                
                if (data.success) {
                    showToast('Test mesaji gonderildi!', 'success');
                } else {
                    showToast('Gonderim hatasi: ' + (data.error || 'Bilinmeyen hata'), 'error');
                }
            } catch (error) {
                showToast('Baglanti hatasi!', 'error');
            }
        }
        
        async function loadTelegramStats() {
            try {
                const response = await fetch('/api/telegram/stats');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('telegramTotalSent').textContent = data.total || 0;
                    document.getElementById('telegramTodaySent').textContent = data.today || 0;
                    document.getElementById('telegramStatus').textContent = data.enabled ? 'Aktif' : 'Pasif';
                    document.getElementById('telegramStatus').style.color = data.enabled ? '#3fb950' : '#f85149';
                    
                    if (data.recent_logs && data.recent_logs.length > 0) {
                        const logList = document.getElementById('telegramLogList');
                        logList.innerHTML = data.recent_logs.map(log => `
                            <div style="padding: 10px; border-bottom: 1px solid #30363d; display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <span style="color: #58a6ff;">${log.alarm_type}</span> - 
                                    <span>${log.match_id_hash}</span>
                                </div>
                                <div style="color: #8b949e; font-size: 12px;">${log.last_sent_at}</div>
                            </div>
                        `).join('');
                    }
                }
            } catch (error) {
                console.error('Telegram stats yuklenemedi:', error);
            }
        }
        
        // ============================================
        // END TELEGRAM FUNCTIONS
        // ============================================
        
        function showVolumeLeaderCalcStatus() {
            const statusEl = document.getElementById('volumeLeaderCalcStatus');
            if (statusEl) statusEl.style.display = 'block';
        }
        
        function hideVolumeLeaderCalcStatus() {
            const statusEl = document.getElementById('volumeLeaderCalcStatus');
            if (statusEl) statusEl.style.display = 'none';
        }
        
        async function resetVolumeLeaderCalculation() {
            try {
                const response = await fetch('/api/volumeleader/reset', { method: 'POST' });
                const data = await response.json();
                if (data.success) {
                    hideVolumeLeaderCalcStatus();
                    showToast('Hacim Lideri hesaplama sifirlandi!', 'success');
                }
            } catch (error) {
                showToast('Sifirlama hatasi!', 'error');
            }
        }
        
        async function calculateVolumeLeader() {
            showVolumeLeaderCalcStatus();
            document.getElementById('volumeLeaderCalcProgress').textContent = 'Hacim Lideri hesaplaniyor...';
            
            try {
                const response = await fetch('/api/volumeleader/calculate', { method: 'POST' });
                const data = await response.json();
                
                if (data.success) {
                    // Poll for completion
                    let checkCount = 0;
                    const maxChecks = 60;
                    const checkInterval = setInterval(async () => {
                        checkCount++;
                        try {
                            const statusRes = await fetch('/api/volumeleader/status');
                            const status = await statusRes.json();
                            
                            document.getElementById('volumeLeaderCalcProgress').textContent = status.progress || 'Hesaplaniyor...';
                            
                            if (!status.calculating || checkCount >= maxChecks) {
                                clearInterval(checkInterval);
                                hideVolumeLeaderCalcStatus();
                                showToast(`Hacim Lideri hesaplandi! ${data.count || 0} alarm bulundu.`, 'success');
                                loadVolumeLeaderAlarms();
                            }
                        } catch (e) {
                            clearInterval(checkInterval);
                            hideVolumeLeaderCalcStatus();
                        }
                    }, 2000);
                } else {
                    hideVolumeLeaderCalcStatus();
                    showToast('Hesaplama hatasi: ' + (data.error || 'Bilinmeyen hata'), 'error');
                }
            } catch (error) {
                hideVolumeLeaderCalcStatus();
                showToast('Baglanti hatasi!', 'error');
            }
        }
        
        function showVolumeLeaderAlarmDetail(idx) {
            const alarm = window.currentVolumeLeaderAlarms[idx];
            if (!alarm) return;

            const modal = document.getElementById('alarmDetailModal');
            const body = document.getElementById('alarmDetailBody');

            body.innerHTML = `
                <div class="detail-section">
                    <h4>üëë Hacim Lideri Degisimi Detayi</h4>
                    <div class="detail-row"><span class="detail-label">Mac</span><span class="detail-value">${alarm.home} vs ${alarm.away}</span></div>
                    <div class="detail-row"><span class="detail-label">Market</span><span class="detail-value">${alarm.market}</span></div>
                    <div class="detail-row"><span class="detail-label">Lig</span><span class="detail-value">${alarm.league || '-'}</span></div>
                    <div class="detail-row"><span class="detail-label">Hesaplama Tarihi</span><span class="detail-value">${alarm.created_at || '-'}</span></div>
                </div>
                <div class="detail-section">
                    <h4 style="color: #06b6d4;">üîÑ Lider Degisimi</h4>
                    <div class="detail-row"><span class="detail-label">Eski Lider</span><span class="detail-value" style="color: #f85149;">${alarm.old_leader} (%${(alarm.old_share || 0).toFixed(1)})</span></div>
                    <div class="detail-row"><span class="detail-label">Yeni Lider</span><span class="detail-value" style="color: #3fb950;">${alarm.new_leader} (%${(alarm.new_share || 0).toFixed(1)})</span></div>
                    <div class="detail-row"><span class="detail-label">Toplam Volume</span><span class="detail-value" style="color: #58a6ff;">¬£${Math.round(alarm.volume || 0).toLocaleString('en-GB')}</span></div>
                </div>
                <div class="detail-section">
                    <h4 style="color: #f0883e;">üìä Analiz</h4>
                    <p style="font-size: 12px; color: #8b949e; line-height: 1.6;">
                        Para akisinda dramatik bir degisim tespit edildi. Daha once <strong style="color:#f85149;">${alarm.old_leader}</strong> secenegi %${(alarm.old_share || 0).toFixed(0)} payla liderken, 
                        simdi <strong style="color:#3fb950;">${alarm.new_leader}</strong> secenegi %${(alarm.new_share || 0).toFixed(0)} payla lider konumuna gecti.
                        <br><br>
                        <strong style="color: #06b6d4;">Sinyal:</strong> Buyuk oyuncular pozisyon degistiriyor olabilir!
                    </p>
                </div>
            `;
            
            modal.style.display = 'flex';
        }
        
        // =====================================================
        // END VOLUME LEADER FUNCTIONS
        // =====================================================

        function showBigMoneyCalcStatus() {
            const statusEl = document.getElementById('bigMoneyCalcStatus');
            if (statusEl) statusEl.style.display = 'block';
        }

        function hideBigMoneyCalcStatus() {
            const statusEl = document.getElementById('bigMoneyCalcStatus');
            if (statusEl) statusEl.style.display = 'none';
        }

        async function resetBigMoneyCalculation() {
            try {
                const response = await fetch('/api/bigmoney/reset', { method: 'POST' });
                const data = await response.json();
                if (data.success) {
                    hideBigMoneyCalcStatus();
                    showToast('Big Money hesaplama sifirlandi!', 'success');
                }
            } catch (error) {
                showToast('Sifirlama hatasi!', 'error');
            }
        }
        
        async function calculateBigMoney() {
            showBigMoneyCalcStatus();
            document.getElementById('bigMoneyCalcProgress').textContent = 'Big Money hesaplaniyor...';
            
            try {
                const response = await fetch('/api/bigmoney/calculate', { method: 'POST' });
                const data = await response.json();
                
                hideBigMoneyCalcStatus();
                
                if (data.success) {
                    showToast(`Big Money hesaplandi! ${data.count} alarm bulundu.`, 'success');
                    loadBigMoneyAlarms();
                } else {
                    showToast('Hesaplama hatasi: ' + (data.error || 'Bilinmeyen hata'), 'error');
                }
            } catch (error) {
                hideBigMoneyCalcStatus();
                showToast('Baglanti hatasi!', 'error');
            }
        }

        function showBigMoneyAlarmDetail(idx) {
            const alarm = window.currentBigMoneyAlarms[idx];
            if (!alarm) return;

            const modal = document.getElementById('alarmDetailModal');
            const body = document.getElementById('alarmDetailBody');
            
            const isHuge = alarm.is_huge;
            const bgColor = isHuge ? '#ff7b00' : '#f0b429';
            const icon = isHuge ? 'üî•' : 'üí∞';
            const label = isHuge ? 'HUGE MONEY' : 'BIG MONEY';

            body.innerHTML = `
                <div class="detail-section">
                    <h4 style="color: ${bgColor};">${icon} ${label} Alarm Detaylari</h4>
                    <div class="detail-row"><span class="detail-label">Mac</span><span class="detail-value">${alarm.home} vs ${alarm.away}</span></div>
                    <div class="detail-row"><span class="detail-label">Market</span><span class="detail-value">${alarm.market}</span></div>
                    <div class="detail-row"><span class="detail-label">Secenek</span><span class="detail-value">${alarm.selection}</span></div>
                    <div class="detail-row"><span class="detail-label">Mac Tarihi</span><span class="detail-value" style="color: #58a6ff;">${formatMatchDateTR(alarm.match_date)}</span></div>
                    <div class="detail-row"><span class="detail-label">Hesaplama Tarihi</span><span class="detail-value">${alarm.created_at || '-'}</span></div>
                </div>
                <div class="detail-section">
                    <h4>üí∞ Para Bilgileri</h4>
                    <div class="detail-row"><span class="detail-label">Maksimum Gelen Para</span><span class="detail-value highlight" style="color: ${bgColor};">¬£${Math.round(alarm.incoming_money || 0).toLocaleString('en-GB')}</span></div>
                    <div class="detail-row"><span class="detail-label">Alarm Limiti</span><span class="detail-value">¬£${Math.round(alarm.big_money_limit || 15000).toLocaleString('en-GB')}</span></div>
                    ${isHuge ? `<div class="detail-row"><span class="detail-label">Ardisik 2 Snapshot Toplami</span><span class="detail-value" style="color: #ff7b00;">¬£${Math.round(alarm.huge_total || 0).toLocaleString('en-GB')}</span></div>` : ''}
                    <div class="detail-row"><span class="detail-label">Limit Asan Snapshot Sayisi</span><span class="detail-value">${alarm.snapshot_count || 1}</span></div>
                </div>
                <div class="detail-section">
                    <h4 style="color: ${bgColor};">${icon} ${label} Sinyali</h4>
                    <p style="font-size: 12px; color: #8b949e; line-height: 1.6;">
                        ${isHuge ? 
                            `Bu macta <strong style="color:#ff7b00;">2 ardisik snapshot</strong>'ta ${alarm.selection} secenegine ¬£${alarm.big_money_limit?.toLocaleString('en-GB') || '15,000'}+ para girisi tespit edildi!<br><br>
                            Toplam: <strong style="color:#ff7b00;">¬£${Math.round(alarm.huge_total || 0).toLocaleString('en-GB')}</strong><br><br>
                            <strong style="color: #ff7b00;">Sonuc:</strong> Cok buyuk oyuncular (syndicates, professional bettors) seri sekilde pozisyon aliyor olabilir!` 
                            : 
                            `Bu macta ${alarm.selection} secenegine tek snapshot'ta ¬£${Math.round(alarm.incoming_money || 0).toLocaleString('en-GB')} para girisi tespit edildi!<br><br>
                            <strong style="color: #f0b429;">Sonuc:</strong> Buyuk oyuncular (sharps) pozisyon aliyor olabilir!`
                        }
                    </p>
                </div>
            `;
            modal.style.display = 'flex';
        }

        // ==================== DROPPING ALERT FUNCTIONS ====================
        let allDroppingAlarms = [];

        async function loadDroppingConfig() {
            try {
                const response = await fetch('/api/dropping/config');
                if (response.ok) {
                    const config = await response.json();
                    document.getElementById('droppingMinL1').value = config.min_drop_l1 ?? '';
                    document.getElementById('droppingMaxL1').value = config.max_drop_l1 ?? '';
                    document.getElementById('droppingMinL2').value = config.min_drop_l2 ?? '';
                    document.getElementById('droppingMaxL2').value = config.max_drop_l2 ?? '';
                    document.getElementById('droppingMinL3').value = config.min_drop_l3 ?? '';
                    document.getElementById('droppingL2Enabled').checked = config.l2_enabled !== false;
                    document.getElementById('droppingL3Enabled').checked = config.l3_enabled !== false;
                    document.getElementById('droppingPersistenceEnabled').checked = config.persistence_enabled !== false;
                    document.getElementById('droppingPersistenceMinutes').value = config.persistence_minutes ?? '';
                    document.getElementById('dropping_min_volume_1x2').value = config.min_volume_1x2 ?? '';
                    document.getElementById('dropping_min_volume_ou25').value = config.min_volume_ou25 ?? '';
                    document.getElementById('dropping_min_volume_btts').value = config.min_volume_btts ?? '';
                    
                    // Max Odds Filter
                    document.getElementById('droppingMaxOdds1x2').value = config.max_odds_1x2 ?? '';
                    document.getElementById('droppingMaxOddsOu25').value = config.max_odds_ou25 ?? '';
                    document.getElementById('droppingMaxOddsBtts').value = config.max_odds_btts ?? '';
                }
            } catch (error) {
                console.error('Dropping config yukleme hatasi:', error);
            }
        }

        async function loadDroppingAlarms() {
            try {
                const response = await fetch('/api/dropping/alarms');
                if (response.ok) {
                    const alarms = await response.json();
                    // Yeniden eskiye sirala
                    allDroppingAlarms = sortAlarmsNewestFirst(alarms);
                    updateTotalCount('droppingAlarmTotalCount', allDroppingAlarms.length);
                    renderDroppingAlarms(allDroppingAlarms);
                }
            } catch (error) {
                console.error('Dropping alarm yukleme hatasi:', error);
            }
        }

        function renderDroppingAlarms(alarms, totalCount = null) {
            const container = document.getElementById('droppingAlarmList');
            const countEl = document.getElementById('droppingAlarmCount');
            
            if (!alarms || alarms.length === 0) {
                const searchTerm = document.getElementById('droppingSearchInput')?.value || '';
                if (searchTerm) {
                    container.innerHTML = '<p style="color: #8b949e; padding: 20px 0; text-align: center;">Aramayla eslesen Dropping alarm yok.</p>';
                    countEl.textContent = `0/${totalCount || 0}`;
                } else {
                    container.innerHTML = '<p style="color: #8b949e; padding: 20px 0; text-align: center;">Henuz Dropping alarm yok. "üìâ Dropping Hesapla" butonuna basin.</p>';
                    countEl.textContent = '0';
                }
                return;
            }

            countEl.textContent = totalCount ? `${alarms.length}/${totalCount}` : alarms.length;
            container.innerHTML = alarms.map((alarm, idx) => {
                const levelColors = { 'L1': '#e74c3c', 'L2': '#f39c12', 'L3': '#c0392b' };
                const bgColor = levelColors[alarm.level] || '#e74c3c';
                const levelText = alarm.level === 'L1' ? 'Dusuk' : alarm.level === 'L2' ? 'Orta' : 'Yuksek';
                const zebraStyle = idx % 2 === 0 ? 'background: #161b22;' : 'background: #1c2128;';
                
                return `
                <div class="dropping-alarm-wrapper" id="dropping-alarm-${idx}">
                    <div class="alarm-item" onclick="toggleDroppingDetail(${idx})" style="border-left: 3px solid ${bgColor}; cursor: pointer; ${zebraStyle}">
                        <div class="alarm-info">
                            <div class="alarm-match">
                                <span style="margin-right: 8px; color: ${bgColor}; font-size: 14px; font-weight: bold;" id="dropping-toggle-icon-${idx}">‚ñ∂</span>
                                <span style="background:${bgColor};color:#fff;padding:2px 6px;border-radius:4px;font-size:10px;margin-right:8px;">üìâ ${alarm.level}</span>
                                ${alarm.home} vs ${alarm.away}
                            </div>
                            <div class="alarm-meta">${alarm.market} | ${alarm.selection} | ${alarm.created_at || ''}</div>
                            <div class="alarm-breakdown" style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 6px; font-size: 11px;">
                                <span style="color: ${bgColor};" title="Dusus Yuzdesi">üìâ %${(alarm.drop_pct || 0).toFixed(1)}</span>
                                <span style="color: #58a6ff;" title="Acilis Orani">üìä Acilis: ${alarm.opening_odds || 0}</span>
                                <span style="color: #3fb950;" title="Guncel Oran">üìà Simdi: ${alarm.current_odds || 0}</span>
                                <span style="color: #f0883e;" title="Hacim">üí∞ ¬£${(alarm.volume || 0).toLocaleString('en-GB')}</span>
                            </div>
                        </div>
                        <div class="alarm-score" style="background: linear-gradient(135deg, ${bgColor}, ${bgColor}dd);">${alarm.level}</div>
                    </div>
                    <div id="dropping-detail-${idx}" class="dropping-alarm-detail" style="display: none; background: #0d1117; border: 1px solid #30363d; border-top: none; border-left: 3px solid ${bgColor}; border-radius: 0 0 8px 8px; padding: 15px; margin-top: -5px;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <div class="dropping-detail-section">
                                <div style="color: ${bgColor}; font-weight: 600; margin-bottom: 8px; font-size: 12px;">üìâ ORAN DUSUSU DETAYI</div>
                                <div class="detail-row-inline"><span style="color: #8b949e;">Acilis Orani:</span> <span style="color: #94a3b8; font-size: 15px; font-weight: 600;">${alarm.opening_odds || 0}</span></div>
                                <div class="detail-row-inline"><span style="color: #8b949e;">Guncel Oran:</span> <span style="color: #22c55e; font-weight: 700; font-size: 15px;">${alarm.current_odds || 0}</span></div>
                                <div class="detail-row-inline"><span style="color: #8b949e;">Dusus Yuzdesi:</span> <span style="color: ${bgColor}; font-weight: 700; font-size: 16px;">%${(alarm.drop_pct || 0).toFixed(2)}</span></div>
                                <div class="detail-row-inline"><span style="color: #8b949e;">Seviye:</span> <span style="color: ${bgColor}; font-weight: 700;">${alarm.level} (${levelText})</span></div>
                            </div>
                            <div class="dropping-detail-section">
                                <div style="color: #58a6ff; font-weight: 600; margin-bottom: 8px; font-size: 12px;">üìä MARKET BILGILERI</div>
                                <div class="detail-row-inline"><span style="color: #8b949e;">Ev Sahibi:</span> <span style="color: #f0f6fc;">${alarm.home}</span></div>
                                <div class="detail-row-inline"><span style="color: #8b949e;">Deplasman:</span> <span style="color: #f0f6fc;">${alarm.away}</span></div>
                                <div class="detail-row-inline"><span style="color: #8b949e;">Market:</span> <span style="color: #f0f6fc;">${alarm.market}</span></div>
                                <div class="detail-row-inline"><span style="color: #8b949e;">Secenek:</span> <span style="color: #a371f7; font-weight: 600;">${alarm.selection}</span></div>
                                <div class="detail-row-inline"><span style="color: #8b949e;">Hacim:</span> <span style="color: #3fb950; font-weight: 600;">¬£${(alarm.volume || 0).toLocaleString('en-GB')}</span></div>
                            </div>
                            <div class="dropping-detail-section">
                                <div style="color: #f0883e; font-weight: 600; margin-bottom: 8px; font-size: 12px;">üìÖ ZAMAN BILGILERI</div>
                                <div class="detail-row-inline"><span style="color: #8b949e;">Mac Tarihi:</span> <span style="color: #58a6ff;">${formatMatchDateTR(alarm.match_date)}</span></div>
                                <div class="detail-row-inline"><span style="color: #8b949e;">Hesaplama:</span> <span style="color: #f0f6fc;">${alarm.created_at || '-'}</span></div>
                            </div>
                        </div>
                        <div style="margin-top: 12px; padding: 10px; background: rgba(${alarm.level === 'L1' ? '231,76,60' : alarm.level === 'L2' ? '243,156,18' : '192,57,43'}, 0.15); border-radius: 6px; border-left: 3px solid ${bgColor};">
                            <span style="color: ${bgColor}; font-weight: 600;">üìâ ${alarm.level} Sinyal:</span>
                            <span style="color: #c9d1d9; font-size: 12px; margin-left: 8px;">
                                ${alarm.level === 'L3' ? 'Cok buyuk oran dususu! Sharps agresif pozisyon aliyor olabilir!' : alarm.level === 'L2' ? 'Orta seviye oran dususu. Sharps aktivitesi muhtemel.' : 'Hafif oran dususu. Takip edilmeli.'}
                            </span>
                        </div>
                    </div>
                </div>
            `}).join('');

            window.currentDroppingAlarms = alarms;
        }
        
        function toggleDroppingDetail(idx) {
            const detailEl = document.getElementById(`dropping-detail-${idx}`);
            const toggleIcon = document.getElementById(`dropping-toggle-icon-${idx}`);
            
            if (detailEl.style.display === 'none') {
                detailEl.style.display = 'block';
                if (toggleIcon) toggleIcon.textContent = '‚ñº';
            } else {
                detailEl.style.display = 'none';
                if (toggleIcon) toggleIcon.textContent = '‚ñ∂';
            }
        }

        function filterDroppingAlarms() {
            const searchTerm = document.getElementById('droppingSearchInput').value.toLowerCase().trim();
            let filtered = filterAlarmsByDateMode(allDroppingAlarms, 'dropping');
            
            if (searchTerm) {
                filtered = filtered.filter(alarm => 
                    (alarm.home || '').toLowerCase().includes(searchTerm) ||
                    (alarm.away || '').toLowerCase().includes(searchTerm)
                );
            }
            
            updateTotalCount('droppingAlarmTotalCount', allDroppingAlarms.length);
            renderDroppingAlarms(filtered, allDroppingAlarms.length);
        }

        async function saveDroppingConfig() {
            const config = {
                min_drop_l1: parseFloat(document.getElementById('droppingMinL1').value) || 7,
                max_drop_l1: parseFloat(document.getElementById('droppingMaxL1').value) || 10,
                min_drop_l2: parseFloat(document.getElementById('droppingMinL2').value) || 10,
                max_drop_l2: parseFloat(document.getElementById('droppingMaxL2').value) || 15,
                min_drop_l3: parseFloat(document.getElementById('droppingMinL3').value) || 15,
                l2_enabled: document.getElementById('droppingL2Enabled').checked,
                l3_enabled: document.getElementById('droppingL3Enabled').checked,
                persistence_enabled: document.getElementById('droppingPersistenceEnabled').checked,
                persistence_minutes: parseInt(document.getElementById('droppingPersistenceMinutes').value) || 30,
                min_volume_1x2: parseInt(document.getElementById('dropping_min_volume_1x2').value) || 3000,
                min_volume_ou25: parseInt(document.getElementById('dropping_min_volume_ou25').value) || 1000,
                min_volume_btts: parseInt(document.getElementById('dropping_min_volume_btts').value) || 500,
                
                // Max Odds Filter
                max_odds_1x2: parseFloat(document.getElementById('droppingMaxOdds1x2').value) || 5.0,
                max_odds_ou25: parseFloat(document.getElementById('droppingMaxOddsOu25').value) || 3.0,
                max_odds_btts: parseFloat(document.getElementById('droppingMaxOddsBtts').value) || 3.0
            };
            
            try {
                const response = await fetch('/api/dropping/config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });
                if (response.ok) {
                    showToast('Dropping ayarlari kaydedildi!', 'success');
                } else {
                    showToast('Kayit hatasi!', 'error');
                }
            } catch (error) {
                showToast('Baglanti hatasi!', 'error');
            }
        }

        async function deleteAllDroppingAlarms() {
            if (!confirm('Tum Dropping alarmlarini silmek istediginize emin misiniz?')) return;
            
            try {
                const response = await fetch('/api/dropping/delete', { method: 'POST' });
                if (response.ok) {
                    showToast('Tum Dropping alarmlari silindi!', 'success');
                    loadDroppingAlarms();
                } else {
                    showToast('Silme hatasi!', 'error');
                }
            } catch (error) {
                showToast('Baglanti hatasi!', 'error');
            }
        }

        function showDroppingCalcStatus() {
            document.getElementById('droppingCalcStatus').style.display = 'block';
        }

        function hideDroppingCalcStatus() {
            document.getElementById('droppingCalcStatus').style.display = 'none';
        }

        async function resetDroppingCalculation() {
            try {
                const response = await fetch('/api/dropping/reset', { method: 'POST' });
                const data = await response.json();
                if (data.success) {
                    hideDroppingCalcStatus();
                    showToast('Dropping hesaplama sifirlandi!', 'success');
                }
            } catch (error) {
                showToast('Sifirlama hatasi!', 'error');
            }
        }
        
        async function calculateDropping() {
            showDroppingCalcStatus();
            document.getElementById('droppingCalcProgress').textContent = 'Dropping hesaplaniyor...';
            
            try {
                const response = await fetch('/api/dropping/calculate', { method: 'POST' });
                const data = await response.json();
                
                hideDroppingCalcStatus();
                
                if (data.success) {
                    showToast(`Dropping hesaplandi! ${data.count} alarm bulundu.`, 'success');
                    loadDroppingAlarms();
                } else {
                    showToast('Hesaplama hatasi: ' + (data.error || 'Bilinmeyen hata'), 'error');
                }
            } catch (error) {
                hideDroppingCalcStatus();
                showToast('Baglanti hatasi!', 'error');
            }
        }

        function showDroppingAlarmDetail(idx) {
            const alarm = window.currentDroppingAlarms[idx];
            if (!alarm) return;

            const modal = document.getElementById('alarmDetailModal');
            const body = document.getElementById('alarmDetailBody');
            
            const levelColors = { 'L1': '#f85149', 'L2': '#f85149', 'L3': '#f85149' };
            const bgColor = levelColors[alarm.level] || '#e74c3c';

            body.innerHTML = `
                <div class="detail-section">
                    <h4 style="color: ${bgColor};">üìâ ${alarm.level} Dropping Alert Detaylari</h4>
                    <div class="detail-row"><span class="detail-label">Mac</span><span class="detail-value">${alarm.home} vs ${alarm.away}</span></div>
                    <div class="detail-row"><span class="detail-label">Market</span><span class="detail-value">${alarm.market}</span></div>
                    <div class="detail-row"><span class="detail-label">Secenek</span><span class="detail-value">${alarm.selection}</span></div>
                    <div class="detail-row"><span class="detail-label">Mac Tarihi</span><span class="detail-value" style="color: #58a6ff;">${formatMatchDateTR(alarm.match_date)}</span></div>
                    <div class="detail-row"><span class="detail-label">Hesaplama Tarihi</span><span class="detail-value">${alarm.created_at || '-'}</span></div>
                </div>
                <div class="detail-section">
                    <h4>üìâ Oran Dususu Bilgileri</h4>
                    <div class="detail-row"><span class="detail-label">Acilis Orani</span><span class="detail-value">${alarm.opening_odds || 0}</span></div>
                    <div class="detail-row"><span class="detail-label">Guncel Oran</span><span class="detail-value">${alarm.current_odds || 0}</span></div>
                    <div class="detail-row"><span class="detail-label">Dusus Yuzdesi</span><span class="detail-value highlight" style="color: ${bgColor};">%${(alarm.drop_pct || 0).toFixed(2)}</span></div>
                    <div class="detail-row"><span class="detail-label">Seviye</span><span class="detail-value" style="color: ${bgColor}; font-weight: bold;">${alarm.level}</span></div>
                    <div class="detail-row"><span class="detail-label">Market Hacmi</span><span class="detail-value">¬£${(alarm.volume || 0).toLocaleString('en-GB')}</span></div>
                </div>
                <div class="detail-section">
                    <h4 style="color: ${bgColor};">üìâ ${alarm.level} Dropping Sinyali</h4>
                    <p style="font-size: 12px; color: #8b949e; line-height: 1.6;">
                        Bu macta ${alarm.selection} seceneginin orani acilistan bu yana <strong style="color:${bgColor};">%${(alarm.drop_pct || 0).toFixed(1)}</strong> dustu!<br><br>
                        Acilis: <strong>${alarm.opening_odds}</strong> ‚Üí Simdi: <strong>${alarm.current_odds}</strong><br><br>
                        <strong style="color: ${bgColor};">Sonuc:</strong> ${alarm.level === 'L3' ? 'Cok buyuk oran dususu! Profesyonel bahisciler (sharps) agresif sekilde pozisyon aliyor olabilir!' : alarm.level === 'L2' ? 'Orta seviye oran dususu. Sharps aktivitesi muhtemel.' : 'Hafif oran dususu. Takip edilmeli.'}
                    </p>
                </div>
            `;
            modal.style.display = 'flex';
        }

        function showAlarmDetail(idx) {
            const alarm = window.currentAlarms[idx];
            if (!alarm) return;

            const modal = document.getElementById('alarmDetailModal');
            const body = document.getElementById('alarmDetailBody');

            body.innerHTML = `
                <div class="detail-section">
                    <h4>Mac ve Secim Bilgisi</h4>
                    <div class="detail-row"><span class="detail-label">Mac</span><span class="detail-value">${alarm.home} vs ${alarm.away}</span></div>
                    <div class="detail-row"><span class="detail-label">Market</span><span class="detail-value">${alarm.market}</span></div>
                    <div class="detail-row"><span class="detail-label">Secenek</span><span class="detail-value">${alarm.selection}</span></div>
                    <div class="detail-row"><span class="detail-label">Mac Tarihi</span><span class="detail-value" style="color: #58a6ff;">${formatMatchDateTR(alarm.match_date)}</span></div>
                    <div class="detail-row"><span class="detail-label">Hesaplama Tarihi</span><span class="detail-value">${alarm.created_at || '-'}</span></div>
                </div>
                <div class="detail-section">
                    <h4>Hacim Soku</h4>
                    <div class="detail-row"><span class="detail-label">amount_change (gelen para)</span><span class="detail-value">¬£${Math.round(alarm.amount_change || 0).toLocaleString('en-GB')}</span></div>
                    <div class="detail-row"><span class="detail-label">avg_last_amounts</span><span class="detail-value">¬£${(alarm.avg_last_amounts || 0).toFixed(2)}</span></div>
                    <div class="detail-row"><span class="detail-label">shock_raw</span><span class="detail-value">${(alarm.shock_raw || 0).toFixed(2)}x</span></div>
                    <div class="detail-row"><span class="detail-label">volume_multiplier</span><span class="detail-value">${alarm.volume_multiplier || 1}</span></div>
                    <div class="detail-row"><span class="detail-label">shock_value</span><span class="detail-value highlight">${(alarm.shock_value || 0).toFixed(2)}</span></div>
                    <div class="detail-row"><span class="detail-label">max_volume_cap</span><span class="detail-value">${alarm.max_volume_cap || 0}</span></div>
                    <div class="detail-row"><span class="detail-label">volume_contrib (capped)</span><span class="detail-value highlight">${(alarm.volume_contrib || 0).toFixed(2)}</span></div>
                </div>
                <div class="detail-section">
                    <h4>Oran Dususu</h4>
                    <div class="detail-row"><span class="detail-label">previous_odds</span><span class="detail-value">${alarm.previous_odds || 0}</span></div>
                    <div class="detail-row"><span class="detail-label">current_odds</span><span class="detail-value">${alarm.current_odds || 0}</span></div>
                    <div class="detail-row"><span class="detail-label">drop_pct</span><span class="detail-value">${(alarm.drop_pct || 0).toFixed(2)}%</span></div>
                    <div class="detail-row"><span class="detail-label">odds_multiplier</span><span class="detail-value">${alarm.odds_multiplier || 1}</span></div>
                    <div class="detail-row"><span class="detail-label">odds_value</span><span class="detail-value highlight">${(alarm.odds_value || 0).toFixed(2)}</span></div>
                    <div class="detail-row"><span class="detail-label">max_odds_cap</span><span class="detail-value">${alarm.max_odds_cap || 0}</span></div>
                    <div class="detail-row"><span class="detail-label">odds_contrib (capped)</span><span class="detail-value highlight">${(alarm.odds_contrib || 0).toFixed(2)}</span></div>
                </div>
                <div class="detail-section">
                    <h4>Pay Degisimi</h4>
                    <div class="detail-row"><span class="detail-label">previous_share</span><span class="detail-value">${alarm.previous_share || 0}%</span></div>
                    <div class="detail-row"><span class="detail-label">current_share</span><span class="detail-value">${alarm.current_share || 0}%</span></div>
                    <div class="detail-row"><span class="detail-label">share_diff</span><span class="detail-value">${(alarm.share_diff || 0).toFixed(2)}%</span></div>
                    <div class="detail-row"><span class="detail-label">share_multiplier</span><span class="detail-value">${alarm.share_multiplier || 1}</span></div>
                    <div class="detail-row"><span class="detail-label">share_value</span><span class="detail-value highlight">${(alarm.share_value || 0).toFixed(2)}</span></div>
                    <div class="detail-row"><span class="detail-label">max_share_cap</span><span class="detail-value">${alarm.max_share_cap || 0}</span></div>
                    <div class="detail-row"><span class="detail-label">share_contrib (capped)</span><span class="detail-value highlight">${(alarm.share_contrib || 0).toFixed(2)}</span></div>
                </div>
                <div class="detail-section">
                    <h4>Final Skor</h4>
                    <div class="detail-row"><span class="detail-label">SharpScore</span><span class="detail-value highlight" style="font-size: 18px; color: #f0883e;">${(alarm.sharp_score || 0).toFixed(2)}</span></div>
                    <div class="detail-row"><span class="detail-label">min_sharp_score</span><span class="detail-value">${alarm.min_sharp_score || 0}</span></div>
                    <div class="detail-row"><span class="detail-label">Durum</span><span class="detail-value" style="color: ${alarm.triggered ? '#3fb950' : '#f85149'};">${alarm.triggered ? 'TETIKLENDI' : 'Tetiklenmedi'}</span></div>
                </div>
            `;

            modal.style.display = 'flex';
        }

        function closeAlarmModal() {
            document.getElementById('alarmDetailModal').style.display = 'none';
        }

        if (location.hash === '#sharp' || new URLSearchParams(location.search).get('page') === 'sharp') {
            setTimeout(() => {
                showPage('sharp');
                loadSharpConfig();
                loadAlarms();
            }, 100);
        }
    </script>
</body>
</html>
