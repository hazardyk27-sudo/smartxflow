<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartXFlow Admin Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0d1117;
            color: #c9d1d9;
            min-height: 100vh;
            display: flex;
        }
        .sidebar {
            width: 260px;
            background: #161b22;
            border-right: 1px solid #30363d;
            min-height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            display: flex;
            flex-direction: column;
        }
        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #30363d;
        }
        .sidebar-header h1 {
            color: #58a6ff;
            font-size: 18px;
            font-weight: 600;
        }
        .sidebar-header span {
            color: #8b949e;
            font-size: 11px;
        }
        .sidebar-nav {
            flex: 1;
            padding: 12px 0;
        }
        .nav-category {
            padding: 8px 20px;
            color: #8b949e;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .nav-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            color: #c9d1d9;
            text-decoration: none;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }
        .nav-item:hover {
            background: #21262d;
        }
        .nav-item.active {
            background: #1c2128;
            border-left-color: #58a6ff;
            color: #58a6ff;
        }
        .nav-item-icon {
            font-size: 16px;
            width: 20px;
            text-align: center;
        }
        .sidebar-footer {
            padding: 16px 20px;
            border-top: 1px solid #30363d;
        }
        .back-home {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #8b949e;
            text-decoration: none;
            font-size: 13px;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.2s;
        }
        .back-home:hover {
            background: #21262d;
            color: #58a6ff;
        }
        .main-content {
            margin-left: 260px;
            flex: 1;
            padding: 24px;
            min-height: 100vh;
        }
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid #30363d;
        }
        .page-title {
            color: #f0883e;
            font-size: 22px;
            font-weight: 600;
        }
        .page-subtitle {
            color: #8b949e;
            font-size: 13px;
            margin-top: 4px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        .stat-card {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }
        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #58a6ff;
            margin-bottom: 4px;
        }
        .stat-label {
            color: #8b949e;
            font-size: 13px;
        }
        .stat-value.green { color: #3fb950; }
        .stat-value.orange { color: #f0883e; }
        .stat-value.red { color: #f85149; }
        .info-card {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 16px;
        }
        .info-card h3 {
            color: #58a6ff;
            font-size: 16px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #21262d;
        }
        .info-row:last-child {
            border-bottom: none;
        }
        .info-label {
            color: #8b949e;
        }
        .info-value {
            color: #c9d1d9;
            font-weight: 500;
        }
        .info-value.success { color: #3fb950; }
        .info-value.warning { color: #f0883e; }
        .info-value.error { color: #f85149; }
        .page-content {
            display: none;
        }
        .page-content.active {
            display: block;
        }
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-size: 14px;
            z-index: 1000;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s;
        }
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        .toast.success { background: #238636; }
        .toast.error { background: #da3633; }
        .toast.info { background: #1f6feb; }
        .market-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }
        .market-table th,
        .market-table td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid #21262d;
        }
        .market-table th {
            color: #8b949e;
            font-weight: 500;
            font-size: 12px;
            text-transform: uppercase;
        }
        .market-table td {
            color: #c9d1d9;
        }
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }
        .badge.active { background: rgba(63, 185, 80, 0.2); color: #3fb950; }
        .badge.inactive { background: rgba(139, 148, 158, 0.2); color: #8b949e; }
        
        .header-actions {
            display: flex;
            gap: 10px;
        }
        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-primary { background: #238636; color: white; }
        .btn-primary:hover { background: #2ea043; }
        .btn-warning { background: #9e6a03; color: white; }
        .btn-warning:hover { background: #bb8009; }
        .btn-danger { background: #da3633; color: white; }
        .btn-danger:hover { background: #f85149; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 16px;
        }
        .form-group {
            margin-bottom: 16px;
        }
        .form-group label {
            display: block;
            color: #8b949e;
            font-size: 12px;
            margin-bottom: 6px;
        }
        .form-input {
            width: 100%;
            padding: 10px 12px;
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            color: #c9d1d9;
            font-size: 14px;
        }
        .form-input:focus {
            outline: none;
            border-color: #58a6ff;
        }
        .form-hint {
            color: #8b949e;
            font-size: 12px;
            margin-top: 8px;
        }
        
        .alarm-list {
            max-height: 400px;
            overflow-y: auto;
        }
        .alarm-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid #21262d;
            cursor: pointer;
            transition: background 0.2s;
        }
        .alarm-item:hover {
            background: #21262d;
        }
        .alarm-item:last-child {
            border-bottom: none;
        }
        .alarm-info {
            flex: 1;
        }
        .alarm-match {
            color: #c9d1d9;
            font-weight: 500;
        }
        .alarm-meta {
            color: #8b949e;
            font-size: 12px;
            margin-top: 4px;
        }
        .alarm-score {
            font-size: 18px;
            font-weight: 700;
            color: #f0883e;
            padding: 4px 12px;
            background: rgba(240, 136, 62, 0.15);
            border-radius: 6px;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 12px;
            width: 90%;
            max-width: 700px;
            max-height: 80vh;
            overflow: hidden;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid #30363d;
        }
        .modal-header h3 {
            color: #58a6ff;
            margin: 0;
        }
        .close-btn {
            background: none;
            border: none;
            color: #8b949e;
            font-size: 24px;
            cursor: pointer;
        }
        .close-btn:hover {
            color: #c9d1d9;
        }
        .modal-body {
            padding: 20px;
            overflow-y: auto;
            max-height: calc(80vh - 60px);
        }
        .detail-section {
            margin-bottom: 20px;
        }
        .detail-section h4 {
            color: #f0883e;
            font-size: 14px;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #21262d;
        }
        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
        }
        .detail-label {
            color: #8b949e;
            font-size: 13px;
        }
        .detail-value {
            color: #c9d1d9;
            font-size: 13px;
            font-weight: 500;
        }
        .detail-value.highlight {
            color: #3fb950;
        }
    </style>
</head>
<body>
    <aside class="sidebar">
        <div class="sidebar-header">
            <h1>SmartXFlow</h1>
            <span>Admin Panel</span>
        </div>
        <nav class="sidebar-nav">
            <div class="nav-category">Sistem</div>
            <div class="nav-item active" onclick="showPage('dashboard')" data-page="dashboard">
                <span class="nav-item-icon">üìä</span>
                <span>Dashboard</span>
            </div>
            <div class="nav-item" onclick="showPage('markets')" data-page="markets">
                <span class="nav-item-icon">üìà</span>
                <span>Market Durumu</span>
            </div>
            <div class="nav-item" onclick="showPage('system')" data-page="system">
                <span class="nav-item-icon">‚öôÔ∏è</span>
                <span>Sistem Bilgisi</span>
            </div>
            
            <div class="nav-category">Alarmlar</div>
            <div class="nav-item" onclick="showPage('sharp')" data-page="sharp">
                <span class="nav-item-icon">üéØ</span>
                <span>Sharp</span>
            </div>
            <div class="nav-item" onclick="showPage('insider')" data-page="insider">
                <span class="nav-item-icon">üïµÔ∏è</span>
                <span>Insider Info</span>
            </div>
            <div class="nav-item" onclick="showPage('bigmoney')" data-page="bigmoney">
                <span class="nav-item-icon">üí∞</span>
                <span>Big Money</span>
            </div>
        </nav>
        <div class="sidebar-footer">
            <a href="/" class="back-home">
                <span>‚Üê</span>
                <span>Ana Sayfaya Don</span>
            </a>
        </div>
    </aside>

    <main class="main-content">
        <div id="page-dashboard" class="page-content active">
            <div class="page-header">
                <div>
                    <h2 class="page-title">Dashboard</h2>
                    <p class="page-subtitle">Sistem durumu ve ozet bilgiler</p>
                </div>
            </div>

            <div class="stats-grid" id="dashboardStats">
                <div class="stat-card">
                    <div class="stat-value" id="totalMatches">-</div>
                    <div class="stat-label">Toplam Mac</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value green" id="activeMarkets">6</div>
                    <div class="stat-label">Aktif Market</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value orange" id="lastUpdate">-</div>
                    <div class="stat-label">Son Guncelleme</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="dbStatus">-</div>
                    <div class="stat-label">Supabase Durumu</div>
                </div>
            </div>

            <div class="info-card">
                <h3>üì° Baglanti Durumu</h3>
                <div class="info-row">
                    <span class="info-label">Supabase</span>
                    <span class="info-value success" id="supabaseStatus">Bagli</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Scraper Modu</span>
                    <span class="info-value" id="scraperMode">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Calisma Modu</span>
                    <span class="info-value" id="workMode">-</span>
                </div>
            </div>
        </div>

        <div id="page-markets" class="page-content">
            <div class="page-header">
                <div>
                    <h2 class="page-title">Market Durumu</h2>
                    <p class="page-subtitle">6 market icin veri durumu</p>
                </div>
            </div>

            <div class="info-card">
                <h3>üìä Market Verileri</h3>
                <table class="market-table">
                    <thead>
                        <tr>
                            <th>Market</th>
                            <th>Mac Sayisi</th>
                            <th>Durum</th>
                        </tr>
                    </thead>
                    <tbody id="marketTableBody">
                        <tr>
                            <td>Moneyway 1X2</td>
                            <td id="mw1x2Count">-</td>
                            <td><span class="badge active">Aktif</span></td>
                        </tr>
                        <tr>
                            <td>Moneyway O/U 2.5</td>
                            <td id="mwou25Count">-</td>
                            <td><span class="badge active">Aktif</span></td>
                        </tr>
                        <tr>
                            <td>Moneyway BTTS</td>
                            <td id="mwbttsCount">-</td>
                            <td><span class="badge active">Aktif</span></td>
                        </tr>
                        <tr>
                            <td>Dropping 1X2</td>
                            <td id="dp1x2Count">-</td>
                            <td><span class="badge active">Aktif</span></td>
                        </tr>
                        <tr>
                            <td>Dropping O/U 2.5</td>
                            <td id="dpou25Count">-</td>
                            <td><span class="badge active">Aktif</span></td>
                        </tr>
                        <tr>
                            <td>Dropping BTTS</td>
                            <td id="dpbttsCount">-</td>
                            <td><span class="badge active">Aktif</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="page-sharp" class="page-content">
            <div class="page-header">
                <div>
                    <h2 class="page-title">Sharp</h2>
                    <p class="page-subtitle">Sharp Money alarm ayarlari ve yonetimi</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-danger" onclick="deleteAllAlarms()">Tum Alarmlari Sil</button>
                    <button class="btn btn-warning" onclick="recalculateAlarms()">Alarmlari Yeniden Hesapla</button>
                    <button class="btn btn-primary" onclick="saveSharpConfig()">Kaydet</button>
                </div>
            </div>

            <div class="config-grid">
                <div class="info-card">
                    <h3>üìä Minimum Market Volume Esikleri</h3>
                    <div class="form-group">
                        <label>1X2 Minimum Volume</label>
                        <input type="number" id="min_volume_1x2" value="3000" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>O/U 2.5 Minimum Volume</label>
                        <input type="number" id="min_volume_ou25" value="1000" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>BTTS Minimum Volume</label>
                        <input type="number" id="min_volume_btts" value="500" class="form-input">
                    </div>
                    <div class="form-group" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #30363d;">
                        <label>üí∞ Gelen Para Volume (min)</label>
                        <input type="number" id="min_amount_change" value="500" class="form-input">
                        <p class="form-hint" style="font-size: 11px; color: #8b949e; margin-top: 4px;">Son snapshot'ta gelen para bu degerden dusukse sharp hesaplanmaz</p>
                    </div>
                </div>

                <div class="info-card">
                    <h3>‚úñÔ∏è Carpanlar</h3>
                    <div class="form-group">
                        <label>Hacim Carpani (volume_multiplier)</label>
                        <input type="number" id="volume_multiplier" value="1" step="0.1" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>Oran Carpani (odds_multiplier)</label>
                        <input type="number" id="odds_multiplier" value="1" step="0.1" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>Pay Carpani (share_multiplier)</label>
                        <input type="number" id="share_multiplier" value="1" step="0.1" class="form-input">
                    </div>
                </div>

                <div class="info-card">
                    <h3>üìà Maksimum Degerler (CAP)</h3>
                    <div class="form-group">
                        <label>Hacim Soku Maks (max_volume_cap)</label>
                        <input type="number" id="max_volume_cap" value="40" min="0" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>Oran Degisimi Maks (max_odds_cap)</label>
                        <input type="number" id="max_odds_cap" value="35" min="0" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>Pay Degisimi Maks (max_share_cap)</label>
                        <input type="number" id="max_share_cap" value="25" min="0" class="form-input">
                    </div>
                    <p class="form-hint">Her kriter bu degerle sinirlanir. Ornek: shock=50 ‚Üí cap=40 ise kullanilan=40</p>
                </div>

                <div class="info-card">
                    <h3>üéØ Esik Degerleri</h3>
                    <div class="form-group">
                        <label>Minimum Pay (min_share %)</label>
                        <input type="number" id="min_share" value="5" step="0.1" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>Minimum Sharp Skoru (min_sharp_score)</label>
                        <input type="number" id="min_sharp_score" value="10" step="0.1" class="form-input">
                    </div>
                </div>

            </div>

            <div class="info-card" style="margin-top: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="margin: 0;">üîî Sharp Alarmlar <span id="alarmCount" class="badge active">0</span></h3>
                    <div style="position: relative;">
                        <input type="text" id="alarmSearchInput" placeholder="Takim ara..." 
                               oninput="filterAlarms()" 
                               style="padding: 8px 12px 8px 32px; background: #21262d; border: 1px solid #30363d; border-radius: 6px; color: #e6edf3; font-size: 13px; width: 200px;">
                        <svg style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); stroke: #8b949e;" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
                        </svg>
                    </div>
                </div>
                <div id="calcStatus" style="display: none; padding: 15px; margin-bottom: 15px; background: #1c2128; border-radius: 8px; border-left: 4px solid #f0883e;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="spinner" style="width: 20px; height: 20px; border: 3px solid #30363d; border-top-color: #f0883e; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                        <span id="calcProgress" style="color: #f0883e; font-weight: 500;">Hesaplama devam ediyor...</span>
                    </div>
                </div>
                <div id="alarmList" class="alarm-list">
                    <p style="color: #8b949e; padding: 20px 0; text-align: center;">Henuz alarm yok. Ayarlari kaydedip "Alarmlari Yeniden Hesapla" butonuna basin.</p>
                </div>
            </div>
            <style>
                @keyframes spin { to { transform: rotate(360deg); } }
            </style>

            <div id="alarmDetailModal" class="modal" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Alarm Detaylari</h3>
                        <button class="close-btn" onclick="closeAlarmModal()">&times;</button>
                    </div>
                    <div class="modal-body" id="alarmDetailBody">
                    </div>
                </div>
            </div>
        </div>

        <!-- INSIDER INFO PAGE -->
        <div id="page-insider" class="page-content">
            <div class="page-header">
                <div>
                    <h2 class="page-title" style="color: #a371f7;">üïµÔ∏è Insider Info</h2>
                    <p class="page-subtitle">Dusuk hacim soku + yuksek oran dususu = Iceriden bilgi sezgisi</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-danger" onclick="deleteAllInsiderAlarms()">Tum Insider Alarmlari Sil</button>
                    <button class="btn" onclick="recalculateInsiderAlarms()" style="background: linear-gradient(135deg, #a371f7, #8b5cf6); color: white;">üïµÔ∏è Insider Hesapla</button>
                    <button class="btn btn-primary" onclick="saveInsiderConfig()">Kaydet</button>
                </div>
            </div>

            <div class="config-grid">
                <div class="info-card" style="border-left: 3px solid #a371f7;">
                    <h3>üïµÔ∏è Insider Info Alarm Ayarlari</h3>
                    <p class="form-hint" style="font-size: 12px; color: #8b949e; margin-bottom: 15px;">
                        Dusuk hacim soku + yuksek oran dususu + dusuk para girisi = Insider bilgisi suphesi<br>
                        <strong>Formul:</strong> HacimSok &lt; Esik VE OranDusus &gt;= Esik VE GelenPara &lt; MaxPara (X dakika boyunca)
                    </p>
                    <div class="form-group">
                        <label>Hacim Sok Esigi</label>
                        <input type="number" id="insider_hacim_sok_esigi" value="2" step="0.1" class="form-input">
                        <p class="form-hint" style="font-size: 10px; color: #8b949e;">Hacim soku bu degerden DUSUK olmali (ornek: 2x)</p>
                    </div>
                    <div class="form-group">
                        <label>Oran Dusus Esigi (%)</label>
                        <input type="number" id="insider_oran_dusus_esigi" value="3" step="0.1" class="form-input">
                        <p class="form-hint" style="font-size: 10px; color: #8b949e;">Oran dususu bu degere ESIT veya YUKSEK olmali</p>
                    </div>
                    <div class="form-group">
                        <label>Sure (Dakika)</label>
                        <input type="number" id="insider_sure_dakika" value="30" step="10" min="10" class="form-input">
                        <p class="form-hint" style="font-size: 10px; color: #8b949e;">Kosullar bu sure boyunca devam etmeli (ornek: 30dk = 3 ardisik snapshot)</p>
                    </div>
                    <div class="form-group">
                        <label>Max Para (¬£)</label>
                        <input type="number" id="insider_max_para" value="5000" step="500" class="form-input">
                        <p class="form-hint" style="font-size: 10px; color: #8b949e;">Gelen para miktari bu degerden DUSUK olmali</p>
                    </div>
                    <div class="form-group">
                        <label>Max Oran Esigi</label>
                        <input type="number" id="insider_max_odds_esigi" value="10.0" step="0.01" min="1.0" class="form-input" inputmode="decimal" lang="en">
                        <p class="form-hint" style="font-size: 10px; color: #8b949e;">Secenegin orani bu degerden YUKSEKSE elenir (ornek: 2.2)</p>
                    </div>
                </div>

                <div class="info-card">
                    <h3>üìñ Nasil Calisir?</h3>
                    <div style="font-size: 12px; color: #8b949e; line-height: 1.6;">
                        <p><strong>1. Rolling Window:</strong> Ardisik X snapshot icerisinde kosullar kontrol edilir</p>
                        <p><strong>2. HacimSok &lt; Esik:</strong> Buyuk para girisi olmamali</p>
                        <p><strong>3. OranDusus &gt;= Esik:</strong> Oranlar dusmus olmali</p>
                        <p><strong>4. GelenPara &lt; MaxPara:</strong> Az para girmis olmali</p>
                        <p style="margin-top: 10px; padding: 8px; background: #21262d; border-radius: 6px;">
                            <strong style="color: #a371f7;">Insider Sinyali:</strong> 30 dakika boyunca buyuk para girisi yok ama oranlar dusuyor = birileri bir seyler biliyor olabilir!
                        </p>
                    </div>
                </div>
            </div>

            <div class="info-card" style="margin-top: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="margin: 0; color: #a371f7;">üïµÔ∏è Insider Alarmlar <span id="insiderAlarmCount" class="badge" style="background: #a371f7;">0</span></h3>
                    <div style="position: relative;">
                        <input type="text" id="insiderSearchInput" placeholder="Takim ara..." 
                               oninput="filterInsiderAlarms()" 
                               style="padding: 8px 12px 8px 32px; background: #21262d; border: 1px solid #30363d; border-radius: 6px; color: #e6edf3; font-size: 13px; width: 200px;">
                        <svg style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); stroke: #8b949e;" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
                        </svg>
                    </div>
                </div>
                <div id="insiderCalcStatus" style="display: none; padding: 15px; margin-bottom: 15px; background: #1c2128; border-radius: 8px; border-left: 4px solid #a371f7;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="spinner" style="width: 20px; height: 20px; border: 3px solid #30363d; border-top-color: #a371f7; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                        <span id="insiderCalcProgress" style="color: #a371f7; font-weight: 500;">Hesaplama devam ediyor...</span>
                    </div>
                </div>
                <div id="insiderAlarmList" class="alarm-list">
                    <p style="color: #8b949e; padding: 20px 0; text-align: center;">Henuz Insider alarm yok. "üïµÔ∏è Insider Hesapla" butonuna basin.</p>
                </div>
            </div>
        </div>

        <!-- BIG MONEY PAGE -->
        <div id="page-bigmoney" class="page-content">
            <div class="page-header">
                <div>
                    <h2 class="page-title" style="color: #f0b429;">üí∞ Big Money</h2>
                    <p class="page-subtitle">Buyuk para girislerini tespit et</p>
                </div>
            </div>

            <div class="grid-two-col">
                <div class="info-card">
                    <h3>üí∞ Big Money Alarm Ayarlari</h3>
                    <div class="info-row">
                        <span class="info-label">Gelen Para Limiti (¬£)</span>
                        <input type="number" id="bigMoneyLimit" class="config-input" value="15000" min="1000" step="1000" style="width: 100px;">
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="saveBigMoneyConfig()" style="background: #f0b429;">
                            <span class="btn-icon">üíæ</span> Kaydet
                        </button>
                        <button class="btn btn-success" onclick="calculateBigMoney()" style="background: #238636;">
                            <span class="btn-icon">üí∞</span> Big Money Hesapla
                        </button>
                        <button class="btn btn-danger" onclick="deleteBigMoneyAlarms()" style="background: #da3633;">
                            <span class="btn-icon">üóëÔ∏è</span> Alarmlari Sil
                        </button>
                    </div>
                </div>

                <div class="info-card">
                    <h3>üìñ Nasil Calisir?</h3>
                    <div style="font-size: 12px; color: #8b949e; line-height: 1.6;">
                        <p><strong style="color: #f0b429;">üí∞ BIG MONEY:</strong> Tek snapshot'ta bir secenege ¬£15,000+ para girisi</p>
                        <p><strong style="color: #ff7b00;">üî• HUGE MONEY:</strong> 2 ardisik snapshot'ta ¬£15,000+ para girisi</p>
                        <p style="margin-top: 10px; padding: 8px; background: #21262d; border-radius: 6px;">
                            <strong style="color: #f0b429;">Sinyal:</strong> Buyuk oyuncular (sharps, syndicates) pozisyon aliyor olabilir!
                        </p>
                    </div>
                </div>
            </div>

            <div class="info-card" style="margin-top: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="margin: 0; color: #f0b429;">üí∞ Big Money Alarmlar <span id="bigMoneyAlarmCount" class="badge" style="background: #f0b429;">0</span></h3>
                    <div style="position: relative;">
                        <input type="text" id="bigMoneySearchInput" placeholder="Takim ara..." 
                               oninput="filterBigMoneyAlarms()" 
                               style="padding: 8px 12px 8px 32px; background: #21262d; border: 1px solid #30363d; border-radius: 6px; color: #e6edf3; font-size: 13px; width: 200px;">
                        <svg style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); stroke: #8b949e;" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
                        </svg>
                    </div>
                </div>
                <div id="bigMoneyCalcStatus" style="display: none; padding: 15px; margin-bottom: 15px; background: #1c2128; border-radius: 8px; border-left: 4px solid #f0b429;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="spinner" style="width: 20px; height: 20px; border: 3px solid #30363d; border-top-color: #f0b429; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                        <span id="bigMoneyCalcProgress" style="color: #f0b429; font-weight: 500;">Hesaplama devam ediyor...</span>
                    </div>
                </div>
                <div id="bigMoneyAlarmList" class="alarm-list">
                    <p style="color: #8b949e; padding: 20px 0; text-align: center;">Henuz Big Money alarm yok. "üí∞ Big Money Hesapla" butonuna basin.</p>
                </div>
            </div>
        </div>

        <div id="page-system" class="page-content">
            <div class="page-header">
                <div>
                    <h2 class="page-title">Sistem Bilgisi</h2>
                    <p class="page-subtitle">Teknik detaylar ve konfigurasyonlar</p>
                </div>
            </div>

            <div class="info-card">
                <h3>üñ•Ô∏è Uygulama Bilgileri</h3>
                <div class="info-row">
                    <span class="info-label">Uygulama</span>
                    <span class="info-value">SmartXFlow Monitor</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Versiyon</span>
                    <span class="info-value">1.0</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Timezone</span>
                    <span class="info-value">Europe/Istanbul (TR)</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Scrape Araligi</span>
                    <span class="info-value">10 dakika</span>
                </div>
            </div>

            <div class="info-card">
                <h3>üóÑÔ∏è Veritabani</h3>
                <div class="info-row">
                    <span class="info-label">Provider</span>
                    <span class="info-value">Supabase (PostgreSQL)</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Baglanti</span>
                    <span class="info-value success" id="dbConnection">Aktif</span>
                </div>
            </div>

            <div class="info-card">
                <h3>üìã Veri Kaynaklari</h3>
                <div class="info-row">
                    <span class="info-label">Moneyway</span>
                    <span class="info-value">arbworld.net</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Dropping Odds</span>
                    <span class="info-value">arbworld.net</span>
                </div>
            </div>
        </div>
    </main>

    <div class="toast" id="toast"></div>

    <script>
        function showPage(pageId) {
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
            });
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            document.getElementById('page-' + pageId).classList.add('active');
            document.querySelector(`[data-page="${pageId}"]`).classList.add('active');

            if (pageId === 'dashboard') loadDashboard();
            if (pageId === 'markets') loadMarkets();
            if (pageId === 'sharp') loadSharpAlarms();
            if (pageId === 'insider') loadInsiderPage();
            if (pageId === 'bigmoney') loadBigMoneyPage();
        }

        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast ' + type + ' show';
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        async function loadDashboard() {
            console.log('[Admin] loadDashboard started');
            try {
                const response = await fetch('/api/status?t=' + Date.now());
                console.log('[Admin] Status response:', response.ok);
                if (response.ok) {
                    const data = await response.json();
                    console.log('[Admin] Status data:', data);
                    
                    const lastUpdateEl = document.getElementById('lastUpdate');
                    const supabaseStatusEl = document.getElementById('supabaseStatus');
                    const scraperModeEl = document.getElementById('scraperMode');
                    const workModeEl = document.getElementById('workMode');
                    const dbStatusEl = document.getElementById('dbStatus');
                    
                    if (lastUpdateEl) lastUpdateEl.textContent = data.last_data_update_tr || '-';
                    if (supabaseStatusEl) {
                        supabaseStatusEl.textContent = data.supabase_connected ? 'Bagli' : 'Bagli Degil';
                        supabaseStatusEl.className = 'info-value ' + (data.supabase_connected ? 'success' : 'error');
                    }
                    if (scraperModeEl) scraperModeEl.textContent = data.scraping_enabled ? 'Aktif' : 'Devre Disi';
                    if (workModeEl) workModeEl.textContent = data.mode || 'server';
                    if (dbStatusEl) {
                        dbStatusEl.textContent = data.supabase_connected ? 'OK' : 'Hata';
                        dbStatusEl.className = 'stat-value ' + (data.supabase_connected ? 'green' : 'red');
                    }
                }
            } catch (error) {
                console.error('[Admin] Dashboard yukleme hatasi:', error);
            }

            try {
                const response = await fetch('/api/matches?market=moneyway_1x2&t=' + Date.now());
                console.log('[Admin] Matches response:', response.ok);
                if (response.ok) {
                    const data = await response.json();
                    console.log('[Admin] Matches count:', Array.isArray(data) ? data.length : 0);
                    const totalMatchesEl = document.getElementById('totalMatches');
                    if (totalMatchesEl) totalMatchesEl.textContent = Array.isArray(data) ? data.length : 0;
                }
            } catch (error) {
                console.error('[Admin] Mac sayisi yukleme hatasi:', error);
            }
        }

        async function loadMarkets() {
            const markets = [
                { id: 'mw1x2Count', market: 'moneyway_1x2' },
                { id: 'mwou25Count', market: 'moneyway_ou25' },
                { id: 'mwbttsCount', market: 'moneyway_btts' },
                { id: 'dp1x2Count', market: 'dropping_1x2' },
                { id: 'dpou25Count', market: 'dropping_ou25' },
                { id: 'dpbttsCount', market: 'dropping_btts' }
            ];

            for (const m of markets) {
                try {
                    const response = await fetch(`/api/matches?market=${m.market}`);
                    if (response.ok) {
                        const data = await response.json();
                        document.getElementById(m.id).textContent = Array.isArray(data) ? data.length : 0;
                    }
                } catch (error) {
                    document.getElementById(m.id).textContent = 'Hata';
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadDashboard();
            loadAlarms();
            loadSharpConfig();
        });

        function getSharpConfig() {
            return {
                min_volume_1x2: parseInt(document.getElementById('min_volume_1x2').value) || 3000,
                min_volume_ou25: parseInt(document.getElementById('min_volume_ou25').value) || 1000,
                min_volume_btts: parseInt(document.getElementById('min_volume_btts').value) || 500,
                min_amount_change: parseInt(document.getElementById('min_amount_change').value) || 500,
                volume_multiplier: parseFloat(document.getElementById('volume_multiplier').value) || 1,
                odds_multiplier: parseFloat(document.getElementById('odds_multiplier').value) || 1,
                share_multiplier: parseFloat(document.getElementById('share_multiplier').value) || 1,
                max_volume_cap: parseFloat(document.getElementById('max_volume_cap').value) || 40,
                max_odds_cap: parseFloat(document.getElementById('max_odds_cap').value) || 35,
                max_share_cap: parseFloat(document.getElementById('max_share_cap').value) || 25,
                min_share: parseFloat(document.getElementById('min_share').value) || 5,
                min_sharp_score: parseFloat(document.getElementById('min_sharp_score').value) || 10
            };
        }

        function setSharpConfig(config) {
            if (!config) return;
            document.getElementById('min_volume_1x2').value = config.min_volume_1x2 || 3000;
            document.getElementById('min_volume_ou25').value = config.min_volume_ou25 || 1000;
            document.getElementById('min_volume_btts').value = config.min_volume_btts || 500;
            document.getElementById('min_amount_change').value = config.min_amount_change || 500;
            document.getElementById('volume_multiplier').value = config.volume_multiplier || 1;
            document.getElementById('odds_multiplier').value = config.odds_multiplier || 1;
            document.getElementById('share_multiplier').value = config.share_multiplier || 1;
            document.getElementById('max_volume_cap').value = config.max_volume_cap || 40;
            document.getElementById('max_odds_cap').value = config.max_odds_cap || 35;
            document.getElementById('max_share_cap').value = config.max_share_cap || 25;
            document.getElementById('min_share').value = config.min_share || 5;
            document.getElementById('min_sharp_score').value = config.min_sharp_score || 10;
        }

        async function saveSharpConfig() {
            const config = getSharpConfig();
            try {
                const response = await fetch('/api/sharp/config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });
                if (response.ok) {
                    showToast('Ayarlar kaydedildi!', 'success');
                } else {
                    showToast('Kaydetme hatasi!', 'error');
                }
            } catch (error) {
                showToast('Baglanti hatasi!', 'error');
            }
        }

        async function loadSharpConfig() {
            try {
                const response = await fetch('/api/sharp/config');
                if (response.ok) {
                    const config = await response.json();
                    setSharpConfig(config);
                }
            } catch (error) {
                console.error('Config yukleme hatasi:', error);
            }
        }

        async function deleteAllAlarms() {
            if (!confirm('Tum Sharp alarmlarini silmek istediginizden emin misiniz?')) return;
            try {
                const response = await fetch('/api/sharp/alarms', { method: 'DELETE' });
                if (response.ok) {
                    showToast('Tum alarmlar silindi!', 'success');
                    loadAlarms();
                } else {
                    showToast('Silme hatasi!', 'error');
                }
            } catch (error) {
                showToast('Baglanti hatasi!', 'error');
            }
        }

        let calcStatusInterval = null;

        async function recalculateAlarms() {
            showToast('Alarmlar hesaplaniyor...', 'info');
            showCalcStatus(true, 'Hesaplama baslatiliyor...');
            
            try {
                startCalcStatusCheck();
                
                const response = await fetch('/api/sharp/calculate', { method: 'POST' });
                
                stopCalcStatusCheck();
                
                if (response.ok) {
                    const result = await response.json();
                    showCalcStatus(false, `Tamamlandi! ${result.count || 0} alarm bulundu.`);
                    showToast(`${result.count || 0} alarm uretildi!`, 'success');
                    loadAlarms();
                    
                    setTimeout(() => hideCalcStatus(), 3000);
                } else {
                    showCalcStatus(false, 'Hesaplama hatasi!');
                    showToast('Hesaplama hatasi!', 'error');
                }
            } catch (error) {
                stopCalcStatusCheck();
                showCalcStatus(false, 'Baglanti hatasi!');
                showToast('Baglanti hatasi!', 'error');
            }
        }

        async function recalculateInsiderAlarms() {
            showToast('Insider alarmlar hesaplaniyor...', 'info');
            showInsiderCalcStatus(true, 'Insider alarm hesaplama baslatiliyor...');
            
            try {
                const response = await fetch('/api/insider/calculate', { method: 'POST' });
                
                if (response.ok) {
                    const result = await response.json();
                    showInsiderCalcStatus(false, `Tamamlandi! ${result.count || 0} Insider alarm bulundu.`);
                    showToast(`${result.count || 0} Insider alarm uretildi!`, 'success');
                    loadInsiderAlarms();
                    
                    setTimeout(() => hideInsiderCalcStatus(), 3000);
                } else {
                    showInsiderCalcStatus(false, 'Insider hesaplama hatasi!');
                    showToast('Insider hesaplama hatasi!', 'error');
                }
            } catch (error) {
                showInsiderCalcStatus(false, 'Baglanti hatasi!');
                showToast('Baglanti hatasi!', 'error');
            }
        }

        function showInsiderCalcStatus(isCalculating, message) {
            const statusEl = document.getElementById('insiderCalcStatus');
            const progressEl = document.getElementById('insiderCalcProgress');
            const spinnerEl = statusEl.querySelector('.spinner');
            
            statusEl.style.display = 'block';
            progressEl.textContent = message;
            
            if (isCalculating) {
                spinnerEl.style.display = 'block';
                progressEl.style.color = '#a371f7';
                statusEl.style.borderLeftColor = '#a371f7';
            } else {
                spinnerEl.style.display = 'none';
                progressEl.style.color = '#3fb950';
                statusEl.style.borderLeftColor = '#3fb950';
            }
        }

        function hideInsiderCalcStatus() {
            const statusEl = document.getElementById('insiderCalcStatus');
            statusEl.style.display = 'none';
        }

        function showCalcStatus(isCalculating, message) {
            const statusEl = document.getElementById('calcStatus');
            const progressEl = document.getElementById('calcProgress');
            const spinnerEl = statusEl.querySelector('.spinner');
            
            statusEl.style.display = 'block';
            progressEl.textContent = message;
            
            if (isCalculating) {
                spinnerEl.style.display = 'block';
                progressEl.style.color = '#f0883e';
                statusEl.style.borderLeftColor = '#f0883e';
            } else {
                spinnerEl.style.display = 'none';
                progressEl.style.color = '#3fb950';
                statusEl.style.borderLeftColor = '#3fb950';
            }
        }

        function hideCalcStatus() {
            document.getElementById('calcStatus').style.display = 'none';
        }

        function startCalcStatusCheck() {
            calcStatusInterval = setInterval(async () => {
                try {
                    const response = await fetch('/api/sharp/status');
                    if (response.ok) {
                        const status = await response.json();
                        if (status.calculating) {
                            showCalcStatus(true, status.progress || 'Hesaplama devam ediyor...');
                        }
                    }
                } catch (e) {}
            }, 1000);
        }

        function stopCalcStatusCheck() {
            if (calcStatusInterval) {
                clearInterval(calcStatusInterval);
                calcStatusInterval = null;
            }
        }

        let allAlarms = [];
        
        async function loadSharpAlarms() {
            try {
                const response = await fetch('/api/sharp/alarms');
                if (response.ok) {
                    const alarms = await response.json();
                    allAlarms = alarms;
                    renderSharpAlarms(alarms);
                }
            } catch (error) {
                console.error('Sharp alarm yukleme hatasi:', error);
            }
        }

        function loadAlarms() {
            loadSharpAlarms();
        }

        function filterAlarms() {
            const searchTerm = document.getElementById('alarmSearchInput').value.toLowerCase().trim();
            if (!searchTerm) {
                renderAlarms(allAlarms);
                return;
            }
            const filtered = allAlarms.filter(alarm => 
                (alarm.home || '').toLowerCase().includes(searchTerm) ||
                (alarm.away || '').toLowerCase().includes(searchTerm)
            );
            renderAlarms(filtered, allAlarms.length);
        }

        function renderSharpAlarms(alarms, totalCount = null) {
            const container = document.getElementById('alarmList');
            const countEl = document.getElementById('alarmCount');
            
            if (!alarms || alarms.length === 0) {
                const searchTerm = document.getElementById('alarmSearchInput')?.value || '';
                if (searchTerm) {
                    container.innerHTML = '<p style="color: #8b949e; padding: 20px 0; text-align: center;">Aramayla eslesen alarm yok.</p>';
                    countEl.textContent = `0/${totalCount || 0}`;
                } else {
                    container.innerHTML = '<p style="color: #8b949e; padding: 20px 0; text-align: center;">Henuz alarm yok.</p>';
                    countEl.textContent = '0';
                }
                return;
            }

            countEl.textContent = totalCount ? `${alarms.length}/${totalCount}` : alarms.length;
            container.innerHTML = alarms.map((alarm, idx) => `
                <div class="alarm-item" onclick="showAlarmDetail(${idx})">
                    <div class="alarm-info">
                        <div class="alarm-match">${alarm.home} vs ${alarm.away}</div>
                        <div class="alarm-meta">${alarm.market} | ${alarm.selection} | ${alarm.created_at || ''}</div>
                        <div class="alarm-breakdown" style="display: flex; gap: 12px; margin-top: 6px; font-size: 11px;">
                            <span style="color: #f0883e;" title="Hacim Soku">‚ö° ${(alarm.shock_value || 0).toFixed(1)}</span>
                            <span style="color: #58a6ff;" title="Oran Degisimi">üìâ ${(alarm.odds_value || 0).toFixed(1)}</span>
                            <span style="color: #3fb950;" title="Pay Degisimi">üìä ${(alarm.share_value || 0).toFixed(1)}</span>
                        </div>
                    </div>
                    <div class="alarm-score">${(alarm.sharp_score || 0).toFixed(1)}</div>
                </div>
            `).join('');

            window.currentAlarms = alarms;
        }

        function renderAlarms(alarms, totalCount = null) {
            renderSharpAlarms(alarms, totalCount);
        }

        // ==================== INSIDER INFO FUNCTIONS ====================
        let allInsiderAlarms = [];

        async function loadInsiderPage() {
            await loadInsiderConfig();
            await loadInsiderAlarms();
        }

        async function loadInsiderConfig() {
            try {
                const response = await fetch('/api/sharp/config');
                if (response.ok) {
                    const config = await response.json();
                    document.getElementById('insider_hacim_sok_esigi').value = config.insider_hacim_sok_esigi || 2;
                    document.getElementById('insider_oran_dusus_esigi').value = config.insider_oran_dusus_esigi || 3;
                    document.getElementById('insider_sure_dakika').value = config.insider_sure_dakika || 30;
                    document.getElementById('insider_max_para').value = config.insider_max_para || 5000;
                    document.getElementById('insider_max_odds_esigi').value = config.insider_max_odds_esigi || 10.0;
                }
            } catch (error) {
                console.error('Insider config yukleme hatasi:', error);
            }
        }

        async function loadInsiderAlarms() {
            try {
                const response = await fetch('/api/insider/alarms');
                if (response.ok) {
                    const alarms = await response.json();
                    allInsiderAlarms = alarms;
                    renderInsiderAlarms(alarms);
                }
            } catch (error) {
                console.error('Insider alarm yukleme hatasi:', error);
            }
        }

        function renderInsiderAlarms(alarms, totalCount = null) {
            const container = document.getElementById('insiderAlarmList');
            const countEl = document.getElementById('insiderAlarmCount');
            
            if (!alarms || alarms.length === 0) {
                const searchTerm = document.getElementById('insiderSearchInput')?.value || '';
                if (searchTerm) {
                    container.innerHTML = '<p style="color: #8b949e; padding: 20px 0; text-align: center;">Aramayla eslesen Insider alarm yok.</p>';
                    countEl.textContent = `0/${totalCount || 0}`;
                } else {
                    container.innerHTML = '<p style="color: #8b949e; padding: 20px 0; text-align: center;">Henuz Insider alarm yok. "üïµÔ∏è Insider Hesapla" butonuna basin.</p>';
                    countEl.textContent = '0';
                }
                return;
            }

            countEl.textContent = totalCount ? `${alarms.length}/${totalCount}` : alarms.length;
            container.innerHTML = alarms.map((alarm, idx) => `
                <div class="alarm-item" onclick="showInsiderAlarmDetail(${idx})" style="border-left: 3px solid #a371f7;">
                    <div class="alarm-info">
                        <div class="alarm-match">
                            <span style="background:#a371f7;color:#fff;padding:2px 6px;border-radius:4px;font-size:10px;margin-right:8px;">üïµÔ∏è INSIDER</span>
                            ${alarm.home} vs ${alarm.away}
                        </div>
                        <div class="alarm-meta">${alarm.market} | ${alarm.selection} | ${alarm.created_at || ''}</div>
                        <div class="alarm-breakdown" style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 6px; font-size: 11px;">
                            <span style="color: #f0883e;" title="Hacim Soku">‚ö° HacimSok &lt; ${alarm.insider_hacim_sok_esigi || 2}: ${(alarm.hacim_sok || 0).toFixed(2)}x</span>
                            <span style="color: #a371f7;" title="Oran Dususu">üìâ OranDusus ‚â• ${alarm.insider_oran_dusus_esigi || 3}%: ${(alarm.oran_dusus_pct || 0).toFixed(1)}%</span>
                            <span style="color: #58a6ff;" title="Gelen Para">üí∞ GelenPara &lt; ¬£${alarm.insider_max_para || 5000}: ¬£${Math.round(alarm.gelen_para || 0).toLocaleString()}</span>
                            <span style="color: #f0b429;" title="Son Oran">üéØ Oran ‚â§ ${alarm.insider_max_odds_esigi || 10}: ${(alarm.last_odds || 0).toFixed(2)}</span>
                            <span style="color: #3fb950;" title="Sure">‚è±Ô∏è ${alarm.insider_sure_dakika || 30}dk (${alarm.snapshot_count || 3} snapshot)</span>
                        </div>
                    </div>
                    <div class="alarm-score" style="background: linear-gradient(135deg, #a371f7, #8b5cf6);">üïµÔ∏è</div>
                </div>
            `).join('');

            window.currentInsiderAlarms = alarms;
        }

        function filterInsiderAlarms() {
            const searchTerm = document.getElementById('insiderSearchInput').value.toLowerCase().trim();
            if (!searchTerm) {
                renderInsiderAlarms(allInsiderAlarms);
                return;
            }
            const filtered = allInsiderAlarms.filter(alarm => 
                (alarm.home || '').toLowerCase().includes(searchTerm) ||
                (alarm.away || '').toLowerCase().includes(searchTerm)
            );
            renderInsiderAlarms(filtered, allInsiderAlarms.length);
        }

        async function saveInsiderConfig() {
            const config = {
                insider_hacim_sok_esigi: parseFloat(document.getElementById('insider_hacim_sok_esigi').value) || 2,
                insider_oran_dusus_esigi: parseFloat(document.getElementById('insider_oran_dusus_esigi').value) || 3,
                insider_sure_dakika: parseInt(document.getElementById('insider_sure_dakika').value) || 30,
                insider_max_para: parseFloat(document.getElementById('insider_max_para').value) || 5000,
                insider_max_odds_esigi: parseFloat(document.getElementById('insider_max_odds_esigi').value) || 10.0
            };
            
            try {
                const response = await fetch('/api/sharp/config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });
                if (response.ok) {
                    showToast('Insider ayarlari kaydedildi!', 'success');
                } else {
                    showToast('Kayit hatasi!', 'error');
                }
            } catch (error) {
                showToast('Baglanti hatasi!', 'error');
            }
        }

        async function deleteAllInsiderAlarms() {
            if (!confirm('Tum Insider alarmlari silinecek. Emin misiniz?')) return;
            
            try {
                const response = await fetch('/api/insider/delete', { method: 'POST' });
                if (response.ok) {
                    showToast('Tum Insider alarmlar silindi!', 'success');
                    loadInsiderAlarms();
                } else {
                    showToast('Silme hatasi!', 'error');
                }
            } catch (error) {
                showToast('Baglanti hatasi!', 'error');
            }
        }

        function showInsiderAlarmDetail(idx) {
            const alarm = window.currentInsiderAlarms[idx];
            if (!alarm) return;

            const modal = document.getElementById('alarmDetailModal');
            const body = document.getElementById('alarmDetailBody');

            body.innerHTML = `
                <div class="detail-section">
                    <h4 style="color: #a371f7;">üïµÔ∏è Insider Info Alarm Detaylari</h4>
                    <div class="detail-row"><span class="detail-label">Mac</span><span class="detail-value">${alarm.home} vs ${alarm.away}</span></div>
                    <div class="detail-row"><span class="detail-label">Market</span><span class="detail-value">${alarm.market}</span></div>
                    <div class="detail-row"><span class="detail-label">Secenek</span><span class="detail-value">${alarm.selection}</span></div>
                    <div class="detail-row"><span class="detail-label">Mac Tarihi</span><span class="detail-value" style="color: #58a6ff;">${alarm.match_date || '-'}</span></div>
                    <div class="detail-row"><span class="detail-label">Hesaplama Tarihi</span><span class="detail-value">${alarm.created_at || '-'}</span></div>
                </div>
                <div class="detail-section">
                    <h4>üìä Oran Bilgileri</h4>
                    <div class="detail-row"><span class="detail-label">Opening Odds (Acilis)</span><span class="detail-value">${alarm.opening_odds || '-'}</span></div>
                    <div class="detail-row"><span class="detail-label">Last Odds (Son)</span><span class="detail-value">${alarm.last_odds || '-'}</span></div>
                    <div class="detail-row"><span class="detail-label">Oran Dususu (maks)</span><span class="detail-value highlight" style="color: #a371f7;">${(alarm.oran_dusus_pct || 0).toFixed(2)}%</span></div>
                </div>
                <div class="detail-section">
                    <h4>‚ö° Hacim Soku & Para</h4>
                    <div class="detail-row"><span class="detail-label">Ortalama Hacim Soku</span><span class="detail-value">${(alarm.hacim_sok || 0).toFixed(2)}x</span></div>
                    <div class="detail-row"><span class="detail-label">Hacim Sok Esigi</span><span class="detail-value">&lt; ${alarm.insider_hacim_sok_esigi || 2}x</span></div>
                    <div class="detail-row"><span class="detail-label">Ortalama Gelen Para</span><span class="detail-value">¬£${Math.round(alarm.gelen_para || 0).toLocaleString()}</span></div>
                    <div class="detail-row"><span class="detail-label">Max Para Esigi</span><span class="detail-value">&lt; ¬£${alarm.insider_max_para || 5000}</span></div>
                    <div class="detail-row"><span class="detail-label">Son Oran</span><span class="detail-value" style="color: #f0b429;">${(alarm.last_odds || 0).toFixed(2)}</span></div>
                    <div class="detail-row"><span class="detail-label">Max Oran Esigi</span><span class="detail-value">‚â§ ${alarm.insider_max_odds_esigi || 10}</span></div>
                </div>
                <div class="detail-section">
                    <h4>‚è±Ô∏è Sure & Snapshot</h4>
                    <div class="detail-row"><span class="detail-label">Gerekli Sure</span><span class="detail-value">${alarm.insider_sure_dakika || 30} dakika</span></div>
                    <div class="detail-row"><span class="detail-label">Ardisik Snapshot</span><span class="detail-value">${alarm.snapshot_count || 3} snapshot</span></div>
                </div>
                <div class="detail-section">
                    <h4 style="color: #a371f7;">üïµÔ∏è Insider Sinyali</h4>
                    <p style="font-size: 12px; color: #8b949e; line-height: 1.6;">
                        Bu macta ${alarm.insider_sure_dakika || 30} dakika boyunca (${alarm.snapshot_count || 3} ardisik snapshot):
                        <br>‚Ä¢ Hacim Soku ${(alarm.hacim_sok || 0).toFixed(2)}x < ${alarm.insider_hacim_sok_esigi || 2}x (dusuk)
                        <br>‚Ä¢ Oran Dususu ${(alarm.oran_dusus_pct || 0).toFixed(1)}% >= ${alarm.insider_oran_dusus_esigi || 3}% (yuksek)
                        <br>‚Ä¢ Gelen Para ¬£${Math.round(alarm.gelen_para || 0).toLocaleString()} < ¬£${alarm.insider_max_para || 5000} (dusuk)
                        <br><br>
                        <strong style="color: #a371f7;">Sonuc:</strong> Buyuk para girisi olmadan oranlar dusuyor = birileri bir seyler biliyor olabilir!
                    </p>
                </div>
            `;
            modal.style.display = 'flex';
        }

        // ==================== BIG MONEY FUNCTIONS ====================
        let allBigMoneyAlarms = [];

        async function loadBigMoneyPage() {
            await loadBigMoneyConfig();
            await loadBigMoneyAlarms();
        }

        async function loadBigMoneyConfig() {
            try {
                const response = await fetch('/api/bigmoney/config');
                if (response.ok) {
                    const config = await response.json();
                    document.getElementById('bigMoneyLimit').value = config.big_money_limit || 15000;
                }
            } catch (error) {
                console.error('Big Money config yukleme hatasi:', error);
            }
        }

        async function loadBigMoneyAlarms() {
            try {
                const response = await fetch('/api/bigmoney/alarms');
                if (response.ok) {
                    const alarms = await response.json();
                    allBigMoneyAlarms = alarms;
                    renderBigMoneyAlarms(alarms);
                }
            } catch (error) {
                console.error('Big Money alarm yukleme hatasi:', error);
            }
        }

        function renderBigMoneyAlarms(alarms, totalCount = null) {
            const container = document.getElementById('bigMoneyAlarmList');
            const countEl = document.getElementById('bigMoneyAlarmCount');
            
            if (!alarms || alarms.length === 0) {
                const searchTerm = document.getElementById('bigMoneySearchInput')?.value || '';
                if (searchTerm) {
                    container.innerHTML = '<p style="color: #8b949e; padding: 20px 0; text-align: center;">Aramayla eslesen Big Money alarm yok.</p>';
                    countEl.textContent = `0/${totalCount || 0}`;
                } else {
                    container.innerHTML = '<p style="color: #8b949e; padding: 20px 0; text-align: center;">Henuz Big Money alarm yok. "üí∞ Big Money Hesapla" butonuna basin.</p>';
                    countEl.textContent = '0';
                }
                return;
            }

            countEl.textContent = totalCount ? `${alarms.length}/${totalCount}` : alarms.length;
            container.innerHTML = alarms.map((alarm, idx) => {
                const isHuge = alarm.is_huge;
                const bgColor = isHuge ? '#ff7b00' : '#f0b429';
                const icon = isHuge ? 'üî•' : 'üí∞';
                const label = isHuge ? 'HUGE MONEY' : 'BIG MONEY';
                
                return `
                <div class="alarm-item" onclick="showBigMoneyAlarmDetail(${idx})" style="border-left: 3px solid ${bgColor};">
                    <div class="alarm-info">
                        <div class="alarm-match">
                            <span style="background:${bgColor};color:#fff;padding:2px 6px;border-radius:4px;font-size:10px;margin-right:8px;">${icon} ${label}</span>
                            ${alarm.home} vs ${alarm.away}
                        </div>
                        <div class="alarm-meta">${alarm.market} | ${alarm.selection} | ${alarm.created_at || ''}</div>
                        <div class="alarm-breakdown" style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 6px; font-size: 11px;">
                            <span style="color: ${bgColor};" title="Gelen Para">üí∞ Gelen: ¬£${Math.round(alarm.incoming_money || 0).toLocaleString()}</span>
                            ${isHuge ? `<span style="color: #ff7b00;" title="Toplam">üî• Toplam: ¬£${Math.round(alarm.huge_total || 0).toLocaleString()}</span>` : ''}
                            <span style="color: #58a6ff;" title="Limit">üìä Limit: ¬£${Math.round(alarm.big_money_limit || 15000).toLocaleString()}</span>
                            <span style="color: #3fb950;" title="Snapshot Sayisi">üì∏ ${alarm.snapshot_count || 1} kez</span>
                        </div>
                    </div>
                    <div class="alarm-score" style="background: linear-gradient(135deg, ${bgColor}, ${isHuge ? '#ff5500' : '#d4a017'});">${icon}</div>
                </div>
            `}).join('');

            window.currentBigMoneyAlarms = alarms;
        }

        function filterBigMoneyAlarms() {
            const searchTerm = document.getElementById('bigMoneySearchInput').value.toLowerCase().trim();
            if (!searchTerm) {
                renderBigMoneyAlarms(allBigMoneyAlarms);
                return;
            }
            const filtered = allBigMoneyAlarms.filter(alarm => 
                (alarm.home || '').toLowerCase().includes(searchTerm) ||
                (alarm.away || '').toLowerCase().includes(searchTerm)
            );
            renderBigMoneyAlarms(filtered, allBigMoneyAlarms.length);
        }

        async function saveBigMoneyConfig() {
            const config = {
                big_money_limit: parseFloat(document.getElementById('bigMoneyLimit').value) || 15000
            };
            
            try {
                const response = await fetch('/api/bigmoney/config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });
                if (response.ok) {
                    showToast('Big Money ayarlari kaydedildi!', 'success');
                } else {
                    showToast('Kayit hatasi!', 'error');
                }
            } catch (error) {
                showToast('Baglanti hatasi!', 'error');
            }
        }

        async function deleteBigMoneyAlarms() {
            if (!confirm('Tum Big Money alarmlari silinecek. Emin misiniz?')) return;
            
            try {
                const response = await fetch('/api/bigmoney/delete', { method: 'POST' });
                if (response.ok) {
                    showToast('Tum Big Money alarmlar silindi!', 'success');
                    loadBigMoneyAlarms();
                } else {
                    showToast('Silme hatasi!', 'error');
                }
            } catch (error) {
                showToast('Baglanti hatasi!', 'error');
            }
        }

        function showBigMoneyCalcStatus() {
            const statusEl = document.getElementById('bigMoneyCalcStatus');
            if (statusEl) statusEl.style.display = 'block';
        }

        function hideBigMoneyCalcStatus() {
            const statusEl = document.getElementById('bigMoneyCalcStatus');
            if (statusEl) statusEl.style.display = 'none';
        }

        async function calculateBigMoney() {
            showBigMoneyCalcStatus();
            document.getElementById('bigMoneyCalcProgress').textContent = 'Big Money hesaplaniyor...';
            
            try {
                const response = await fetch('/api/bigmoney/calculate', { method: 'POST' });
                const data = await response.json();
                
                hideBigMoneyCalcStatus();
                
                if (data.success) {
                    showToast(`Big Money hesaplandi! ${data.count} alarm bulundu.`, 'success');
                    loadBigMoneyAlarms();
                } else {
                    showToast('Hesaplama hatasi: ' + (data.error || 'Bilinmeyen hata'), 'error');
                }
            } catch (error) {
                hideBigMoneyCalcStatus();
                showToast('Baglanti hatasi!', 'error');
            }
        }

        function showBigMoneyAlarmDetail(idx) {
            const alarm = window.currentBigMoneyAlarms[idx];
            if (!alarm) return;

            const modal = document.getElementById('alarmDetailModal');
            const body = document.getElementById('alarmDetailBody');
            
            const isHuge = alarm.is_huge;
            const bgColor = isHuge ? '#ff7b00' : '#f0b429';
            const icon = isHuge ? 'üî•' : 'üí∞';
            const label = isHuge ? 'HUGE MONEY' : 'BIG MONEY';

            body.innerHTML = `
                <div class="detail-section">
                    <h4 style="color: ${bgColor};">${icon} ${label} Alarm Detaylari</h4>
                    <div class="detail-row"><span class="detail-label">Mac</span><span class="detail-value">${alarm.home} vs ${alarm.away}</span></div>
                    <div class="detail-row"><span class="detail-label">Market</span><span class="detail-value">${alarm.market}</span></div>
                    <div class="detail-row"><span class="detail-label">Secenek</span><span class="detail-value">${alarm.selection}</span></div>
                    <div class="detail-row"><span class="detail-label">Mac Tarihi</span><span class="detail-value" style="color: #58a6ff;">${alarm.match_date || '-'}</span></div>
                    <div class="detail-row"><span class="detail-label">Hesaplama Tarihi</span><span class="detail-value">${alarm.created_at || '-'}</span></div>
                </div>
                <div class="detail-section">
                    <h4>üí∞ Para Bilgileri</h4>
                    <div class="detail-row"><span class="detail-label">Maksimum Gelen Para</span><span class="detail-value highlight" style="color: ${bgColor};">¬£${Math.round(alarm.incoming_money || 0).toLocaleString()}</span></div>
                    <div class="detail-row"><span class="detail-label">Alarm Limiti</span><span class="detail-value">¬£${Math.round(alarm.big_money_limit || 15000).toLocaleString()}</span></div>
                    ${isHuge ? `<div class="detail-row"><span class="detail-label">Ardisik 2 Snapshot Toplami</span><span class="detail-value" style="color: #ff7b00;">¬£${Math.round(alarm.huge_total || 0).toLocaleString()}</span></div>` : ''}
                    <div class="detail-row"><span class="detail-label">Limit Asan Snapshot Sayisi</span><span class="detail-value">${alarm.snapshot_count || 1}</span></div>
                </div>
                <div class="detail-section">
                    <h4 style="color: ${bgColor};">${icon} ${label} Sinyali</h4>
                    <p style="font-size: 12px; color: #8b949e; line-height: 1.6;">
                        ${isHuge ? 
                            `Bu macta <strong style="color:#ff7b00;">2 ardisik snapshot</strong>'ta ${alarm.selection} secenegine ¬£${alarm.big_money_limit?.toLocaleString() || '15,000'}+ para girisi tespit edildi!<br><br>
                            Toplam: <strong style="color:#ff7b00;">¬£${Math.round(alarm.huge_total || 0).toLocaleString()}</strong><br><br>
                            <strong style="color: #ff7b00;">Sonuc:</strong> Cok buyuk oyuncular (syndicates, professional bettors) seri sekilde pozisyon aliyor olabilir!` 
                            : 
                            `Bu macta ${alarm.selection} secenegine tek snapshot'ta ¬£${Math.round(alarm.incoming_money || 0).toLocaleString()} para girisi tespit edildi!<br><br>
                            <strong style="color: #f0b429;">Sonuc:</strong> Buyuk oyuncular (sharps) pozisyon aliyor olabilir!`
                        }
                    </p>
                </div>
            `;
            modal.style.display = 'flex';
        }

        function showAlarmDetail(idx) {
            const alarm = window.currentAlarms[idx];
            if (!alarm) return;

            const modal = document.getElementById('alarmDetailModal');
            const body = document.getElementById('alarmDetailBody');

            body.innerHTML = `
                <div class="detail-section">
                    <h4>Mac ve Secim Bilgisi</h4>
                    <div class="detail-row"><span class="detail-label">Mac</span><span class="detail-value">${alarm.home} vs ${alarm.away}</span></div>
                    <div class="detail-row"><span class="detail-label">Market</span><span class="detail-value">${alarm.market}</span></div>
                    <div class="detail-row"><span class="detail-label">Secenek</span><span class="detail-value">${alarm.selection}</span></div>
                    <div class="detail-row"><span class="detail-label">Mac Tarihi</span><span class="detail-value" style="color: #58a6ff;">${alarm.match_date || '-'}</span></div>
                    <div class="detail-row"><span class="detail-label">Hesaplama Tarihi</span><span class="detail-value">${alarm.created_at || '-'}</span></div>
                </div>
                <div class="detail-section">
                    <h4>Hacim Soku</h4>
                    <div class="detail-row"><span class="detail-label">amount_change (gelen para)</span><span class="detail-value">¬£${Math.round(alarm.amount_change || 0).toLocaleString()}</span></div>
                    <div class="detail-row"><span class="detail-label">avg_last_amounts</span><span class="detail-value">¬£${(alarm.avg_last_amounts || 0).toFixed(2)}</span></div>
                    <div class="detail-row"><span class="detail-label">shock_raw</span><span class="detail-value">${(alarm.shock_raw || 0).toFixed(2)}x</span></div>
                    <div class="detail-row"><span class="detail-label">volume_multiplier</span><span class="detail-value">${alarm.volume_multiplier || 1}</span></div>
                    <div class="detail-row"><span class="detail-label">shock_value</span><span class="detail-value highlight">${(alarm.shock_value || 0).toFixed(2)}</span></div>
                    <div class="detail-row"><span class="detail-label">max_volume_cap</span><span class="detail-value">${alarm.max_volume_cap || 0}</span></div>
                    <div class="detail-row"><span class="detail-label">volume_contrib (capped)</span><span class="detail-value highlight">${(alarm.volume_contrib || 0).toFixed(2)}</span></div>
                </div>
                <div class="detail-section">
                    <h4>Oran Dususu</h4>
                    <div class="detail-row"><span class="detail-label">previous_odds</span><span class="detail-value">${alarm.previous_odds || 0}</span></div>
                    <div class="detail-row"><span class="detail-label">current_odds</span><span class="detail-value">${alarm.current_odds || 0}</span></div>
                    <div class="detail-row"><span class="detail-label">drop_pct</span><span class="detail-value">${(alarm.drop_pct || 0).toFixed(2)}%</span></div>
                    <div class="detail-row"><span class="detail-label">odds_multiplier</span><span class="detail-value">${alarm.odds_multiplier || 1}</span></div>
                    <div class="detail-row"><span class="detail-label">odds_value</span><span class="detail-value highlight">${(alarm.odds_value || 0).toFixed(2)}</span></div>
                    <div class="detail-row"><span class="detail-label">max_odds_cap</span><span class="detail-value">${alarm.max_odds_cap || 0}</span></div>
                    <div class="detail-row"><span class="detail-label">odds_contrib (capped)</span><span class="detail-value highlight">${(alarm.odds_contrib || 0).toFixed(2)}</span></div>
                </div>
                <div class="detail-section">
                    <h4>Pay Degisimi</h4>
                    <div class="detail-row"><span class="detail-label">previous_share</span><span class="detail-value">${alarm.previous_share || 0}%</span></div>
                    <div class="detail-row"><span class="detail-label">current_share</span><span class="detail-value">${alarm.current_share || 0}%</span></div>
                    <div class="detail-row"><span class="detail-label">share_diff</span><span class="detail-value">${(alarm.share_diff || 0).toFixed(2)}%</span></div>
                    <div class="detail-row"><span class="detail-label">share_multiplier</span><span class="detail-value">${alarm.share_multiplier || 1}</span></div>
                    <div class="detail-row"><span class="detail-label">share_value</span><span class="detail-value highlight">${(alarm.share_value || 0).toFixed(2)}</span></div>
                    <div class="detail-row"><span class="detail-label">max_share_cap</span><span class="detail-value">${alarm.max_share_cap || 0}</span></div>
                    <div class="detail-row"><span class="detail-label">share_contrib (capped)</span><span class="detail-value highlight">${(alarm.share_contrib || 0).toFixed(2)}</span></div>
                </div>
                <div class="detail-section">
                    <h4>Final Skor</h4>
                    <div class="detail-row"><span class="detail-label">SharpScore</span><span class="detail-value highlight" style="font-size: 18px; color: #f0883e;">${(alarm.sharp_score || 0).toFixed(2)}</span></div>
                    <div class="detail-row"><span class="detail-label">min_sharp_score</span><span class="detail-value">${alarm.min_sharp_score || 0}</span></div>
                    <div class="detail-row"><span class="detail-label">Durum</span><span class="detail-value" style="color: ${alarm.triggered ? '#3fb950' : '#f85149'};">${alarm.triggered ? 'TETIKLENDI' : 'Tetiklenmedi'}</span></div>
                </div>
            `;

            modal.style.display = 'flex';
        }

        function closeAlarmModal() {
            document.getElementById('alarmDetailModal').style.display = 'none';
        }

        if (location.hash === '#sharp' || new URLSearchParams(location.search).get('page') === 'sharp') {
            setTimeout(() => {
                showPage('sharp');
                loadSharpConfig();
                loadAlarms();
            }, 100);
        }
    </script>
</body>
</html>
